<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="jiuchengBlog 博客">
    <meta name="description" content="hello, here is JiuCheng&#39; s blog">
    <meta name="author" content="馨er">
    
    <title>
        
            MySQL笔记 |
        
        馨er的学习之路
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"jiucheng120.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":false},"style":{"primary_color":"#CC00FF","avatar":"/images/avatar.png","favicon":"/images/logo.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.png","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/avatar.png">
                </a>
            
            <a class="logo-title" href="/">
                馨er的学习之路
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class href="/">
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/archives">
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/categories">
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/tags">
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/links">
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/about">
                                关于
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jiucheng120">
                                GITHUB
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/about">关于</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jiucheng120">GITHUB</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">MySQL笔记</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">馨er</span>
                        
                            <span class="author-label">CTO</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-03-13 16:03:20</span>
        <span class="mobile">2022-03-13 16:03</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/MySQL/">MySQL</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>63.3k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>249 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <blockquote>
<p>黑马程序员MySQL学习笔记</p>
</blockquote>
<span id="more"></span>



<h1 id="1-数据库基本介绍"><a href="#1-数据库基本介绍" class="headerlink" title="1 数据库基本介绍"></a>1 数据库基本介绍</h1><h2 id="1-1-数据库基本知识"><a href="#1-1-数据库基本知识" class="headerlink" title="1.1 数据库基本知识"></a>1.1 数据库基本知识</h2><p><strong>数据库</strong>：database（DB），是一种存储数据的仓库</p>
<ul>
<li>数据库是根据数据结构组织、存储和管理数据</li>
<li>数据库能够长期、高效的管理和存储数据</li>
<li>数据库的目的就是能够存储（写）和提供（读）数据</li>
</ul>
<h2 id="1-2-数据库分类"><a href="#1-2-数据库分类" class="headerlink" title="1.2 数据库分类"></a>1.2 数据库分类</h2><p><strong>数据库分类</strong>：根据数据库的架构和数据组织原理进行分类</p>
<p>1、早期根据数据库的组织数据的存储模型分类</p>
<ul>
<li>层次数据库：基于层次的数据结构（数据分层）——树</li>
<li>网状数据库：基于网状的数据结构（数据网络）——图</li>
<li>关系数据库：基于关系模型的数据结构（二维表）</li>
</ul>
<p>2、现在较多根据实际数据管理模型分类（存储介质）</p>
<ul>
<li>关系型数据库：基于关系模型的数据结构（二维表）通常存储在磁盘（比较稳定）</li>
<li>非关系型数据库：没有具体模型的数据结构（键值对）通常存储在内存（效率高）</li>
</ul>
<h2 id="1-3-关系型数据库"><a href="#1-3-关系型数据库" class="headerlink" title="1.3 关系型数据库"></a>1.3 关系型数据库</h2><p><strong>关系型数据库</strong>：是一种建立在关系模型上的数据库</p>
<ul>
<li>关系模型<ul>
<li>关系数据结构（存储）</li>
<li>关系操作集合（操作）</li>
<li>关系完整性约束（约束）</li>
</ul>
</li>
<li>关系型数据库存储在磁盘中（永久性存储）</li>
<li>关系型数据库系统（DBS）模型有四层结构<ul>
<li>数据库管理系统（DBMS）：管理系统运行（DataBase Management System）</li>
<li>数据库（DB）：数据存储的管理者（小管理，受DBMS管理）</li>
<li>数据表（Table）：数据关系管理者</li>
<li>数据字段（Field）：依赖于数据表，实际数据存储者</li>
</ul>
</li>
<li>关系型数据库产品<ul>
<li>大型：Oracle、DB2</li>
<li>中型：MySQL、SqlServer</li>
<li>小型：Sybase、Access</li>
</ul>
</li>
</ul>
<h2 id="1-4-非关系型数据库"><a href="#1-4-非关系型数据库" class="headerlink" title="1.4 非关系型数据库"></a>1.4 非关系型数据库</h2><p><strong>非关系型数据库</strong>：NoSQL（Not only SQL），不仅仅是关系型数据库</p>
<ul>
<li>所有不是关系型数据库的统称</li>
<li>数据存储模型不是二维表，而是<strong>键值对</strong>（key-&gt;value）</li>
<li>存储的位置通常是内存（效率高）</li>
<li>不能永久性存储（需要定时存到关系型数据库中）</li>
<li>常见的非关系型数据库产品<ul>
<li>MongoDB</li>
<li>Redis</li>
<li>Memcached</li>
</ul>
</li>
</ul>
<blockquote>
<p>对比</p>
</blockquote>
<p><strong>NoSQL通常是与关系型数据库配合使用的</strong>，他们彼此是一种互补关系</p>
<ul>
<li>NoSQL运行在内存，解决效率问题<ul>
<li>I/O问题</li>
<li>效率问题</li>
</ul>
</li>
<li>MySQL运行在磁盘，解决稳定问题<ul>
<li>安全问题（永久存储）</li>
<li>稳定</li>
</ul>
</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、NoSQL是对非关系型数据库的一类统称</p>
<ul>
<li>NoSQL是不仅仅只是关系型数据库的意思</li>
</ul>
<p>2、NoSQL通常运行在内存</p>
<ul>
<li>读取效率高</li>
<li>并发访问高</li>
<li>稳定性不高（断电即丢失）</li>
</ul>
<p>3、NoSQL通常是键值对存储数据，访问也比较简单</p>
<h2 id="1-5-SQL基本介绍"><a href="#1-5-SQL基本介绍" class="headerlink" title="1.5 SQL基本介绍"></a>1.5 SQL基本介绍</h2><p><strong>SQL</strong>：Structured Query Language，结构化查询语言，是一种针对关系型数据库特殊标准化的编程语言</p>
<ul>
<li><p>SQL是一种编程语言</p>
</li>
<li><p>能够实现用户数据库查询和程序设计</p>
</li>
<li><p>SQL根据操作不同，分为几类</p>
<ul>
<li>DQL：Data Query Language，数据查询语言，用于查询和检索数据</li>
<li>DML：Data Manipulation Language，数据操作语言，用于数据的写操作（增删改） </li>
<li>DDL：Data Definition Language，数据定义语言，用于创建数据结构</li>
<li>DCL：Data Control Language，数据控制语言，用于用户权限管理</li>
<li>TPL：Transaction Process Language，事务处理语言，辅助DML进行事务操作（因此也归属于DML）   </li>
</ul>
</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、SQL虽然是编程语言，但是目前数据库通常只用来进行数据管理（逻辑部分给其他编程语言）</p>
<p>2、SQL虽然是针对关系型数据库的通用语言，但是不同的产品操作指令不完全通用</p>
<h2 id="1-6-MySQL基本介绍"><a href="#1-6-MySQL基本介绍" class="headerlink" title="1.6 MySQL基本介绍"></a>1.6 MySQL基本介绍</h2><p><strong>MySQL</strong>：是瑞典AB公司下的一款<strong>关系型数据库</strong></p>
<ul>
<li>MySQL当前属于甲骨文公司（AB-&gt;Sun-&gt;Oracle）</li>
<li>MySQL开源免费（部分存储引擎收费，源码开源，Oracle收费）</li>
<li>MySQL是一种C/S结构软件，因此需要MySQL的客户端来访问服务端（数据管理）<ul>
<li>mysqld.exe：服务端</li>
<li>mysql.exe：客户端</li>
</ul>
</li>
<li>MySQL使用SQL指令对数据库进行操作</li>
</ul>
<blockquote>
<p>访问原理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(MySQL客户端)--&gt;B[寻找服务端&lt;br&gt;host寻找]</span><br><span class="line">B--&gt;C[寻找服务端&lt;br&gt;Port寻找]</span><br><span class="line">C--&gt;D[验证身份&lt;br&gt;username判定&lt;br&gt;password判定]</span><br><span class="line">D--&gt;E((服务端))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL是一款流行的关系型数据库</p>
<p>2、MySQL是一款C/S结构的软件，需要客户端访问服务端</p>
<p>3、MySQL是基于SQL指令进行管理操作</p>
<h2 id="1-7-MySQL访问"><a href="#1-7-MySQL访问" class="headerlink" title="1.7 MySQL访问"></a>1.7 MySQL访问</h2><p><strong>MySQL访问</strong>：就是客户端连接上服务端，然后实现数据操作的过程</p>
<ul>
<li><p>客户端访问服务端</p>
<ul>
<li>利用Windows控制台访问（MySQL客户端）</li>
<li>利用数据库管理工具（Navicat）</li>
</ul>
</li>
<li><p>客户端需要连接认证</p>
<ul>
<li>-h：主机地址（本机localhost可以省略）</li>
<li>-P：端口号（默认3306可以省略）</li>
<li>-u：用户名</li>
<li>-p：用户密码</li>
</ul>
</li>
<li><p>客户端连接上服务端就表示占用了一个资源，可以进行对应权限的操作</p>
<ul>
<li>MySQL数据库连接资源有限：单个服务器最多16384个</li>
<li>连接资源不够了其他访问就需要排队等待</li>
<li>用完尽可能释放资源</li>
</ul>
</li>
<li><p>客户端退出服务端</p>
<ul>
<li>\q</li>
<li>quit</li>
<li>exit</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、打开客户端（CMD控制台）：mysql -uroot -p密码</p>
<p>2、输入服务器信息（连接）和用户信息（验证）</p>
<p>3、执行SQL操作</p>
<p>4、断开连接</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL需要通过客户端来进行服务端访问</p>
<ul>
<li>自带客户端mysql.exe：Windows下借助CMD</li>
<li>数据库管理工具：Navicat，图形化管理</li>
<li>支持MySQL扩展的编程语言：PHP、Java等</li>
</ul>
<p>2、数据库操作需要进行连接认证</p>
<ul>
<li>主机地址：-h，默认localhost可省略</li>
<li>端口：-P（大写字母），默认3306可省略</li>
<li>用户名：-u</li>
<li>密码：-p（小写字母）</li>
</ul>
<p>3、数据库连接资源有限，用完即关闭</p>
<h2 id="1-8-总结"><a href="#1-8-总结" class="headerlink" title="1.8 总结"></a>1.8 总结</h2><p>1、数据库的作用要清楚：高效的存储和管理数据，为编程语言提供数据支撑</p>
<p>2、当前市面上数据库的分类主要为两类</p>
<ul>
<li>关系型数据库：注重结构和数据存储的持久性</li>
<li>非关系型数据库：注重数据读取的效率</li>
</ul>
<p>3、关系型数据库是几乎所有网站都会使用到的，必须掌握其概念</p>
<p>4、所有关系型数据库都是基于SQL进行数据的操作，MySQL数据库也是（不同的数据库产品对应的SQL指令可能有细微差别）</p>
<p>5、MySQL是一种C/S结构的软件，所以访问者必须通过客户端进行访问</p>
<ul>
<li>客户端与服务端通常不会在一台电脑上</li>
<li>客户端访问服务端需要寻址、授权（-hPup）</li>
<li>MySQL服务端的连接数是有限的，时刻注意用完就销毁（减少资源无效占用）</li>
</ul>
<h1 id="2-MySQL基本操作"><a href="#2-MySQL基本操作" class="headerlink" title="2 MySQL基本操作"></a>2 MySQL基本操作</h1><h2 id="2-1-SQL语法规则"><a href="#2-1-SQL语法规则" class="headerlink" title="2.1 SQL语法规则"></a>2.1 SQL语法规则</h2><p><strong>SQL语法规则</strong>：SQL是一种结构化编程语言</p>
<ul>
<li>基础SQL指令通常是以行为单位</li>
<li>SQL指令需要语句结束符，默认是英文分号：<code>;</code>、\g、\G<ul>
<li>\G：主要用于查询数据，立体展示结果</li>
</ul>
</li>
<li>SQL指令类似自然语言</li>
<li>编写的SQL中如果用到了关键字或者保留字，需要使用反引号``来包裹，让系统忽略</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、结构创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create 结构类型 结构名 结构描述;</span><br></pre></td></tr></table></figure>

<p>2、显示结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#显示结构</span><br><span class="line">show 结构类型（复数）;</span><br><span class="line"></span><br><span class="line">#显示结构创建详情</span><br><span class="line">show create 结构类型 结构名;</span><br></pre></td></tr></table></figure>

<p>3、数据操作（数据表）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#新增数据</span><br><span class="line">insert into 表名 values</span><br><span class="line"></span><br><span class="line">#查看数据</span><br><span class="line">select from 表名</span><br><span class="line"></span><br><span class="line">#更新数据</span><br><span class="line">update 表名 set </span><br><span class="line"></span><br><span class="line">#删除数据</span><br><span class="line">delete from 表名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、SQL是一种类似于自然语言的编程语言</p>
<ul>
<li>基本SQL指令以行为单位</li>
<li>SQL指令需要语句结束符</li>
</ul>
<p>2、根据数据库的对象层级，可以将基础SQL操作分为三类</p>
<ul>
<li>库操作：数据库相关操作</li>
<li>表操作：数据表（字段）相关操作</li>
<li>数据操作：数据相关操作</li>
</ul>
<h2 id="2-2-SQL库操作"><a href="#2-2-SQL库操作" class="headerlink" title="2.2 SQL库操作"></a>2.2 SQL库操作</h2><h3 id="1、-创建数据库"><a href="#1、-创建数据库" class="headerlink" title="1、 创建数据库"></a>1、 创建数据库</h3><p><strong>创建数据库</strong>：根据项目需求创建一个存储数据的仓库</p>
<ul>
<li>使用create database 数据库名字创建<ul>
<li>数据库层面可以指定字符集：charset / character set</li>
<li>数据库层面可以指定校对集：collate</li>
</ul>
</li>
<li>创建数据库会在磁盘指定存放处产生一个文件夹</li>
<li>创建语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名字 [数据库选项];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建一个指定名字的数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database db_1;</span><br></pre></td></tr></table></figure>

<p>2、创建一个指定字符集的数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database db_2 charset utf8MB4;</span><br></pre></td></tr></table></figure>

<p>3、创建一个指定校对集的数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database db_3 charset utf8MB4 collate utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据库的创建是存储数据的基础，数据库的创建通常是一次性的</p>
<p>2、创建数据库的语法包含几个部分</p>
<ul>
<li>关键字： create database </li>
<li>数据库名字： 自定义名字<ul>
<li>数字、字母和下划线组成</li>
<li>不区分大小写</li>
<li>数字不能开头</li>
<li>使用下划线法创建复杂数据库名字（很少使用驼峰命名法）</li>
</ul>
</li>
<li>数据库选项：非必须的规定<ul>
<li>字符集：charset /character  set 字符集。非必须，默认继承DBMS</li>
<li>校对集：collate 校对集。非必须，依赖字符集</li>
</ul>
</li>
</ul>
<p>3、创建好的数据库可以在数据存储指定地点（安装时指定）看到</p>
<ul>
<li>一个数据库对应一个文件夹</li>
<li>每个数据库下有个对应的文件，里面有字符集和校对集信息（Mysql7以前）</li>
</ul>
<h3 id="2、显示数据库"><a href="#2、显示数据库" class="headerlink" title="2、显示数据库"></a>2、显示数据库</h3><p><strong>显示数据库</strong>：通过客户端指令来查看已有数据库</p>
<ul>
<li>数据库的查看是根据用户权限限定的</li>
<li>数据库的查看分为两种查看方式：<ul>
<li>查看全部数据库</li>
<li>查看数据库创建指令</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、显示所有数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>

<p>2、显示数据库创建指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create database db_1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、查看数据库分为两种方式</p>
<ul>
<li>查看全部：show databases;</li>
<li>查看具体创建指令：show create database 数据库名字;</li>
</ul>
<p>2、查看数据库的目的和应用</p>
<ul>
<li>开发人员确认数据库是否存在</li>
<li>数据库管理员维护</li>
</ul>
<h3 id="3、使用数据库"><a href="#3、使用数据库" class="headerlink" title="3、使用数据库"></a>3、使用数据库</h3><p><strong>使用数据库</strong>：指在进行具体SQL指令之前，让系统知道操作针对的是哪个数据库</p>
<ul>
<li>数据库的操作通常是针对数据表或者数据</li>
<li>通过使用数据库可以让后续指令默认针对具体数据库环境</li>
<li>使用数据库语法：use 数据库名字;</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use db_1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、使用数据库的指令是：use 数据库名字;</p>
<p>2、使用数据库的目标</p>
<ul>
<li>让系统知道后续SQL指令都是针对当前选择的数据库</li>
<li>简化后续SQL指令的复杂度（如果不指定数据库，那么所有的SQL操作都必须强制指定数据库名字）</li>
</ul>
<h3 id="4、修改数据库"><a href="#4、修改数据库" class="headerlink" title="4、修改数据库"></a>4、修改数据库</h3><p><strong>修改数据库</strong>：修改数据库的相关库选项</p>
<ul>
<li>数据库名字不可修改（老版本可以）<ul>
<li>先新增</li>
<li>后迁移</li>
<li>最后删除</li>
</ul>
</li>
<li>数据库修改分为两个部分（库选项）<ul>
<li>字符集</li>
<li>校对集</li>
</ul>
</li>
<li>数据库修改指令（与创建指令差不多）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database 数据库名字 库选项</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、修改数据库字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database db_2 charset gbk;</span><br></pre></td></tr></table></figure>

<p>2、修改数据库校对集（如果校对集修改必须同时改变字符集）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database db_3 charset gbk collate gbk_chinese_ci;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据库的修改只能修改库选项，不能修改名字</p>
<p>2、字符集的修改指令使用alter，其他跟创建指令一致</p>
<p>3、数据库修改通常有两部分</p>
<ul>
<li>字符集修改</li>
<li>校对集修改（校对集必须对应字符集）</li>
</ul>
<p>4、一般我们都不会使用数据库修改（一般要改也是删除后新增）</p>
<h3 id="5、删除数据库"><a href="#5、删除数据库" class="headerlink" title="5、删除数据库"></a>5、删除数据库</h3><p><strong>删除数据库</strong>：将当前已有数据库删除</p>
<ul>
<li>删除数据库会删除数据库内所有的表和数据</li>
<li>删除数据库操作要慎重（删前备份）</li>
<li>删除数据库后，对应的存储文件夹就会消失</li>
<li>删除语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名字;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database db_1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、删除数据库使用指令：drop database 数据库名字</p>
<p>2、数据库的删除不可逆</p>
<ul>
<li>删除会清空当前数据库内的所有数据表（表里数据一并删除）</li>
<li>删除数据库会将对应的文件夹从磁盘抹掉</li>
<li>数据库删除要谨慎（一般不建议删除）</li>
</ul>
<h3 id="6、总结"><a href="#6、总结" class="headerlink" title="6、总结"></a>6、总结</h3><p>1、数据库的操作通常是一次性的，即在进行业务代码开展之前将数据库维护好</p>
<p>2、数据库的删除需要非常慎重，尤其是生产环境，数据库的删除是不可逆（会将数据库中的所有数据全部删除）</p>
<h2 id="2-3-SQL表（字段）操作"><a href="#2-3-SQL表（字段）操作" class="headerlink" title="2.3 SQL表（字段）操作"></a>2.3 SQL表（字段）操作</h2><h3 id="1、创建数据表"><a href="#1、创建数据表" class="headerlink" title="1、创建数据表"></a>1、创建数据表</h3><p><strong>创建数据表</strong>：根据业务需求，确定数据表的字段信息，然后创建表结构</p>
<ul>
<li>表与字段不分家，相辅相成</li>
<li>表的创建需要指定存储的数据库<ul>
<li>明确指定数据库：<code>数据库.表名</code></li>
<li>先使用数据库：<code>use 数据库名字</code></li>
</ul>
</li>
<li>字段至少需要指定名字、类型</li>
<li>数据库表不限定字段数量<ul>
<li>每个字段间使用逗号<code>,</code>分隔</li>
<li>最后一个字段不需要逗号</li>
</ul>
</li>
<li>表可以指定表选项（都有默认值）<ul>
<li>存储引擎：engine [=] 具体存储引擎</li>
<li>字符集：[default] charset 具体字符集（继承数据库）</li>
<li>校对集：collate（继承数据库）</li>
</ul>
</li>
<li>表创建语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table [数据库名.]表名(</span><br><span class="line">    字段名 字段类型,</span><br><span class="line">    ...</span><br><span class="line">    字段名 字段类型</span><br><span class="line">)表选项;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建简单数据表（指定数据库创建数据表）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table db_2.t_1(</span><br><span class="line">    name varchar(50)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2、创建数据表——多字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用数据库（进入数据库环境）</span><br><span class="line">use db_2;</span><br><span class="line">create table t_2(</span><br><span class="line">    name varchar(50),</span><br><span class="line">    age int,</span><br><span class="line">    gender varchar(10)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>3、创建数据表——表选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_3(</span><br><span class="line">    name varchar(50)</span><br><span class="line">)engine Innodb charset utf8MB4;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、创建数据库表是为了存储具体数据</p>
<p>2、数据表的创建与字段是同时存在的</p>
<p>3、数据表的创建需要指定数据库</p>
<ul>
<li>在表名字前指定数据库：数据库名.表名</li>
<li>进入数据库环境（常用）</li>
</ul>
<p>4、一张数据表用来存一组相关数据</p>
<p>5、扩展：存储引擎是指数据存储和管理的方式，MySQL中提供了多种存储引擎，一般使用默认存储引擎</p>
<ul>
<li>InnoDB（常用）<ul>
<li>默认存储引擎</li>
<li>支持事务处理和外键</li>
<li>数据统一管理</li>
</ul>
</li>
<li>MyIsam<ul>
<li>不支持事务和外键</li>
<li>数据、表结构、索引独立管理</li>
<li>MySQL5.6以后不再维护</li>
</ul>
</li>
</ul>
<p>6、扩展：如果想创建一个与已有表一样的数据表，MySQL提供了一种便捷的复制模式</p>
<ul>
<li>create table 表名 like 数据库名字.表名</li>
</ul>
<p><code>create table t_3_like like t_3;</code></p>
<h3 id="2、显示数据表"><a href="#2、显示数据表" class="headerlink" title="2、显示数据表"></a>2、显示数据表</h3><p>显示数据表：客户端通过指令显示已有的数据表</p>
<ul>
<li>数据表的显示跟用户权限有关</li>
<li>显示数据表有两种方式<ul>
<li>显示所有数据表</li>
<li>显示具体数据表的创建指令</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、显示所有数据表——当前数据库下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>

<p>2、显示所有数据表——指定数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables from db_3;</span><br></pre></td></tr></table></figure>

<p>3、显示部分关联数据表——匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables like &#39;%like&#39;;	# _表示匹配一个字符（固定位置），%表示匹配N个字符</span><br></pre></td></tr></table></figure>

<p>4、显示数据表的创建指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table t_1; # 看到的结果未必一定是真实创建的指令（系统会加工）</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、显示数据表有两种形式</p>
<ul>
<li>显示所有数据表：show tables [from 指定数据库];<ul>
<li>显示部分：show tables like ‘pattern’;   匹配模式：_匹配单个字符，%匹配不限量字符</li>
</ul>
</li>
<li>显示数据表创建指令：show create table 表名;</li>
</ul>
<p>2、显示数据表通常是为了验证数据表是否存在或者验证数据表的创建指令是否正确</p>
<p>3、在显示数据的时候可以使用不同的语句结束符</p>
<ul>
<li>\g：与普通分号无区别</li>
<li>\G：纵向显示列数据</li>
</ul>
<h3 id="3、查看数据表"><a href="#3、查看数据表" class="headerlink" title="3、查看数据表"></a>3、查看数据表</h3><p><strong>查看数据表</strong>：指查看数据表中的具体结构</p>
<ul>
<li>通常是查看字段信息</li>
<li>详细的显示字段的各项信息</li>
<li>查看语法有三种（效果一样）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">desc 表名；</span><br><span class="line">describe 表名;</span><br><span class="line">show columns from 表名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc t_1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据表的查看是为了查看表中具体字段的信息</p>
<p>2、查看数据表的指令有多个，效果都一样</p>
<ul>
<li>desc 表名;（常用）</li>
<li>describe 表名;</li>
<li>show columns from 表名;</li>
</ul>
<p>3、查看表结构的原因通常是在开发过程中为了更清晰的了解数据的存储形式和要求</p>
<h3 id="4、更改数据表"><a href="#4、更改数据表" class="headerlink" title="4、更改数据表"></a>4、更改数据表</h3><p><strong>更改数据表</strong>：修改表名字和表选项</p>
<ul>
<li>修改表名：<code>rename table 表名 to 新表名</code></li>
<li>修改表选项：<code>alter table 表名</code></li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、修改表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table t_1 to t1;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：如果有时候想要跨库修改的话，需要使用<code>数据库名.表名</code>（一般不建议）</p>
<p>2、修改表选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t1 charset utf8;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、更改数据表分为两个部分</p>
<ul>
<li>更改表名：rename table 原表名 to 新表名；</li>
<li>更改表选项：alter table 表名 表选项</li>
</ul>
<p>2、通常我们较少使用更改数据表，数据表应该在创建时就定义好</p>
<h3 id="5、更改字段"><a href="#5、更改字段" class="headerlink" title="5、更改字段"></a>5、更改字段</h3><p><strong>更改字段</strong>：指针对表创建好后，里面字段的增删改</p>
<ul>
<li>字段操作包含字段名字、类型和属性的操作</li>
<li>字段操作分为四类<ul>
<li>新增字段：add [column]</li>
<li>更改字段名：change</li>
<li>修改类型：modify</li>
<li>删除字段：drop</li>
</ul>
</li>
<li>字段操作还有位置处理</li>
<li>字段操作通常是在表已经存在数据后进行</li>
</ul>
<h4 id="（1）新增字段"><a href="#（1）新增字段" class="headerlink" title="（1）新增字段"></a>（1）新增字段</h4><p><strong>新增字段</strong>：在表创建好后往里面增加其他字段</p>
<ul>
<li><p>字段的新增必须同时存在字段类型</p>
</li>
<li><p>新增语法</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add [column] 字段名 字段类型 [字段属性] [字段位置]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、给已经存在的t_3表增加一个字段age</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 add age int;</span><br></pre></td></tr></table></figure>

<p>2、给已经存在的t_3表增加一个字段nickname</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 add column nickname varchar(10);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、新增字段就是给已有表追加一个字段（较少）（因为，增加的数据从何处来）</p>
<p>2、字段新增必须指定字段类型</p>
<p>3、字段新增语法为：alter table 表名 add [column] 字段名 字段类型;</p>
<p>4、字段的追加默认是在所有字段之后</p>
<h4 id="（2）字段位置"><a href="#（2）字段位置" class="headerlink" title="（2）字段位置"></a>（2）字段位置</h4><p><strong>字段位置</strong>：指字段放到某个指定字段之后</p>
<ul>
<li>字段位置分为两种<ul>
<li>第一个字段：first</li>
<li>某个字段后：after 已经存在字段名</li>
</ul>
</li>
<li>字段位置适用于追加字段、修改字段、更改字段名</li>
<li>字段位置语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 字段操作 字段位置;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、为t_3表增加一个id字段，放到最前面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 add id int first;</span><br></pre></td></tr></table></figure>

<p>2、在t_3表name字段后增加一个身份证字段card</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 add card varchar(18) after name;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、字段位置是配合字段操作的（新增、修改）</p>
<p>2、字段位置分两种</p>
<ul>
<li>最前面（第一个字段）：first</li>
<li>字段后面：after 已存在字段名</li>
</ul>
<h4 id="（3）更改字段名"><a href="#（3）更改字段名" class="headerlink" title="（3）更改字段名"></a>（3）更改字段名</h4><p><strong>更改字段名</strong>：指对已经存在的字段名进行修改</p>
<ul>
<li>字段名的修改也必须跟上字段类型</li>
<li>字段名修改语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 change 原字段名 新字段名 字段类型 [字段属性] [位置]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>修改字段名card为sfz</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 change card sfz varchar(18);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、字段名更改通常只是修改字段名字，但是也必须跟随类型</p>
<p>2、字段名修改语法：alter table 表名 change 原字段名 新字段名 字段类型</p>
<p>3、字段名修改change其实也可以修改字段类型、属性和位置，但是通常不使用（专人专事）</p>
<h4 id="（4）修改字段"><a href="#（4）修改字段" class="headerlink" title="（4）修改字段"></a>（4）修改字段</h4><p><strong>修改字段</strong>：指修改字段的相关信息</p>
<ul>
<li>修改字段类型、字段属性和位置</li>
<li>修改字段语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 字段名 字段类型 [字段属性] [位置]；</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>修改身份证的类型为char(18)并且位置放到id后面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 modify sfz char(18) after id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、修改字段包含多个操作</p>
<ul>
<li>字段类型修改</li>
<li>字段属性修改</li>
<li>字段位置修改</li>
</ul>
<p>2、修改字段语法：alter table 表名 modify 字段名  字段类型 [字段属性] [位置];</p>
<h3 id="6、删除字段"><a href="#6、删除字段" class="headerlink" title="6、删除字段"></a>6、删除字段</h3><p><strong>删除字段</strong>：即将某个不要的字段从表中剔除</p>
<ul>
<li>删除字段会将数据也删除（不可逆）</li>
<li>删除字段语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop 字段名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>删除年龄字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_3 drop age;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、字段删除在删除字段名的同时会删除字段对应的数据，而且不可逆</p>
<p>2、字段删除语法：alter table 表名 drop 字段名</p>
<h3 id="7、总结"><a href="#7、总结" class="headerlink" title="7、总结"></a>7、总结</h3><p>1、数据表结构的操作是数据操作的基础</p>
<p>2、一般情况下新手都不会接触数据表的设计，但是作为一名新手一定要在使用数据表之前查看数据表的结构信息</p>
<p>3、不要轻易的修改或者删除数据表结构（数据会一并被处理掉）</p>
<p>4、数据表结构的维护通常是一次性的，在业务开展前尽可能好的设计好数据表，而不要后期再进行其他维护</p>
<h2 id="2-4-SQL数据操作"><a href="#2-4-SQL数据操作" class="headerlink" title="2.4 SQL数据操作"></a>2.4 SQL数据操作</h2><h3 id="1、新增数据"><a href="#1、新增数据" class="headerlink" title="1、新增数据"></a>1、新增数据</h3><p><strong>新增数据</strong>：将数据插入到数据表永久存储</p>
<ul>
<li>新增数据是根据表的字段顺序和数据类型要求将数据存放到数据表中</li>
<li>数据表中的数据以行（row）为存储单位，实际存储属于字段（field）存储数据</li>
<li>数据插入分两种方式<ul>
<li>全字段插入：<code>insert into 表名 values(字段列表顺序对应的所有值);</code></li>
<li>部分字段插入：<code>insert into 表名 (字段列表) values(字段列表对应的值顺序列表);</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、给t_3表插入一条完整数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_3 values(1,&#39;440111200011111101&#39;,&#39;Jim&#39;,&#39;Green&#39;);</span><br></pre></td></tr></table></figure>

<p>2、根据字段插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_3 (id,sfz,name) values(2,&#39;441000200011111211&#39;,&#39;Tom&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据插入是利用insert指令将数据永久存储到数据表中</p>
<p>2、数据存储以行为单位，字段为最小实际存储单位</p>
<p>3、数据插入分为两种方式插入数据</p>
<ul>
<li>全字段插入<ul>
<li>insert into 表名 values(值列表)</li>
<li>值列表必须与字段列表顺序一致</li>
<li>值列表的每个数据类型必须与字段类型一致</li>
</ul>
</li>
<li>部分字段插入<ul>
<li>insert into 表名 (字段列表) values(值列表)</li>
<li>字段列表可以顺序随意</li>
<li>值列表必须与指定的字段列表顺序一致</li>
<li>值列表元素的类型必须与字段列表的类型一致</li>
</ul>
</li>
</ul>
<h3 id="2、查看数据"><a href="#2、查看数据" class="headerlink" title="2、查看数据"></a>2、查看数据</h3><p><strong>查看数据</strong>：将表中已经存在的数据按照指定的要求显示出来</p>
<ul>
<li>查到的数据显示出来是一张二维表</li>
<li>数据显示包含字段名和数据本身</li>
<li>数据查看分两种方式<ul>
<li>查看全部字段：使用<code>*</code>代替所有字段</li>
<li>查看部分字段：明确字段名，使用逗号分隔</li>
</ul>
</li>
<li>查看数据很多时候也是根据条件查询部分数据</li>
<li>查看语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *|字段列表 from 表名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、查看t_3表中所有数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_3;</span><br></pre></td></tr></table></figure>

<p>2、查看t_3表中的name和身份证信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name,sfz from t_3;</span><br></pre></td></tr></table></figure>

<p>3、查看t_3表中id值为1的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_3 where id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据查看是数据库中最常用的操作（99%）</p>
<p>2、数据查看分两种情况</p>
<ul>
<li>查看全部：select * （*叫做通配符）</li>
<li>查看部分：select 字段列表（建议）</li>
</ul>
<p>3、实际使用时通常会带where条件进行数据筛选</p>
<h3 id="3、更新数据"><a href="#3、更新数据" class="headerlink" title="3、更新数据"></a>3、更新数据</h3><p><strong>更新数据</strong>：即更新某个已有字段的值</p>
<ul>
<li>更新数据通常是根据条件更新某些数据，而不是全部记录都更新</li>
<li>更新数据语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update 表名 set 字段 &#x3D; 新值[,字段 &#x3D; 新值] [where条件筛选];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、更新所有记录的身份证信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_3 set sfz &#x3D; &#39;440100200010100001&#39;;</span><br></pre></td></tr></table></figure>

<p>2、更新某个记录的多个字段数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_3 set name &#x3D; &#39;Lily&#39;,sfz &#x3D; &#39;440100200010100002&#39; where id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、更新数据的针对记录的字段数据进行更新</p>
<p>2、更新通常是限定条件更新（一般不会更新全部）</p>
<h3 id="4、删除数据"><a href="#4、删除数据" class="headerlink" title="4、删除数据"></a>4、删除数据</h3><p><strong>删除数据</strong>：将数据从已有数据表中清除（针对的是记录record）</p>
<ul>
<li>删除数据是一种不可逆操作</li>
<li>数据删除通常都是有条件删除</li>
<li>数据删除语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from 表名 [where条件];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>删除t_3表中id为2的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from t_3 where id &#x3D; 2;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据删除是不可逆的操作</p>
<p>2、数据删除通常都匹配条件部分删除</p>
<h3 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h3><p>1、数据操作不论是初级开发者还是高级开发者都频繁接触的操作</p>
<p>2、数据操作中读操作，往往占据了整个操作的99%以上</p>
<p>3、基本的增删改查是作为进阶的必要知识，必须熟练掌握和频繁练习（尽可能使用原码，集成工具后期开发时使用）</p>
<h1 id="3-MySQL数据库字符集"><a href="#3-MySQL数据库字符集" class="headerlink" title="3 MySQL数据库字符集"></a>3 MySQL数据库字符集</h1><h2 id="3-1-字符集"><a href="#3-1-字符集" class="headerlink" title="3.1 字符集"></a>3.1 字符集</h2><h3 id="1、字符集概念"><a href="#1、字符集概念" class="headerlink" title="1、字符集概念"></a>1、字符集概念</h3><p><strong>字符集</strong>：charset或者character set，是各种文字和符号在计算机中的总称</p>
<ul>
<li>字符集根据不同国家的符号不同，有不同的字符集</li>
<li>不同的字符集占用的存储空间不一样，存储的底层也不一样</li>
<li>不同字符集之间可以进行转换</li>
<li>常见字符集<ul>
<li>ASCII：美国信息交换标准码，一般英文符号，一个字节存储</li>
<li>latin1：拉丁文字符集，一个字节存储，ISO-8859-1的别名 ，能够向下兼容ASCII</li>
<li>GB2312：信息交换用汉字编码字符集 ，是中国1981年的一套国标规范，2个字节存储</li>
<li>GBK：汉字内码扩展规范（1995年），两个字节表示表示（汉字很多超过5000个）</li>
<li>Unicode：万国码（统一码），使用统一的编码方式来解决传统的局限，1994年出现</li>
<li>UTF-8：8-bit Unicode Transformation Format（万国码） ，针对Unicode的可变长度字符编码，采用1-6个字节编码Unicode字符（目前通用编码规则）。建议使用UTF-8字符集进行数据存储（MySQL8中建议使用utf8mb4）</li>
</ul>
</li>
</ul>
<blockquote>
<p> 原理流程图</p>
</blockquote>
<p>1、数据存储</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(输入符号&lt;br&gt;A)--&gt;B[计算机存储]</span><br><span class="line">B--&gt;C&#123;字符集选择&#125;</span><br><span class="line">C--&gt;|ASCII|D[转码&lt;br&gt;01000001]</span><br><span class="line">C--&gt;|GBK|E[转码&lt;br&gt;0000000001000001]</span><br><span class="line">C--&gt;|ASCII 存储中文|G[转码&lt;br&gt;乱码]</span><br><span class="line">D--&gt;F((存储))</span><br><span class="line">E--&gt;F</span><br><span class="line">G--&gt;F</span><br></pre></td></tr></table></figure>

<p>2、数据读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(数据读取)--&gt;B&#123;字符集选择&#125;</span><br><span class="line">B--&gt;|ASCII|C[读1个字节&lt;br&gt;01000001]</span><br><span class="line">B--&gt;|GBK|D[读2个字节&lt;br&gt;0000000001000001]</span><br><span class="line">B--&gt;|UTF-8|G[读3个字节&lt;br&gt;错误读取]</span><br><span class="line">G--&gt;H[解析&lt;br&gt;乱码]</span><br><span class="line">C--&gt;E[解析&lt;br&gt;A]</span><br><span class="line">D--&gt;E</span><br><span class="line">E--&gt;F((输出))</span><br><span class="line">H--&gt;F</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、字符集是一套符号的总称</p>
<p>2、不同国家地区的符号有区别，所以有自己的字符集</p>
<p>3、常见的字符集目前是三个</p>
<ul>
<li>ASCII：美国信息交换标准码</li>
<li>GBK：汉字内码扩展规范（国标），兼容ASCII</li>
<li>UTF-8：8字节万国码，兼容GBK和ASCII</li>
</ul>
<p>4、目前基本都统一使用UTF-8开发和数据存储</p>
<p>5、字符集是指定字符的存储和读取的规范</p>
<ul>
<li>指定的字符集存储需要使用对应的字符集读取</li>
<li>错误的字符集存储或者读取都会产生乱码</li>
</ul>
<h3 id="2、MySQL字符集"><a href="#2、MySQL字符集" class="headerlink" title="2、MySQL字符集"></a>2、MySQL字符集</h3><p><strong>MySQL字符集</strong>：MySQL内部对于数据实际存储的字符集（服务器端）</p>
<ul>
<li>MySQL内部对象可以在各个层级设置字符集</li>
<li>MySQL内部对象存在字符集继承：字段 -&gt; 表 -&gt; 数据库 -&gt; DBMS</li>
<li>MySQL内部内嵌支持几乎所有主流字符集</li>
<li>数据存储的最终字符集由字段控制</li>
<li>客户端与服务器进行交互时，需要明确告知服务器客户端自己的字符集（数据格式）</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>查看MySQL支持的所有字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show charset;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理图</p>
</blockquote>
<p>1、数据库内部对象字符集原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(服务器数据管理)--&gt;B[DBMS系统&lt;br&gt;安装配置字符集]</span><br><span class="line">B--&gt;C[数据库&lt;br&gt;设定字符集]</span><br><span class="line">C--&gt;|继承DBMS字符集|B</span><br><span class="line">C--&gt;D[数据表&lt;br&gt;设定字符集]</span><br><span class="line">D--&gt;|继承数据库字符集|C</span><br><span class="line">D--&gt;E[数据字段&lt;br&gt;设定字符集]</span><br><span class="line">E--&gt;|继承数据表字符集|D</span><br></pre></td></tr></table></figure>

<p>1.1、服务端存储的数据最终字符集由字段确定</p>
<p>1.2、字段通常不会设置字符集，继承表的字符集（统一性，真正一般都与数据库一致）</p>
<p>1.3、数据存储的字符集与客户端的字符集没有直接关系，是由表（字段）决定</p>
<p>2、客户端存储数据原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(客户端录入数据&lt;br&gt;数据自带字符集)--&gt;B[发送服务端]</span><br><span class="line">A--&gt;|提前告知服务端客户端数据字符集&lt;br&gt;如不告知-服务器使用默认设置|C</span><br><span class="line">B--&gt;C</span><br><span class="line">C[服务端接收数据]--&gt;D[执行存储操作]</span><br><span class="line">D--&gt;E[转码为目标字符集]</span><br><span class="line">E--&gt;F((存储))</span><br></pre></td></tr></table></figure>



<p>3、客户端读取数据原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(客户端录入获取指令)--&gt;B[发送服务端]</span><br><span class="line">A--&gt;|提前告知服务端客户端数据字符集&lt;br&gt;如不告知-服务器使用默认设置|C</span><br><span class="line">B--&gt;C[服务器接收请求]</span><br><span class="line">C--&gt;D[执行获取指令&lt;br&gt;按照数据存储本身字符集获取]</span><br><span class="line">D--&gt;E[转成客户端字符集数据]</span><br><span class="line">E--&gt;F[返回客户端]</span><br><span class="line">F--&gt;G((客户端解析&lt;br&gt;只能按照自己的字符集解析))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL服务端数据存储的字符集依赖各个对象设置</p>
<ul>
<li>DBMS：设置最广，一旦设置所有对象都可以依赖，但是优先级最低</li>
<li>DB：针对数据库内的所有表，优先级高于DBMS，可以继承DBMS（一般在数据库层设置）</li>
<li>Table：针对当前表的设置，优先级高于DB，可以继承DB</li>
<li>Field：针对当前字段设置，优先级高于Table，可以继承Table，优先级最高</li>
</ul>
<p>2、通常字符集的设置都是围绕数据表（现在都在数据库层），不会到具体字段</p>
<p>3、建议使用UTF8字符集存储数据（MySQL8以后建议使用UTF8MB4）</p>
<p>4、MySQL服务端支持各种字符集，并且能够进行各种字符集转换</p>
<p>5、客户端存储数据到服务端原理</p>
<ul>
<li>客户端告知服务端客户端的字符集</li>
<li>服务端按照客户端指定的字符集接收数据（如果没有指定，使用默认，可能出现乱码）</li>
<li>服务端按照实际存储表对应的字符集进行转换</li>
<li>服务端存储数据</li>
</ul>
<p>6、客户端读取服务端数据原理</p>
<ul>
<li>客户端告知服务端客户端的字符集</li>
<li>服务端按照客户指定的指令从数据库读取原始字符集数据</li>
<li>服务端按照客户端的需求将数据进行字符转换</li>
<li>服务端发送目标数据给客户端</li>
<li>客户端按照自己的字符集进行解析</li>
</ul>
<h3 id="3、乱码问题解决"><a href="#3、乱码问题解决" class="headerlink" title="3、乱码问题解决"></a>3、乱码问题解决</h3><p><strong>乱码</strong>：指数据不能按照正确的字符集进行存储或者解析</p>
<ul>
<li>乱码原因1：数据在存储的时候已经变成乱码<ul>
<li>客户端字符集与服务端解析字符集不一致</li>
<li>读取时想转成其他字符集均会错误</li>
</ul>
</li>
<li>乱码原因2：数据存储时正确，但是读取时解析成错误字符集<ul>
<li>客户端能解析的字符集与服务器提供的字符集不一致</li>
</ul>
</li>
<li>乱码解决方案：不论存储还是读取，都提前告知服务器当前客户端的字符集</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names 客户端字符集;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、MySQL客户端（CMD打开），客户端字符集是固定的GBK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names gbk;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>流程图</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(客户端连接认证服务端)--&gt;B[设定字符集&lt;br&gt;告知服务端当前客户端的字符集]</span><br><span class="line">B--&gt;C[其他操作&lt;br&gt;内部字符集转换不用管]</span><br><span class="line">C--&gt;D((结束))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、乱码的本质原因就是客户端与服务端的字符集不一致导致</p>
<ul>
<li>客户端存储数据的时候服务端没有正确理解（服务端按照默认的存储，存储的就是乱码）</li>
<li>客户端读取的时候没有正确告知服务端（服务端按照默认的提供）</li>
</ul>
<p>2、解决乱码问题的方案：保证服务端正确理解客户端的字符集</p>
<ul>
<li>set names 客户端字符集</li>
<li>在任何数据操作之前（尤其是写数据，包括结构）</li>
</ul>
<h3 id="4、字符集设置原理"><a href="#4、字符集设置原理" class="headerlink" title="4、字符集设置原理"></a>4、字符集设置原理</h3><p><strong>字符集设置原理</strong>：服务器端正确保障对客户端的数据识别</p>
<ul>
<li>MySQL服务端提供了变量来记录客户端的字符集</li>
<li>MySQL对应的存储字符集的变量可以修改</li>
<li><code>set names 字符集</code>就是对变量的修改，总共有三个<ul>
<li>character_set_client：客户端提供的数据的字符集</li>
<li>character_set_results：客户端需要服务端提供的数据的字符集</li>
<li>character_set_connection：连接使用的字符集，内部数据操作</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查看系统内部存储这些记录字符集的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;character_set%&#39;;	#%表示通配符，匹配后续所有不确定的数据</span><br></pre></td></tr></table></figure>



<p>2、修改客户端字符集变量，保证数据正常存进服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set character_set_client &#x3D; gbk;</span><br></pre></td></tr></table></figure>



<p>3、修改客户端解析字符集变量，保证数据正常被客户端查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set character_set_results &#x3D; gbk;</span><br></pre></td></tr></table></figure>



<p>4、使用set names 字符集批量修改，保证客户端被服务端正确理解，同时客户端也能正确解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names gbk;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL字符集控制是在服务端内部通过变量连接（针对每个独立的客户端）</p>
<p>2、set names字符集是一种快捷方式，本质有三个变量被修改</p>
<ul>
<li>character_set_client：服务端接收客户端数据</li>
<li>character_set_connection：服务端内部连接使用</li>
<li>character_set_results：服务端提供数据给客户端</li>
</ul>
<p>3、通常我们都是使用set names字符集来进行统一设置，而且是在<strong>建立连接之后操作数据之前就设置</strong></p>
<h3 id="5、总结-1"><a href="#5、总结-1" class="headerlink" title="5、总结"></a>5、总结</h3><p>1、字符集是所有编程语言里都必须面对的首要问题，必须在一开始就选择好字符集（去到企业后先问清楚）</p>
<ul>
<li>业务针对的符号</li>
<li>业务针对的范围</li>
</ul>
<p>2、乱码是编程中最基础要解决的问题，一旦数据产生了乱码，通常是不可逆操作</p>
<p>3、解决乱码问题其实本质就是统一字符集问题</p>
<ul>
<li>客户端字符集：<code>character_set_client</code></li>
<li>连接层字符集：<code>character_set_connection</code></li>
<li>结果集字符集：<code>character_set_results</code></li>
<li>简单统一方式：<code>set names 客户端字符集</code></li>
<li>存储字符集：不用考虑，因为数据库有强大的字符集转换能力，只要在开始设置好，保证后续数据不会超出字符集即可</li>
</ul>
<h2 id="3-2-校对集"><a href="#3-2-校对集" class="headerlink" title="3.2 校对集"></a>3.2 校对集</h2><h3 id="1、校对集概念"><a href="#1、校对集概念" class="headerlink" title="1、校对集概念"></a>1、校对集概念</h3><p><strong>校对集</strong>：collate/collation，即数据比较时对应的规则</p>
<ul>
<li>校对集依赖字符集</li>
<li>校对集的校对方式分为三种<ul>
<li>大小写不敏感：_ci，case insensitive（不区分大小写）</li>
<li>大小写敏感：_cs，case sensitive（区分大小写）</li>
<li>二进制比较：_bin，binary（区分大小写）</li>
</ul>
</li>
<li>校对集是在进行数据比较的时候触发</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、_ci，大小写不敏感</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A 与 a 是相同的，不存在谁大谁小（系统会转换成一种）</span><br></pre></td></tr></table></figure>



<p>2、_cs，大小写敏感</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A 与 a 有大小关系，所以不同（存储数值）</span><br></pre></td></tr></table></figure>



<p>3、_bin，二进制比较</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A的二进制是01000001</span><br><span class="line">a的二进制是01100001</span><br><span class="line">二进制按位比较，所以不同</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、校对集是数据比较的规则</p>
<ul>
<li><p>校对集依赖字符集存在</p>
</li>
<li><p>每个字符集有多种校对规则</p>
</li>
</ul>
<p>2、校对规则一共有三种</p>
<ul>
<li>_ci：大小写不敏感，不区分大小写</li>
<li>_cs：大小写敏感，区分大小写</li>
<li>_bin：二进制比较（区分大小写）</li>
</ul>
<h3 id="2、校对集设置"><a href="#2、校对集设置" class="headerlink" title="2、校对集设置"></a>2、校对集设置</h3><p><strong>校对集设置</strong>：在创建数据表的时候创建校对规则</p>
<ul>
<li>校对规则可以在MySQL四层对象设计<ul>
<li>DBMS：系统配置</li>
<li>DB：数据库指定（库选项）</li>
<li>Table：表指定（表选项）</li>
<li>Field：字段指定（字段选项，一般不用）</li>
</ul>
</li>
<li>校对集从Field到DBMS继承；优先级Field最高</li>
<li>每个校对集都有字符集对应的默认规则</li>
<li>校对集设置语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collate 校对集规则;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、查看MySQL支持的所有校对集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show collation;</span><br></pre></td></tr></table></figure>



<p>2、在数据库层设计校对集（常见）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database db_4 charset utf8mb4 collate utf8mb4_bin;</span><br></pre></td></tr></table></figure>



<p>3、在数据表层设计校对集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table t_4(</span><br><span class="line">    id int,</span><br><span class="line">    name varchar(10)</span><br><span class="line">)charset utf8mb4 collate utf8mb4_bin;</span><br></pre></td></tr></table></figure>



<p>4、在字段层设计校对集（一般不常用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table t_5(</span><br><span class="line">    id int,</span><br><span class="line">    name varchar(10) collate utf8mb4_bin</span><br><span class="line">)charset utf8mb4;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL中四层对象都可以设置校对集</p>
<ul>
<li>DBMS：配置文件</li>
<li>DB：创建数据库时限定（设置）</li>
<li>Table：创建表示限定</li>
<li>Field：创建字段时限定</li>
</ul>
<p>2、校对集从Field到DBMS实现继承</p>
<p>3、校对集依赖字符集，且每个字符集都有默认的校对集（一般情况不需要设置）</p>
<h3 id="3、校对集应用"><a href="#3、校对集应用" class="headerlink" title="3、校对集应用"></a>3、校对集应用</h3><p><strong>校对集应用</strong>：触发校对规则的使用</p>
<ul>
<li>校对集的应用通常是通过<strong>数据比较</strong>触发：<code>order by 字段</code></li>
<li>数据表中数据一旦产生，校对集的修改就无效</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建校对规则数据表并插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建默认校对规则表（不区分大小写）</span><br><span class="line">create table t_4(</span><br><span class="line">    name varchar(1)</span><br><span class="line">)charset utf8mb4;</span><br><span class="line">insert into t_4 values(&#39;B&#39;);</span><br><span class="line">insert into t_4 values(&#39;A&#39;);</span><br><span class="line">insert into t_4 values(&#39;b&#39;);</span><br><span class="line">insert into t_4 values(&#39;a&#39;);</span><br><span class="line"></span><br><span class="line"># 创建二进制校对规则（区分大小写）</span><br><span class="line">create table t_5(</span><br><span class="line">    name varchar(1)</span><br><span class="line">)charset utf8mb4 collate utf8mb4_bin;</span><br><span class="line">insert into t_5 values(&#39;B&#39;);</span><br><span class="line">insert into t_5 values(&#39;A&#39;);</span><br><span class="line">insert into t_5 values(&#39;b&#39;);</span><br><span class="line">insert into t_5 values(&#39;a&#39;);</span><br></pre></td></tr></table></figure>



<p>2、触发校对：排序 order by</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_4 order by name; # 升序</span><br><span class="line">select * from t_5 order by name;</span><br></pre></td></tr></table></figure>



<p>3、数据已经存在的表重新修改校对规则无效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_5 collate utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、校对集的应用不是主动触发，而是通过数据比较自动触发</p>
<p>2、校对集对应的数据一旦产生，那么就不可以修改数据表的校对规则</p>
<p>3、校对集通常使用字符集默认校对集，如果需要进行额外的比较应用（通常是区分大小写），那么需要在建表的时候设定好目标校对规则</p>
<h3 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h3><p>1、校对集是数据比较的标准</p>
<p>2、校对集的校对规则都是依赖字符集存在的，不外乎三种规则</p>
<ul>
<li>_ci：不区分大小写</li>
<li>_cs：区分大小写</li>
<li>_bin：二进制比较（区分大小写）</li>
</ul>
<p>3、校对集的触发是自动的，只要数据在进行比较的时候就会自动触发设定的校对规则</p>
<ul>
<li>校对集的维护要在数据产生之前</li>
<li>数据产生之后校对集的修改将无效</li>
</ul>
<p>4、在进行数据表设计之前，要提前了解数据后续可能产生的比较形态，选择好合适的校对规则（一般都默认不区分大小写）</p>
<h1 id="4-MySQL数据库字段详解"><a href="#4-MySQL数据库字段详解" class="headerlink" title="4 MySQL数据库字段详解"></a>4 MySQL数据库字段详解</h1><h2 id="4-1-字段类型"><a href="#4-1-字段类型" class="headerlink" title="4.1 字段类型"></a>4.1 字段类型</h2><h3 id="1、字段类型作用"><a href="#1、字段类型作用" class="headerlink" title="1、字段类型作用"></a>1、字段类型作用</h3><p><strong>字段类型</strong>：MySQL中用来规定实际存储的数据格式</p>
<ul>
<li>字段类型在定义表结构时设定</li>
<li>设定好字段类型后，插入数据时必须与字段类型对应，否则数据错误</li>
<li>MySQL有四大数据类型<ul>
<li>整数类型</li>
<li>小数类型</li>
<li>字符串类型</li>
<li>时间日期类型</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>规定类型的字段只能插入相应的数据格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 正确数据类型插入</span><br><span class="line">insert into t_6 values(3,&#39;444111222211110101&#39;,&#39;Lily&#39;,&#39;Lee&#39;);</span><br><span class="line"></span><br><span class="line"># 错误数据类型插入</span><br><span class="line">insert into t_6 values(&#39;hello&#39;,&#39;444444222211110102&#39;,&#39;Lucy&#39;,&#39;Lu&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、字段类型的作用就是强制规范录入的数据格式</p>
<ul>
<li>规范数据的格式</li>
<li>保证数据的有效性</li>
</ul>
<p>2、MySQL中有四种数据类型规范</p>
<ul>
<li>整数类型：只能存储整数</li>
<li>小数类型：可以存储有效数值</li>
<li>字符串类型：存储字符串数据</li>
<li>时间日类类型：存储时间日期格式数据</li>
</ul>
<h3 id="2、整数类型"><a href="#2、整数类型" class="headerlink" title="2、整数类型"></a>2、整数类型</h3><p><strong>整数类型</strong>：有效的整数数据</p>
<ul>
<li>MySQL中为了<strong>数据空间</strong>的有效使用，设定了五种整数类型<ul>
<li>迷你整型：tinyint，使用<strong>1个字节</strong>存储整数，最多存储256个整数（-128~127）</li>
<li>短整型：smallint，使用<strong>2个字节</strong>存储整数</li>
<li>中整型：mediumint，使用<strong>3个字节</strong>存储整数</li>
<li>标准整型：int，使用<strong>4个字节</strong>存储整数</li>
<li>大整型：bigint，使用<strong>8个字节</strong>存储</li>
</ul>
</li>
<li>数值型存储在MySQL中分为有符号（有负数）和无符号（纯正数）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据的格式是存储整数</p>
<p>2、预估整数的范围，选择合适的整数类型</p>
<p>3、确定整数是否需要符号（负数区间）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、设计一个表记录个人信息：年龄、头发数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 年龄：没有负数，正常年龄也不超过200岁，迷你整型无符号即可</span><br><span class="line"># 头发数量：没有负数，大概在几百万根，所以标准整型无符号即可</span><br><span class="line">create table t_7(</span><br><span class="line">    age tinyint unsigned, # unsigned修饰整数，表示无符号（从0开始）</span><br><span class="line">    haircount int unsigned</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>

<p>2、设计一个表记录4S店的汽车销量信息：库存数量、销量、采购量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 4S店经常是先卖后进货，所以库存可能为负数，一个店铺的库存数通常不会太多，那么小整型即可</span><br><span class="line"># 销量通常全国一个月也就几万台，所以基本上小整型就够了，但是为了保证后续可能存在的爆发，那么中整型也是绝对够了的，而且不会是负数</span><br><span class="line"># 采购通常是正向采购，所以不会出现负数，而采购数量与销量持平就好</span><br><span class="line"></span><br><span class="line">create table t_8(</span><br><span class="line">    stock smallint,</span><br><span class="line">    sales mediumint unsigned,</span><br><span class="line">    purchase mediumint unsigned</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、整型是用来存储整数数据的</p>
<p>2、整数数据也需要根据业务大小来选择合适的存储方式</p>
<ul>
<li>迷你整型：存储数量不超过1个字节表示范围</li>
<li>小整型：存储数量不超过2个字节表示范围</li>
<li>中整型：存储数量不超过3个字节表示范围</li>
<li>整型：存储数量不超过4个字节表示范围</li>
<li>大整型：存储数量不超过8个字节表示范围</li>
</ul>
<p>3、数值型类型在MySQL中默认是有符号的，即有正负</p>
<ul>
<li>无符号需要使用unsigned修饰整型，即纯正数</li>
</ul>
<p>4、一般开发中不会太计较一个或者两个字节（不愿意算），所以tinyint和int居多，其他较少</p>
<h3 id="3、显示宽度"><a href="#3、显示宽度" class="headerlink" title="3、显示宽度"></a>3、显示宽度</h3><p><strong>显示宽度</strong>：int(L)，整数在数据库中显示的符号（数字+符号）个数</p>
<ul>
<li>显示宽度一般是类型能表示的最大值对应的数字个数（通过desc查看表字段显示）</li>
<li>显示宽度包含符号（如果允许为负数，<code>-</code>负号会增加一个宽度）</li>
<li>显示宽度可以主动控制：创建字段时加括号确定</li>
<li>显示宽度不会影响类型能表示的最大数值</li>
<li>可以通过<strong>zerofill</strong>让不够宽度的数值补充到对应宽度：在字段类型后使用zerofill</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、有符号和无符号对应的宽度不一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table t_9(</span><br><span class="line">    a tinyint,</span><br><span class="line">    b tinyint unsigned</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>

<p>2、可以主动控制显示宽度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_9 add c tinyint(2) unsigned;</span><br></pre></td></tr></table></figure>

<p>3、显示宽度不影响数据的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_9 values(1,1,1); #小于显示宽度</span><br><span class="line">insert into t_9 values(100,100,100); #大于显示宽度</span><br></pre></td></tr></table></figure>

<p>4、可以通过erofill让小于显示宽度的数值前置补充0到显示宽度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table t_9 add d tinyint(2) zerofill; # 0填充只能针对正数</span><br><span class="line">insert into t_9 values(1,1,1,1);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、显示宽度是显示整型能表示的最多符号数量</p>
<p>2、显示宽度能主动设置，但是绝对不会改变类型本身能表示的数据大小</p>
<p>3、可以通过zerofill来强制让不够宽度的数据补充前置0来达到显示宽度</p>
<ul>
<li>zerofill默认要求整型为无符号</li>
<li>zerofill通常用来制作一些规范宽度的数据</li>
</ul>
<h3 id="4、小数类型（浮点型）"><a href="#4、小数类型（浮点型）" class="headerlink" title="4、小数类型（浮点型）"></a>4、小数类型（浮点型）</h3><p><strong>浮点数</strong>：float/double，存储不是特别精确的数值数据</p>
<ul>
<li>浮点数又称之为精度数据，分为两种<ul>
<li>单精度：float，使用4个字节存储，精度范围为6-7位有效数字</li>
<li>双精度：double，使用8个字节存储，精度范围为14-15位有效数字</li>
</ul>
</li>
<li>浮点数超过精度范围会自动进行<strong>四舍五入</strong></li>
<li>精度可以指定整数和小数部分<ul>
<li>默认不指定，整数部分不超过最大值，小数部分保留2位</li>
<li>可以指定：float/double(总长度,小数部分长度)</li>
</ul>
</li>
<li>可以使用科学计数法插入数据：AEB，A * 10 ^ B</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定当前设计的字段的数据为不精确型数据（或者小数）</p>
<p>2、确定数据的大小或者精度的要求范围</p>
<ul>
<li>6-7位有效数字使用float</li>
<li>14-15位有效数字使用double</li>
</ul>
<p>3、确定精度的分布：整数部分和小数部分</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录宇宙中恒星、行星的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 数量属于不确定量级，所以精确的数据是无意义的，只能是个大概（绝大部分时候float就可以）</span><br><span class="line">create table t_10(</span><br><span class="line">    h_star float unsigned,</span><br><span class="line">    x_star float(20,0) unsigned</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_10 values(1234567890,1.2E10);</span><br></pre></td></tr></table></figure>



<p>2、记录商品的价格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 商品名字字符串</span><br><span class="line"># 商品价格一般都允许带小数</span><br><span class="line">create table t_11(</span><br><span class="line">    goods_name varchar(20),</span><br><span class="line">    goods_price float</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_11 values(&#39;Nokia3310&#39;,199.99);</span><br><span class="line">insert into t_11 values(&#39;Nokia6100&#39;,1999.9999);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、浮点数是用来记录一些不需要特别精确的数值或者小数数值的</p>
<ul>
<li>float：单精度，6-7位有效数字</li>
<li>double：双精度，14-15位有效数字</li>
</ul>
<p>2、浮点数能够表示很大的数值</p>
<p>3、浮点数可以指定整数部分和小数部分的有效数值区间</p>
<ul>
<li>float/double<ul>
<li>默认是整数不超过最大范围即可</li>
<li>小数部分保留2位有效数字</li>
</ul>
</li>
<li>float/double(有效数位,小数部分有效位)<ul>
<li>整数部分为有效数位 - 小数部分</li>
<li>数值如果超过整数部分就不让插入</li>
</ul>
</li>
</ul>
<p>4、因为浮点数会自动四舍五入，所以不要使用浮点数来存储对精度要求较高的数值</p>
<h3 id="5、小数类型（定点型）"><a href="#5、小数类型（定点型）" class="headerlink" title="5、小数类型（定点型）"></a>5、小数类型（定点型）</h3><p><strong>定点型</strong>：decimal，能够保证精度的小数</p>
<ul>
<li>不固定存储空间存储</li>
<li>每9个数字使用4个字节存储</li>
<li>定点型可以指定整数部分长度和小数部分长度<ul>
<li>默认不指定，10位有效整数，0位小数</li>
<li>可以指定：decimal(有效数位,小数部分数位)</li>
<li>有效数位不超过65个</li>
</ul>
</li>
<li>数据规范<ul>
<li>整数部分超出报错</li>
<li>小数部分超出四舍五入</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定小数是否需要保证精度</p>
<p>2、确定有效数位长度</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录个人资产情况：资产和负债</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 资产和负债应该都是精确的，小数部分可以到分</span><br><span class="line">create table t_12(</span><br><span class="line">    money decimal(14,2),</span><br><span class="line">    bet decimal(10,2)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_12 values(1111111111.12,1111111.999);</span><br><span class="line">insert into t_12 values(1111111111.12,99999999.999); # 错误：进位导致正数部分超过指定范围</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、定点数是用来存储精确的小数的</p>
<p>2、定点数可以指定长度</p>
<ul>
<li>decimal：默认<ul>
<li>整数部分为10位</li>
<li>小数部分为0</li>
</ul>
</li>
<li>decimal(有效位数,小数位数)<ul>
<li>整数部分为：有效位数 - 小数位数</li>
<li>有效数位不超过65个</li>
</ul>
</li>
</ul>
<p>3、定点数的存储模式不是固定长度，所以数据越大占用的存储空间越长</p>
<h3 id="6、字符串类型（定长型）"><a href="#6、字符串类型（定长型）" class="headerlink" title="6、字符串类型（定长型）"></a>6、字符串类型（定长型）</h3><p><strong>定长型</strong>：char(L)，指定固定长度的存储空间存储字符串</p>
<ul>
<li>定长是指定存储长度</li>
<li>定长的长度是字符而不是字节<ul>
<li>L的最大值是255</li>
<li>实际存储空间：L字符数 * 字符集对应字节数</li>
</ul>
</li>
<li>定长里存储的数据不能超过指定长度，但是可以小于指定长度</li>
<li>字符串数据使用单引号或者双引号包裹</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据类型为字符串（或不能用整数存储的超长数字符号）</p>
<p>2、确定数据长度基本一致（定长占用固定空间）</p>
<p>3、确定具体长度</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录个人信息：身份证信息和手机号码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 身份证为固定长度18位（数字）</span><br><span class="line"># 手机号码是11位固定长度（数字）</span><br><span class="line">create table t_13(</span><br><span class="line">    id_number char(18),</span><br><span class="line">    phone_number char(11)</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_13 values(&#39;440111999912120304&#39;,&#39;13512345678&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、定长是固定存储空间</p>
<ul>
<li>实际存储空间：L字符 * 字符集对应字节数</li>
</ul>
<p>2、定长对应的是字符长度，而不是字节长度</p>
<p>3、字符串数据需要使用引号包裹具体数据</p>
<p>4、定长的访问效率较高，但是空间利用率不高</p>
<ul>
<li><p>固定长度的数据使用定长</p>
</li>
<li><p>定长最大数据长度指定不超过255字符</p>
</li>
</ul>
<h3 id="7、字符串类型（变长型）"><a href="#7、字符串类型（变长型）" class="headerlink" title="7、字符串类型（变长型）"></a>7、字符串类型（变长型）</h3><p><strong>变长型</strong>：varchar(L)，根据实际存储的数据变化存储空间</p>
<ul>
<li>变长型的存储空间是由实际存储数据决定的</li>
<li>变长型的L也是指<strong>字符</strong>而不是字节<ul>
<li>L指定的是最大存储的数据长度</li>
<li>L最大值理论是65535</li>
<li>变长需要额外产生1-2个字节，用来记录实际数据的长度<ul>
<li>数据长度小于256个，多1个字节</li>
<li>数据长度大于256个，多2个字节</li>
</ul>
</li>
<li>实际存储空间：实际字符数 * 字符集对应字节数 + 记录长度</li>
</ul>
</li>
<li>变长数据不能超过定义的最大长度</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据类型为字符串</p>
<p>2、确定数据是不规则的数据</p>
<p>3、确定最大长度</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录个人信息：用户名、密码、姓名、身份证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 用户名不确定长度，最长不超过50个字符</span><br><span class="line"># 密码不确定长度，最潮超过15个字符</span><br><span class="line"># 姓名不确定长度，最长不超过10个字符</span><br><span class="line"># 身份证固定长度，18个字符</span><br><span class="line">create table t_14(</span><br><span class="line">    &#96;username&#96; varchar(50),</span><br><span class="line">    &#96;password&#96; varchar(15),</span><br><span class="line">    &#96;name&#96; varchar(10),</span><br><span class="line">    &#96;id_number&#96; char(18)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_14 values(&#39;username&#39;,&#39;password&#39;,&#39;name&#39;,&#39;444111999912121111&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、变长varchar是根据<strong>数据的长度实际计算存储空间</strong></p>
<p>2、变长需要规定数据的最大长度，理论长度为65535个字符</p>
<p>3、变长字符串能够更好的利用存储空间</p>
<p>4、变长字符串需要有额外1-2个字节存储数据长度</p>
<ul>
<li>不超过256个字符：1个字节</li>
<li>超过256个字符：2个字节</li>
</ul>
<p>5、变长字符串在读取时需要进行长度计算，所以效率没有定长字符串高</p>
<h3 id="8、字符串类型（文本字符串）"><a href="#8、字符串类型（文本字符串）" class="headerlink" title="8、字符串类型（文本字符串）"></a>8、字符串类型（文本字符串）</h3><p><strong>文本字符串</strong>：text/blob，专门用来存储较长的文本</p>
<ul>
<li>文本字符串通常在超过255个字符时使用</li>
<li>文本字符串包含两大类<ul>
<li>text：普通字符<ul>
<li>tinytext：迷你文本，不超过<code>2 ^ 8 -1</code>个字符</li>
<li>text：普通文本，不超过 <code>2 ^ 16 - 1</code>个字符</li>
<li>mediumtext：中型文本，不超过 <code>2 ^ 24 - 1</code> 个字符</li>
<li>longtext：长文本，不超过 <code>2 ^ 32 - 1</code> 个字符（4G）</li>
</ul>
</li>
<li>blob：二进制字符（与text类似）<ul>
<li>tinyblob</li>
<li>blob</li>
<li>mediumblob</li>
<li>longblob</li>
</ul>
</li>
</ul>
</li>
<li>文本字符串会自动根据文本长度选择适合的具体类型</li>
<li>一般在文本超过255个字符时，都会使用text（blob现在极少使用）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定类型为文本类型</p>
<p>2、确定数据长度可能超过255个字符</p>
<p>3、使用text</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录新闻信息：标题、作者和内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 标题一般不会超过50个字符，varchar</span><br><span class="line"># 作者一般不会超过10个字符：varchar</span><br><span class="line"># 内容通常都很长，使用text</span><br><span class="line">create table t_15(</span><br><span class="line">    author varchar(10),</span><br><span class="line">    title varchar(50),</span><br><span class="line">    content text</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_15 values(&#39;佚名&#39;,&#39;给联合国的一封信&#39;,&#39;给联合国的一封信...&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、文本类型是专门用来存储长文本的</p>
<ul>
<li>text：普通文本字符</li>
<li>blob：二进制文本字符</li>
</ul>
<p>2、一般文本长度超过255的（较长）都使用text</p>
<p>3、text/blob根据数据存储长度有很多种，但是一般使用text/blob，因为文本会根据数据长度自适应选择</p>
<h3 id="9、字符串类型（枚举）"><a href="#9、字符串类型（枚举）" class="headerlink" title="9、字符串类型（枚举）"></a>9、字符串类型（枚举）</h3><p><strong>枚举</strong>：一种映射存储方式，以较小的空间存储较多的数据</p>
<ul>
<li>枚举是在定义时确定可能出现的可能</li>
<li>枚举在定义后数据只能出现定义时其中的一种</li>
<li>枚举类似一种单选框</li>
<li>枚举使用1-2个字节存储，最多可以设计65535个选项</li>
<li>枚举实际存储是使用数值，映射对应的元素数据，从1开始</li>
<li>枚举语法：enum(元素1,元素2,…元素N)</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据是固定的几种数据之一</p>
<p>2、使用枚举穷举相应的元素</p>
<p>3、数据存储只能选择穷举中的元素之一</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录人群类型：小朋友、少年、青年、中年、老年，每个人实际只属于一种类别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 要保证未来数据只能出现在某种可能中，所以要先列出来，可以使用enum</span><br><span class="line">create table t_16(</span><br><span class="line">    type enum(&#39;小朋友&#39;,&#39;少年&#39;,&#39;青年&#39;,&#39;中年&#39;,&#39;老年&#39;)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_16 values(&#39;少年&#39;);</span><br><span class="line">insert into t_16 values(&#39;仙人&#39;);	# 不存在的数据不能插入</span><br></pre></td></tr></table></figure>



<p>2、enum是建立映射关系，然后实际存储是数字，数值是按照元素顺序从1开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 可以使用字段 + 0来判定数据具体的效果（字符串转数值为0）</span><br><span class="line">select type,type + 0 from t_16;</span><br><span class="line">insert into t_16 values(5);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>流程原理</p>
</blockquote>
<p>1、枚举定义原理</p>
<table>
<thead>
<tr>
<th>枚举数据</th>
<th>映射值</th>
</tr>
</thead>
<tbody><tr>
<td>数据1</td>
<td>1</td>
</tr>
<tr>
<td>数据2</td>
<td>2</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>数据N</td>
<td>N（小于65535）</td>
</tr>
</tbody></table>
<p>2、数据存储（读取反过来）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(指令开始)--&gt;B[插入数据]</span><br><span class="line">B--&gt;C[读取映射关系&lt;br&gt;元素&#x3D;&#x3D;数值&lt;br&gt;数值&#x3D;&#x3D;数值]</span><br><span class="line">C--&gt;D[数值存储到字段]</span><br><span class="line">D--&gt;E((结束))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、枚举是在定义时确定可能出现的元素，而后数据只能出现规定的元素之一的数据类型</p>
<p>2、枚举的存储是一种映射关系，对元素进行顺序编号，实际存储的是编号</p>
<p>3、使用枚举的作用</p>
<ul>
<li>规范数据模型</li>
<li>优化存储空间</li>
</ul>
<h3 id="10、字符串类型（集合）"><a href="#10、字符串类型（集合）" class="headerlink" title="10、字符串类型（集合）"></a>10、字符串类型（集合）</h3><p><strong>集合</strong>：set，一种映射存储方式，以较小的空间存储较多的数据</p>
<ul>
<li>集合是在定义时确定可能出现的元素进行穷举</li>
<li>集合在定义后数据只能出现定义时其中的元素（可以是多个）</li>
<li>集合类似一种多选框</li>
<li>集合使用1-8个字节存储数据，最多可以设计64个元素</li>
<li>集合实际存储是使用数值（二进制位），映射对应的元素数据，每个元素对应一个比特位</li>
<li>集合语法：set(元素1,元素2,…元素N)</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据是固定的几种数据组合</p>
<p>2、使用集合穷举相应的元素</p>
<p>3、数据存储只能选择穷举中的元素组合（多个使用逗号分隔）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录个人的球类爱好，有篮球、足球、羽毛球、网球、乒乓球、排球、台球、冰球</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 爱好可以是多种，并非固定的，但是只能从规定的类型中选择</span><br><span class="line">create table t_17(</span><br><span class="line">    hobby set(&#39;足球&#39;,&#39;篮球&#39;,&#39;羽毛球&#39;,&#39;网球&#39;,&#39;乒乓球&#39;,&#39;排球&#39;,&#39;台球&#39;,&#39;冰球&#39;)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_17 values(&#39;足球&#39;);</span><br><span class="line">insert into t_17 values(&#39;冰球,台球,篮球&#39;);</span><br></pre></td></tr></table></figure>



<p>2、集合建立的也是映射关系，映射方式是每个元素对应一个字节的比特位，从左边开始第一个对应字节从右边开始的第一位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 可以通过字段 + 0的方式查看存储的具体数值</span><br><span class="line">select hobby,hobby + 0 from t_17;</span><br><span class="line"></span><br><span class="line"># 可以通过插入数值来组合元素，但是需要确定对应的十进制转换成二进制有对应的元素对应</span><br><span class="line">insert into t_17 values(8);</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line"> 8:00001000</span><br><span class="line"> </span><br><span class="line"> 1:00000001</span><br><span class="line"> </span><br><span class="line"> 冰球、台球、篮球</span><br><span class="line"> 11000010 &#x3D;&gt; 1 + 2 ^ 1 + 1 * 2 ^ 6 + 1 * 2 ^ 7 &#x3D; 2 + 64 + 128 &#x3D; 194</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>流程原理</p>
</blockquote>
<p>1、集合定义原理</p>
<table>
<thead>
<tr>
<th>集合数据</th>
<th>映射位</th>
</tr>
</thead>
<tbody><tr>
<td>数据1</td>
<td>00000001</td>
</tr>
<tr>
<td>数据2</td>
<td>00000010</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>数据8</td>
<td>10000000</td>
</tr>
</tbody></table>
<p>2、数据存储（读取反过来）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(指令开始)--&gt;B[插入数据]</span><br><span class="line">B--&gt;C[读取映射关系&lt;br&gt;元素选中&#x3D;&#x3D;位值为1&lt;br&gt;元素未选中&#x3D;&#x3D;位值为0]</span><br><span class="line">C--&gt;D[转化成十进制存储]</span><br><span class="line">D--&gt;E((结束))</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、集合是在定义时确定可能出现的元素，而后数据只能出现规定的元素数据类型</p>
<p>2、集合的存储是一种映射关系，每个元素对应字节中的一个位，实际存储的是编号</p>
<ul>
<li>数据存在：对应位为1</li>
<li>数据不存在：对应位为0</li>
</ul>
<p>3、使用集合的作用</p>
<ul>
<li>规范数据模型</li>
<li>优化存储空间</li>
</ul>
<h3 id="11、时间日期类型（年）"><a href="#11、时间日期类型（年）" class="headerlink" title="11、时间日期类型（年）"></a>11、时间日期类型（年）</h3><p><strong>年</strong>：year，MySQL中用来存储年份的类型</p>
<ul>
<li>MySQL中使用1个字节存储年份</li>
<li>year能够表示的范围是1901-2155年（256年）<ul>
<li>year的特殊值是：0000</li>
</ul>
</li>
<li>year允许用户使用两种方式设计（效果一样）<ul>
<li>year</li>
<li>year(4)</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定存储的数据是年份</p>
<p>2、确定年份的区间在1901-2155之间</p>
<p>3、使用year类型</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录个人的出生年份</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table t_18(</span><br><span class="line">    y1 year,</span><br><span class="line">    y2 year(4)</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_18 values(1901,2155);</span><br></pre></td></tr></table></figure>



<p>2、Year类型允许使用2位数来插入，系统会自动匹配对应的年份</p>
<ul>
<li>69以前：系统加上2000</li>
<li>69以后：系统加上1900</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_18 values(69,70);</span><br></pre></td></tr></table></figure>



<p>3、Year类型的特殊值是0000，可以使用00或者0000插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_18 values(00,0000);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、year类型是MySQL用来存储年份信息的</p>
<p>2、year使用1个字节，所以只能表示256个年号，表示区间为1901-2155年</p>
<p>3、year数据可以用两种方式插入</p>
<ul>
<li>直接插入4位年，1901-2155之间都可以</li>
<li>插入2位年，0-99之间，系统会自动以69和70为界限</li>
</ul>
<p>4、因为year字段表示的范围有限，所以通常会使用字符串来存储（牺牲空间换安全）</p>
<h3 id="12、时间日期类型（时间戳）"><a href="#12、时间日期类型（时间戳）" class="headerlink" title="12、时间日期类型（时间戳）"></a>12、时间日期类型（时间戳）</h3><p><strong>时间戳</strong>：timestamp，基于格林威治时间的时间记录</p>
<ul>
<li>MySQL中时间戳表现形式不是秒数，而是年月日时分秒格式<ul>
<li>YYYY-MM-DD HH:II::SS</li>
<li>YYYYMMDDHHIISS</li>
</ul>
</li>
<li>timestamp使用4个字节存储</li>
<li>timestamp的特点是所对应的记录不论哪个字段被更新，该字段都会更新到当前时间</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定类型需要使用年月日时分秒格式</p>
<p>2、确定当前字段需要记录数据的最近更新时间</p>
<p>3、使用timestamp时间戳</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录商品库存的最后更新时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table t_19(</span><br><span class="line">    goods_name varchar(10),</span><br><span class="line">    goods_inventory int unsigned,</span><br><span class="line">    change_time timestamp</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_19 values(&#39;Nokia3110&#39;,100,&#39;1971-01-01 00:00:00&#39;);</span><br><span class="line">insert into t_19 values(&#39;Nokia7100&#39;,100,&#39;19710101000000&#39;);</span><br></pre></td></tr></table></figure>



<p>2、timestamp会在自己所在的记录任何位置被修改时自动更新时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_19 set goods_inventory &#x3D; 90;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在MySQL8以后，取消了timestamp的默认自动更新，如果需要使用，需要额外使用属性： on update current_timestamp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table t_19 add c_time timestamp on update current_timestamp;</span><br><span class="line"></span><br><span class="line">update t_19 set goods_inventory &#x3D; 80;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、timestamp是用以时间戳的形式来保存时间的</p>
<ul>
<li>时间戳算法是从格林威治时间开始</li>
<li>MySQL中存储的是年月日时分秒格式</li>
</ul>
<p>2、timestamp使用4个字节存储数据</p>
<ul>
<li>表示范围是1971年1月1日0时0分0秒-2155年12月31日23是59分59秒</li>
<li>timestamp可以使用0000-00-00 00:00:00</li>
</ul>
<p>3、timestamp一般用来记录数据变化的，其他时候通常用整型保存真正的时间戳</p>
<ul>
<li>timestamp在MySQL8中需要主动使用on update current_timestamp才会自动更新</li>
</ul>
<h3 id="13、时间日期类型（日期）"><a href="#13、时间日期类型（日期）" class="headerlink" title="13、时间日期类型（日期）"></a>13、时间日期类型（日期）</h3><p><strong>日期</strong>：date，用来记录年月日信息</p>
<ul>
<li>使用3个字节存储数据</li>
<li>存储日期的格式为：YYYY-MM-DD</li>
<li>存储的范围是：1001-01-01~9999-12-31</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定存储的数据格式为日期类格式</p>
<p>2、确定数据格式为YYYY-MM-DD</p>
<p>3、使用date类型</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录个人生日</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t_20(</span><br><span class="line">    name varchar(10),</span><br><span class="line">    birth date</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_20 values(&#39;Jim&#39;,&#39;2000-12-12&#39;);</span><br><span class="line">insert into t_20 values(&#39;Tom&#39;,&#39;10011212&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、日期date是用来存储YYYY-MM-DD格式的日期的</p>
<p>2、date用3个字节存储，存储区间是1000 - 9999年，跨度很大</p>
<p>3、date可以在需要存储日期的地方放心使用</p>
<h3 id="14、时间日期类型（日期时间）"><a href="#14、时间日期类型（日期时间）" class="headerlink" title="14、时间日期类型（日期时间）"></a>14、时间日期类型（日期时间）</h3><p><strong>日期时间</strong>：datetime，用来综合存储日期和时间</p>
<ul>
<li>使用8个字节存储数据</li>
<li>存储格式为：YYYY-MM-DD HH:II:SS</li>
<li>存储区间为：1000-01-01 00:00:00 到9999-12-31 23:59:59</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要存储的时间格式包含日期</p>
<p>2、确定存储格式为：YYYY-MM-DD HH:II:SS</p>
<p>3、使用datetime</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录个人具体的出生时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t_21(</span><br><span class="line">    name varchar(10),</span><br><span class="line">    birth datetime</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_21 values(&#39;Jim&#39;,&#39;2000-12-12 12:12:12&#39;);</span><br><span class="line">insert into t_21 values(&#39;Tom&#39;,&#39;10011212182323&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、日期时间是综合存储日期和时间两部分的</p>
<p>2、日期时间datetime使用8个字节存储</p>
<p>3、datetime的存储区间为：1000-01-01 00:00:00 到 9999-12-12 23:59:59</p>
<p>4、实际开发中因为编程语言（PHP）的强大，实际存储的时候通常不会使用这种类型</p>
<ul>
<li>占用较大存储空间</li>
<li>处理不够灵活（固定格式）</li>
<li>使用int unsigned存储时间戳然后利用PHPdate进行格式处理</li>
</ul>
<h3 id="15、时间日期类型（时间）"><a href="#15、时间日期类型（时间）" class="headerlink" title="15、时间日期类型（时间）"></a>15、时间日期类型（时间）</h3><p><strong>时间</strong>：time，用来记录时间或者时间段</p>
<ul>
<li>使用3个字节存储数据</li>
<li>数据范围是 <code>-838:59:59</code> - <code>838:59:59</code></li>
<li>数据插入的格式分为两种<ul>
<li>时间格式：[H]HH:II:SS（[]表示可以没有）</li>
<li>时间段格式：D HH:II:SS（D表示天）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要存储的类型是时间格式</p>
<p>2、确定格式类型为time能表示的格式</p>
<p>3、使用time存储</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>记录用户登录的具体时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 具体登录时间可以使用时间戳（包含年月日时分秒信息）</span><br><span class="line"># 也可以时间datetime格式，或者date+time双字段格式（具体后面学习范式时会知道该怎么用）</span><br><span class="line">create table t_22(</span><br><span class="line">    login_time1 int unsigned,</span><br><span class="line">    login_time2 datetime,</span><br><span class="line">    login_date date,</span><br><span class="line">    login_time3 time</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_22 values(12345678,&#39;2000-12-12 12:12:12&#39;,&#39;2000-12-12&#39;,&#39;12:12:12&#39;);</span><br><span class="line">insert into t_22 values(1234567,&#39;2000-12-12 12:12:12&#39;,&#39;2000-12-12&#39;,&#39;3 12:12:12&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、时间格式time主要用来记录时间点或者时间段</p>
<p>2、time类型通常被用来做时间段计算：如多少天后的什么时间点（可以理解为过期检查）</p>
<h3 id="16、总结"><a href="#16、总结" class="headerlink" title="16、总结"></a>16、总结</h3><p>1、字段类型是用来规范数据的格式的</p>
<p>2、MySQL中有很多类型用来规范数据格式</p>
<ul>
<li>整数类型（常用）<ul>
<li>常用类型：tinyint、int</li>
</ul>
</li>
<li>小数类型（常用）<ul>
<li>常用类型：decimal、float</li>
</ul>
</li>
<li>字符串类型（常用）<ul>
<li>常用类型：char、varchar、text</li>
</ul>
</li>
<li>时间日期类型（不常用：通常使用真正时间戳存储数据，然后PHP进行灵活解读）</li>
</ul>
<p>3、实际开发的时候，一定要仔细了解需求，根据需求判定好具体选用那种数据类型</p>
<ul>
<li>最原始的维护能够具有最大的通用性（选中类型）</li>
<li>最小的消耗能够解决全部的问题（巧妙利用存储空间）</li>
</ul>
<h2 id="4-2-属性"><a href="#4-2-属性" class="headerlink" title="4.2 属性"></a>4.2 属性</h2><h3 id="1、属性作用"><a href="#1、属性作用" class="headerlink" title="1、属性作用"></a>1、属性作用</h3><p><strong>属性</strong>：建立在字段类型之后，对字段除类型之外的其他约束</p>
<ul>
<li>属性是在定义表字段的时候针对每个字段进行属性设定</li>
<li>设定好的属性可以通过查看表字段desc进行查看</li>
<li>数据在进行增删改（写）操作时需要在满足字段的要求同时还要满足属性的要求</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>查看表属性：desc 表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">desc t_1;</span><br><span class="line"></span><br><span class="line"># Field：字段名字</span><br><span class="line"># Type：数据类型</span><br><span class="line"># Null：是否为空（属性）</span><br><span class="line"># Key：索引类型（属性）</span><br><span class="line"># Default：默认值（属性）</span><br><span class="line"># Extra：额外属性</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、属性是用来MySQL用来增加字段规范和约束的</p>
<p>2、数据的写操作必须严格满足字段类型和属性要求</p>
<p>3、用好属性能够提升数据的有效性，方便未来进行数据操作和数据分析（数据真实性和有效性）</p>
<h3 id="2、NULL属性"><a href="#2、NULL属性" class="headerlink" title="2、NULL属性"></a>2、NULL属性</h3><p><strong>NULL</strong>：数据是否允许为空</p>
<ul>
<li>默认情况下数据是允许为空的</li>
<li>不为空设计：Not Null</li>
<li>数据为空一般不具备运算和分析价值，所以通常数据都需要设定为Not Null（不区分大小写）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、数据类型确定</p>
<p>2、数据是否为空确定</p>
<ul>
<li>允许为空：不用考虑Null属性（默认为Null）</li>
<li>不允许为空：Not Null</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、用户信息表：用户名、密码、姓名、年龄、注册时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t_23(</span><br><span class="line">    username varchar(50) not null,</span><br><span class="line">    password char(32) not null,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    age tinyint unsigned,</span><br><span class="line">    reg_time int unsigned not null</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>2、如果字段不能为空（Not  Null），那么数据就必须满足条件：插入时不能为空的字段就需要主动提供值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into t_23 values(&#39;username&#39;,&#39;password&#39;,&#39;Jim&#39;,20,123456789);</span><br><span class="line"></span><br><span class="line"># 错误操作：reg_time不能为空，而默认为空，所以系统报错</span><br><span class="line">insert into t_23 (username,password) values(&#39;username&#39;,&#39;password&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、Null/Not Null属性是用来限定数据是否为Null值的</p>
<ul>
<li>默认是允许为Null值</li>
<li>不允许为空：Not Null</li>
</ul>
<p>2、一般有效的数据都必须设定为Not Null来保证数据的有效性</p>
<h3 id="3、Default属性"><a href="#3、Default属性" class="headerlink" title="3、Default属性"></a>3、Default属性</h3><p><strong>默认值</strong>：default，在设计表字段的时候给定默认数据，在后续字段操作（数据新增）的时候系统没有检测到字段有数据的时候自动使用的值</p>
<ul>
<li>默认值在字段设计的时候使用（默认值需要满足数据类型规范）</li>
<li>默认值通常设计的是字段容易出现的数据<ul>
<li>一般字段的默认值默认是Null</li>
</ul>
</li>
<li>默认值触发<ul>
<li>在系统进行数据插入时自动检测触发</li>
<li>主动使用default关键字触发默认值</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定字段的数据类型</p>
<p>2、确定字段可能出现的数据会是某个经常出现的值</p>
<p>3、设定默认值</p>
<p>4、触发默认值</p>
<ul>
<li>自动触发：数据插入时不给字段赋值</li>
<li>手动触发：数据插入时主动使用default关键字</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、用户开户：银行卡账号、身份证号码、姓名、账户余额</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t_24(</span><br><span class="line">    account varchar(19) not null,</span><br><span class="line">    id_card char(18) not null,</span><br><span class="line">    name varchar(20) not null,</span><br><span class="line">    money decimal(16,2) default 0.00 not null</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>2、默认值触发</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 默认触发</span><br><span class="line">insert into t_24 (account,id_card,name) values(&#39;6226000000000001&#39;,&#39;44011120001212000x&#39;,&#39;Lily&#39;);</span><br><span class="line"></span><br><span class="line"># 主动触发</span><br><span class="line">insert into t_24 values(&#39;6226000000000002&#39;,&#39;440111200012120011&#39;,&#39;Tom&#39;,default);</span><br><span class="line">insert into t_24 values(&#39;6226000000000003&#39;,&#39;440111200012120022&#39;,&#39;Jim&#39;,100);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、每个字段都有默认值</p>
<ul>
<li>默认情况下基本为Null</li>
<li>主动设置后，默认值改变</li>
</ul>
<p>2、默认值是在设置表字段的时候添加</p>
<p>3、默认值触发</p>
<ul>
<li>自动触发</li>
<li>关键字手动触发</li>
</ul>
<p>4、默认值通常用于一些不重要的字段，但是会出现常用值（或者初始值一样）</p>
<h3 id="4、主键"><a href="#4、主键" class="headerlink" title="4、主键"></a>4、主键</h3><p><strong>主键</strong>：primary key，用来保证整张表中对应的字段永远不会出现重复数据</p>
<ul>
<li>主键在一张表中只能有一个</li>
<li>主键的另外一个特性是能够提升主键字段作为查询条件的效率（索引）</li>
<li>主键不能为空：Not Null（默认）</li>
<li><strong>逻辑主键</strong>：数据没有具体业务意义，纯粹是一种数值数据<ul>
<li>逻辑主键通常是整数：int</li>
<li>逻辑主键目的是方便检索和数据安全（不暴露数据真实信息）</li>
</ul>
</li>
<li>复合主键：多个字段共同组成不能重复的数据<ul>
<li>primary key(字段1,字段2,…字段N)</li>
<li>联合主键使用不多，一般也不会超过2个字段</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定字段数据具有唯一性</p>
<p>2、确定数据不允许为空</p>
<p>3、确定数据会经常用于数据检索（条件查询）</p>
<p>4、使用主键primary key</p>
<p>5、一般每张表都会使用一个逻辑主键（id）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、银行账户信息：账户、姓名、余额</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 银行账户具有唯一性，不能重复，也不允许为空</span><br><span class="line">create table t_25(</span><br><span class="line">    account varchar(17) primary key,</span><br><span class="line">    name varchar(20) not null,</span><br><span class="line">    money decimal(16,2) not null default 0.00</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line"># 复合主键</span><br><span class="line">create table t_26(</span><br><span class="line">    account varchar(17),</span><br><span class="line">    name varchar(20),</span><br><span class="line">    money decimal(16,2) not null default 0.00,</span><br><span class="line">    primary key(account,name)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line"># 一般使用逻辑主键</span><br><span class="line">create table t_27(</span><br><span class="line">    id int unsigned primary key,</span><br><span class="line">    account varchar(17) not null,</span><br><span class="line">    name varchar(20) not null,</span><br><span class="line">    money decimal(16,2) not null default 0.00</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>2、主键数据不允许重复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">insert into t_27 values(1,&#39;6226000000000001&#39;,&#39;Lily&#39;,default);</span><br><span class="line"></span><br><span class="line"># 错误：主键1已经存在</span><br><span class="line">insert into t_27 values(1,&#39;6226000000000002&#39;,&#39;Tom&#39;,default);</span><br><span class="line"></span><br><span class="line"># 联合主键就是联合字段加起来不重复即可</span><br><span class="line">insert into t_26 values(&#39;6226000000000001&#39;,&#39;Tom&#39;,default);</span><br><span class="line">insert into t_26 values(&#39;6226000000000002&#39;,&#39;Tom&#39;,default);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、主键的作用就是控制对应字段的数据具有唯一性（不能重复）</p>
<p>2、一张表只能有一个主键</p>
<p>3、虽然主键可以用来保证数据的唯一性，但是一般都是使用逻辑主键作为主键字段（保证唯一性还有其他方式，如唯一键）</p>
<p>4、通常也不怎么使用复合主键</p>
<h3 id="5、主键管理"><a href="#5、主键管理" class="headerlink" title="5、主键管理"></a>5、主键管理</h3><p><strong>主键管理</strong>：在创建表并且已经有数据后的维护</p>
<ul>
<li>删除主键</li>
<li>追加主键</li>
<li>修改主键（先删除后新增）</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、删除主键：主键只有一个，所以删除语法也比较特殊</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_26 drop primary key;</span><br></pre></td></tr></table></figure>



<p>2、后期新增主键：如果是针对业务主键需要保证字段数据没有Null数据且没有数据重复（一般主键都会在表创建时维护好）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_26 add primary key(account,name);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、主键的使用通常是在创建表的时候就会指定好</p>
<p>2、主键的维护实际使用较少，主要涉及的操作是删除和新增</p>
<h3 id="6、自增长属性"><a href="#6、自增长属性" class="headerlink" title="6、自增长属性"></a>6、自增长属性</h3><p><strong>自增长</strong>：auto_increment，被修饰的字段在新增时，自动增长数据</p>
<ul>
<li>自增长只能是整数类型，而且对应的字段必须是一个索引（通常逻辑主键）</li>
<li>一张表只能有一个自动增长</li>
<li>自增长数据可以理解为一种默认值，如果主动给值，那么自动增长不会触发</li>
<li>自增长由两个变量控制<ul>
<li>初始值：<code>auto_increment_offset</code>，默认是1</li>
<li>步长：<code>auto_increment_increment</code>，默认值也是1</li>
<li>查看自增长控制：<code>show variables like &#39;auto_increment%&#39;;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据类型为整型</p>
<p>2、确定数据需要有规则的变化</p>
<ul>
<li>从1开始</li>
<li>每次增长1</li>
<li>可以调整，但是通常有固定规则（一般不调整）</li>
</ul>
<p>3、必须是一个索引字段（逻辑主键）</p>
<p>4、使用auto_increment</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、记录学生信息：学号和姓名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 学生信息：学号自动增长</span><br><span class="line">create table t_28(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    stu_no int(8) zerofill not null,</span><br><span class="line">    stu_name varchar(20) not null</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>2、触发自增长</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用自增长（可以使用NULL或者default来触发）</span><br><span class="line">insert into t_28 values(null,1,&#39;Jim&#39;);</span><br><span class="line">insert into t_28 values(default,2,&#39;Tom&#39;);</span><br><span class="line"></span><br><span class="line"># 主动控制：自增长的值会从当前最大的值开始自动增长</span><br><span class="line">insert into t_28 values(10,3,&#39;Lily&#39;);</span><br><span class="line">insert into t_28 values(null,4,&#39;Lucy&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、自增长auto_increment一般是配合逻辑主键实现自动增长</p>
<ul>
<li>整型字段</li>
<li>存在索引（主键）</li>
</ul>
<p>2、自增长的触发是通过不给值（默认值）实现自动计算</p>
<p>3、自增长是根据当前表中自增长列最大值运算</p>
<p>4、一张表中只能有一个自增长</p>
<h3 id="7、自增长管理"><a href="#7、自增长管理" class="headerlink" title="7、自增长管理"></a>7、自增长管理</h3><p><strong>自增长管理</strong>：在某些特殊使用下，需要自增长按照需求实现</p>
<ul>
<li><p>修改表中自增长的值：让下次自增长按照指定值开始</p>
</li>
<li><p>修改自增长控制：调整自增长的变化</p>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、修改表中自增长的值，跳过一些值，直接从下次开始按照新的目标值出现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_28 auto_increment &#x3D; 50;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：奇数会保留原值，偶数会自动加1（可能出现的情况）</p>
<p>2、修改自增长控制：步长和起始值（修改针对的是整个数据库，而非单张表）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set auto_increment_increment &#x3D; 2;	# 当前用户当前连接有效（局部）</span><br><span class="line">set @@auto_increment_increment &#x3D; 2;	# 所有用户一直有效（全局）</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、自增长通常不会修改，如果有规则要求必须修改，通常也会在数据库运行前修改好</p>
<p>2、如果碰到要修改操作的，通常会选择全局修改而不是局部修改</p>
<h3 id="8、唯一键"><a href="#8、唯一键" class="headerlink" title="8、唯一键"></a>8、唯一键</h3><p><strong>唯一键</strong>：unique key，用来维护数据的唯一性</p>
<ul>
<li>一个表中可以有多个唯一键</li>
<li>唯一键与主键的区别在于唯一键允许数据为Null（而且Null的数量不限）</li>
<li>唯一键与主键一样，可以提升字段数据当做条件查询的效率（索引）</li>
<li>复合唯一键：多个字段共同组成<ul>
<li>unique key(字段1,字段2,…字段N)</li>
<li>一般不会出现，最多2个字段组成</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据列具有唯一特性</p>
<p>2、确定数据列不用作为主键</p>
<p>3、确定数据会经常用于检索条件</p>
<p>4、唯一键字段是否允许数据为空</p>
<ul>
<li>为空：普通唯一键</li>
<li>不为空：not null（唯一键与主键效果一样）</li>
</ul>
<p>5、使用唯一键</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、用户表：用户名唯一，而且经常作为查询条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table t_29(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    username varchar(50) unique comment &#39;唯一键，可以直接在字段之后增加，使用unique关键字&#39;,</span><br><span class="line">    password char(32) not null</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_29 values(null,&#39;username&#39;,&#39;password&#39;);</span><br><span class="line">insert into t_29 values(null,Null,&#39;password&#39;);</span><br><span class="line">insert into t_29 values(null,Null,&#39;password&#39;);</span><br><span class="line"></span><br><span class="line"># 错误</span><br><span class="line">insert into t_29 values(null,&#39;username&#39;,&#39;password1&#39;);</span><br></pre></td></tr></table></figure>



<p>2、学生成绩表：一个学生只能有一个学科成绩，但是可以有多个学科</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 学号和学科编号共同组成唯一</span><br><span class="line">create table t_30(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    stu_name varchar(20) not null,</span><br><span class="line">    course varchar(20) not null,</span><br><span class="line">    score decimal(5,2),</span><br><span class="line">    unique key(stu_name,course)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_30 values(null,&#39;Jim&#39;,&#39;Math&#39;,50);</span><br><span class="line">insert into t_30 values(null,&#39;Jim&#39;,&#39;English&#39;,80);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、唯一键的目标是保证对应字段数据的唯一性</p>
<ul>
<li>唯一键不限定数据是否为Null（Null不参与唯一判定）</li>
<li>复合唯一键：允许多个字段共同组成唯一性</li>
</ul>
<p>2、唯一键能够弥补主键只有一个的特性（不限定数据量）</p>
<p>3、唯一键使用的位置应该要确保该字段数据会用作数据检索条件</p>
<h3 id="9、唯一键管理"><a href="#9、唯一键管理" class="headerlink" title="9、唯一键管理"></a>9、唯一键管理</h3><p><strong>唯一键管理</strong>：在表创建后对唯一键的管理</p>
<ul>
<li>删除唯一键：一张表中不止一个唯一键，所以删除方式是相对麻烦：<code>alter table 表名 drop index 唯一键名字；</code></li>
<li>新增唯一键：<code>alter table 表名 add unique key(字段列表)；</code></li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、删除表中已有的唯一键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_30 drop index &#96;stu_name&#96;;</span><br></pre></td></tr></table></figure>



<p>2、追加唯一键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_30 add unique key &#96;stu_course&#96; (stu_name,course);</span><br></pre></td></tr></table></figure>

<ul>
<li>追加唯一键要保证字段里的数据具有唯一性</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、唯一键一般也会在前期架构（创建表）时就会设置好</p>
<p>2、如果在后期数据庞大后进行数据库优化，可能会涉及到后期维护唯一键</p>
<p>3、唯一键的删除不能像主键那样删除，原因就是唯一键在表中不是唯一存在的，必须指定唯一键名字</p>
<h3 id="10、comment属性"><a href="#10、comment属性" class="headerlink" title="10、comment属性"></a>10、comment属性</h3><p><strong>描述</strong>：comment，是用文字描述字段的作用的</p>
<ul>
<li>comment代表的内容是对字段的描述<ul>
<li>方便以后自己了解字段的作用</li>
<li>方便团队了解字段的作用</li>
</ul>
</li>
<li>描述如果涉及到字符集（中文）一定要在创建表之前设置好客户端字符集（否则会出现描述乱码）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、字段命名不是特别简单（见名知意）</p>
<p>2、使用comment增加简易描述</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>学生成绩表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 学生成绩表中通常是存储学生学号</span><br><span class="line"># 学科通常也是学科代码</span><br><span class="line">create table t_31(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    stu_no varchar(10) not null comment &#39;学号&#39;,</span><br><span class="line">    course_no varchar(10) not null comment &#39;课程号&#39;,</span><br><span class="line">    score decimal(5,2) comment &#39;考试成绩&#39;,</span><br><span class="line">    unique key &#96;stu_course&#96; (stu_no,course_no) comment &#39;学号和课程号组成唯一键&#39;</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果要查看描述信息，需要使用show create table查看</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、养成描述的良好习惯，为自己也为其他同事提供方便</p>
<p>2、并非所有字段都需要描述，但是对于自定义名字或者关联关系，都应该使用描述说清楚</p>
<h3 id="11、总结"><a href="#11、总结" class="headerlink" title="11、总结"></a>11、总结</h3><p>1、字段属性是基于字段类型对数据控制后，再进行其他控制（辅助加强字段类型对数据的控制）</p>
<p>2、巧妙的利用好字段属性，能够帮助我们更好的保证数据的有效性、安全性</p>
<p>3、字段属性与字段类型通常是搭配使用，常见的属性有</p>
<ul>
<li>主键（逻辑）+自增长</li>
<li>唯一键+Not Null（Null数据不参与运算，没有价值）</li>
<li>默认值以及default关键字的使用</li>
</ul>
<h2 id="4-3-数据库记录长度"><a href="#4-3-数据库记录长度" class="headerlink" title="4.3 数据库记录长度"></a>4.3 数据库记录长度</h2><p><strong>数据库记录长度</strong>：MySQL中规定一条记录所占用的存储长度最长不超过65535个<strong>字节</strong></p>
<ul>
<li>记录长度为表中所有字段预计占用的长度之和</li>
<li>所有字段只有允许Null存在，系统就会预留一个字节存储Null（多个Null也只要一个就好）</li>
<li>因为MySQL记录长度的存在，varchar永远达不到理论长度<ul>
<li>GBK存储：65535（字符） * 2 + 2 = 131072（字节）</li>
<li>UTF8存储：65535（字符） * 3 + 2 = 196607（字节）</li>
</ul>
</li>
<li>一般数据长度超过255个字符都会使用text/blob进行存储（数据存储不占用记录长度）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、字符串字段如果超过长度255字符，使用text/blob替代</p>
<p>2、所有字段是否有允许为Null的，如果有要占用1个字节</p>
<p>3、计算字段所占用的预计总长度不要超过65535个字节</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、GBK表能存储的最大varchar字符串长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table t_32(</span><br><span class="line">    content varchar(65535)</span><br><span class="line">)charset gbk;	# 错误</span><br><span class="line"></span><br><span class="line">create table t_32(</span><br><span class="line">    content varchar(32767)</span><br><span class="line">)charset gbk;	# 错误</span><br><span class="line"></span><br><span class="line">create table t_32(</span><br><span class="line">    content varchar(32766)</span><br><span class="line">)charset gbk;	</span><br></pre></td></tr></table></figure>



<p>2、UTF8表能存储的最大varchar字符串长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t_33(</span><br><span class="line">    content varchar(65535)</span><br><span class="line">)charset utf8;	# 错误</span><br><span class="line"></span><br><span class="line">create table t_33(</span><br><span class="line">    content varchar(21844)</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>3、Null也要占用一个字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table t_34(</span><br><span class="line">    id tinyint,</span><br><span class="line">    content varchar(21844)</span><br><span class="line">)charset utf8;	# 错误</span><br><span class="line"></span><br><span class="line">create table t_34(</span><br><span class="line">    id tinyint not null,</span><br><span class="line">    content varchar(21844) not null</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、MySQL的记录长度是从设定表的时候就会检查所有字段加起来的预占用长度是否超过65535个字节</p>
<ul>
<li>超过：创建失败</li>
<li>不超过：创建成功</li>
</ul>
<p>2、创建表字段的时候要使用text/blob来避免长字符串出现，超过MySQL记录长度</p>
<p>3、Null是个细节，一条记录只要允许出现Null就会占用记录长度里的一个字节</p>
<h1 id="5-MySQL数据库设计规范"><a href="#5-MySQL数据库设计规范" class="headerlink" title="5 MySQL数据库设计规范"></a>5 MySQL数据库设计规范</h1><h2 id="5-1-关系型数据库设计范式"><a href="#5-1-关系型数据库设计范式" class="headerlink" title="5.1 关系型数据库设计范式"></a>5.1 关系型数据库设计范式</h2><p><strong>范式</strong>：Normal Format，符合某一种级别的关系模式的集合，表示一个关系内部各属性之间的联系的合理化程度</p>
<ul>
<li><p>范式是离散数学里的概念</p>
</li>
<li><p>范式目标是在满足组织和存储的前提下使数据结构冗余最小化 </p>
</li>
<li><p>范式级别越高，表的级别就越标准</p>
</li>
<li><p>目前数据库应用到的范式有以下几层</p>
<ul>
<li>第一范式：1NF</li>
<li>第二范式：2NF</li>
<li>第三范式：3NF</li>
<li>逆规范化</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、一张员工表</p>
<table>
<thead>
<tr>
<th>工号</th>
<th>姓名</th>
<th>部门</th>
<th>入职时间</th>
</tr>
</thead>
<tbody><tr>
<td>0001</td>
<td>杨戬</td>
<td>武装部</td>
<td>0001-01-01</td>
</tr>
<tr>
<td>0002</td>
<td>李白</td>
<td>书院部</td>
<td>1500-12-12</td>
</tr>
</tbody></table>
<p>2、每个员工都是与部门挂钩的，但是部门不可能很多，所以上述表中会有很多数据重复，此时应该将部门单独维护出来，减少数据冗余</p>
<table>
<thead>
<tr>
<th>部门编号</th>
<th>部门名称</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>武装部</td>
</tr>
<tr>
<td>2</td>
<td>书院部</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>工号</th>
<th>姓名</th>
<th>部门编号</th>
<th>入职时间</th>
</tr>
</thead>
<tbody><tr>
<td>0001</td>
<td>杨戬</td>
<td>1</td>
<td>0001-01-01</td>
</tr>
<tr>
<td>0002</td>
<td>李白</td>
<td>2</td>
<td>1500-12-12</td>
</tr>
</tbody></table>
<p><strong>N个1和N个武装部占用的磁盘空间肯定是不一样的</strong></p>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、范式是一种数学理论，在关系型数据库上用来减少数据冗余</p>
<p>2、满足的范式越多，越符合高标准表设计</p>
<p>3、范式一共有6层，但是数据库的设计通常只要求满足3层即可</p>
<h3 id="1、第一范式1NF"><a href="#1、第一范式1NF" class="headerlink" title="1、第一范式1NF"></a>1、第一范式1NF</h3><p><strong>第一范式</strong>：1NF，数据字段设计时必须满足<strong>原子性</strong></p>
<ul>
<li>1NF要求字段数据是不需要拆分就可以直接应用</li>
<li>如果数据使用的时候需要进行拆分那么就违背1NF</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、设计的字段是否在使用的时候还需要再拆分？</p>
<p>2、将数据拆分到最小单位（使用），然后设计成字段</p>
<p>3、满足1NF</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、设计一张学生选修课成绩表</p>
<table>
<thead>
<tr>
<th>学生</th>
<th>性别</th>
<th>课程</th>
<th>教室</th>
<th>成绩</th>
<th>学习时间</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>男</td>
<td>PHP</td>
<td>101</td>
<td>100</td>
<td>2月1日,2月28日</td>
</tr>
<tr>
<td>李四</td>
<td>女</td>
<td>Java</td>
<td>102</td>
<td>90</td>
<td>3月1日,3月31日</td>
</tr>
<tr>
<td>张三</td>
<td>男</td>
<td>Java</td>
<td>102</td>
<td>95</td>
<td>3月1日,3月31日</td>
</tr>
</tbody></table>
<p>当前表的学习时间在使用的时候肯定是基于开始时间和结束时间的，而这种设计就会存在使用时的数据拆分，不满足原子性也就是1NF</p>
<p>2、满足1NF的设计：字段颗粒度应用层最小（不需要拆分）</p>
<table>
<thead>
<tr>
<th>学生</th>
<th>性别</th>
<th>课程</th>
<th>教室</th>
<th>成绩</th>
<th>开始时间</th>
<th>结束时间</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>男</td>
<td>PHP</td>
<td>101</td>
<td>100</td>
<td>2月1日</td>
<td>2月28日</td>
</tr>
<tr>
<td>李四</td>
<td>女</td>
<td>Java</td>
<td>102</td>
<td>90</td>
<td>3月1日</td>
<td>3月31日</td>
</tr>
<tr>
<td>张三</td>
<td>男</td>
<td>Java</td>
<td>102</td>
<td>95</td>
<td>3月1日</td>
<td>3月31日</td>
</tr>
</tbody></table>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、1NF就是要字段数据颗粒度最小，保证数据取出来使用的时候不用再拆分</p>
<p>2、1NF是满足数据表设计的最基础规范</p>
<h3 id="2、第二范式2NF"><a href="#2、第二范式2NF" class="headerlink" title="2、第二范式2NF"></a>2、第二范式2NF</h3><p><strong>第二范式</strong>：2NF，字段设计不能存在部分依赖</p>
<ul>
<li>部分依赖：首先表存在复合主键，其次有的字段不是依赖整个主键，而只是依赖主键中的一部分</li>
<li>部分依赖解决：让所有非主属性都依赖一个候选关键字<ul>
<li>最简单方式：取消复合主键（一般选用逻辑主键替代，但是本质依然是复合主键做主），所有非主属性都依赖主属性（逻辑主键）</li>
<li>正确方式：将部分依赖关系独立成表</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、表中是否存在复合主键？</p>
<p>2、其他字段是否存在依赖主键中的一部分？</p>
<p>3、如果存在部分依赖，将部分依赖的关系独立拆分成表</p>
<p>4、满足2NF</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、学生成绩表中学生和课程应该是决定性关系，因此属于主属性（主键）</p>
<table>
<thead>
<tr>
<th>学生（P）</th>
<th>性别</th>
<th>课程（P）</th>
<th>教室</th>
<th>成绩</th>
<th>开始时间</th>
<th>结束时间</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>男</td>
<td>PHP</td>
<td>101</td>
<td>100</td>
<td>2月1日</td>
<td>2月28日</td>
</tr>
<tr>
<td>李四</td>
<td>女</td>
<td>Java</td>
<td>102</td>
<td>90</td>
<td>3月1日</td>
<td>3月31日</td>
</tr>
<tr>
<td>张三</td>
<td>男</td>
<td>Java</td>
<td>102</td>
<td>95</td>
<td>3月1日</td>
<td>3月31日</td>
</tr>
</tbody></table>
<ul>
<li>成绩是由学生和课程决定的，是完全依赖主属性</li>
<li>性别只依赖学生（部分依赖）</li>
<li>教室、开始时间和结束时间依赖课程（部分依赖）</li>
</ul>
<p>2、解决方案：将学生信息维护到一张表，课程信息维护到一张表，成绩表取两个表的主属性即可</p>
<p><strong>学生表</strong></p>
<table>
<thead>
<tr>
<th>Stu_id（P）</th>
<th>姓名</th>
<th>性别</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>男</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>女</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>Stu_id是姓名的代指属性（逻辑主键，本质主键是姓名）</li>
<li>性别只依赖主属性</li>
</ul>
<p><strong>课程表</strong></p>
<table>
<thead>
<tr>
<th>Class_id（P）</th>
<th>课程</th>
<th>教室</th>
<th>开始时间</th>
<th>结束时间</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>PHP</td>
<td>101</td>
<td>2月1日</td>
<td>2月28日</td>
</tr>
<tr>
<td>2</td>
<td>Java</td>
<td>102</td>
<td>3月1日</td>
<td>3月31日</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>Class_id是课程的代指属性（逻辑主键）</li>
<li>教室、开始时间和结束时间都依赖课程（主属性）</li>
</ul>
<p><strong>成绩表</strong></p>
<table>
<thead>
<tr>
<th>Stu_id（P）</th>
<th>Class_id（P）</th>
<th>成绩</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>100</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>90</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>95</td>
</tr>
</tbody></table>
<ul>
<li>Stu_id和Class_id共同组成主属性（复合主键）</li>
<li>成绩依赖Stu_id和Class_id本身，不存在部分依赖</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、2NF是在满足1NF的前提之上的</p>
<p>2、2NF的目标是取消表中存在的部分依赖</p>
<ul>
<li>主属性（主键）为复合主键才有可能存在</li>
<li>解决方案就是让部分依赖存在的关系独立成表（学生表和课程表），不存在部分依赖关系的独立成表（学生成绩表）</li>
</ul>
<p>3、2NF可以实现很大程度的数据冗余减少</p>
<h3 id="3、第三范式3NF"><a href="#3、第三范式3NF" class="headerlink" title="3、第三范式3NF"></a>3、第三范式3NF</h3><p><strong>第三范式</strong>：3NF，字段设计不能存在传递依赖</p>
<ul>
<li>传递依赖：字段某个非主属性不直接依赖主属性，而是通过依赖某个其他非主属性而传递到主属性之上</li>
<li>传递依赖解决：让依赖非主属性的字段与依赖字段独立成表</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定表中的所有字段都是依赖主属性的</p>
<p>2、如果存在不直接依赖主属性，而是通过依赖其他属性产生依赖的，形成独立的表</p>
<p>3、满足3NF</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、学生表：包括所在系信息</p>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>姓名</th>
<th>专业编号</th>
<th>专业名字</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>0001001</td>
<td>软件工程</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>0001002</td>
<td>土木工程</td>
</tr>
</tbody></table>
<ul>
<li>姓名和专业编号都依赖于学号（为学号提供信息支持）</li>
<li>专业名字依赖专业编号（为编号提供信息支持）</li>
<li>专业名字间接依赖学号：传递依赖</li>
<li>随着学生增加，专业名字会出现大量数据冗余</li>
</ul>
<p>2、解决方案：将存储传递依赖部分的字段（非主属性）独立成表，然后在需要使用相关信息的时候，引入即可</p>
<p><strong>专业表</strong></p>
<table>
<thead>
<tr>
<th>专业编号（P）</th>
<th>专业名字</th>
</tr>
</thead>
<tbody><tr>
<td>0001001</td>
<td>软件工程</td>
</tr>
<tr>
<td>0001002</td>
<td>土木工程</td>
</tr>
</tbody></table>
<ul>
<li>即使有更多的信息为专业提供支持也不存在传递关系</li>
</ul>
<p><strong>学生表</strong></p>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>姓名</th>
<th>专业编号</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>0001001</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>0001002</td>
</tr>
</tbody></table>
<ul>
<li>姓名和专业编号都依赖学号（为学号提供信息支持）</li>
<li>没有其他字段是通过非主属性（专业编号）来依赖主属性的：没有传递依赖</li>
<li>学生再多，专业名字信息只需要维护一次，减少数据冗余</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、3NF目的是为了解决非主属性对主属性的传递依赖</p>
<p>2、让有关联关系的表独立成表就可以消除传递依赖，满足3NF</p>
<h3 id="4、逆规范化"><a href="#4、逆规范化" class="headerlink" title="4、逆规范化"></a>4、逆规范化</h3><p><strong>逆规范化</strong>：为了<strong>提升数据查询的效率</strong>而<strong>刻意违背范式的规则</strong></p>
<ul>
<li>逆规范化的目标是为了提升数据访问效率</li>
<li>所谓逆规范化就是减少表之间的关联查询（效率降低），刻意增加数据冗余</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、表中部分数据来源于其他表（通常只需要其他表的某个简单数据）</p>
<p>2、当前表会被<strong>高频次查询</strong></p>
<p>3、数据表<strong>数据量很大</strong></p>
<p>4、考虑使用逆规范化</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、学生成绩表需要经常查询，而且数据量很大，但是：</p>
<ul>
<li>成绩表中只有学号，显示的时候需要学生姓名（去学生表中连表查询）</li>
<li>成表表中只有课程号，显示的时候需要显示课程名（去课程表中连表查询）</li>
<li>逆规范化：将学生姓名和课程名在表中冗余维护（不满足2NF）</li>
</ul>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>学生姓名</th>
<th>课程号（P）</th>
<th>课程名字</th>
<th>成绩</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>1</td>
<td>PHP</td>
<td>100</td>
</tr>
<tr>
<td>1</td>
<td>张三</td>
<td>2</td>
<td>Java</td>
<td>90</td>
</tr>
</tbody></table>
<ul>
<li>学生姓名部分依赖学号（主属性）：不满足2NF</li>
<li>学生姓名和课程名字会有大量数据冗余存在（不满足2NF导致）</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、逆规范化只有在数据量大，查询效率低下的时候为了提升查询效率而牺牲磁盘空间的一种做法</p>
<p>2、逆规范化后数据表的设计必然是不完全符合范式要求的（2NF/3NF）</p>
<h3 id="5、总结-2"><a href="#5、总结-2" class="headerlink" title="5、总结"></a>5、总结</h3><p>1、范式是关系型数据库设计借鉴用来<strong>减少数据冗余</strong>的</p>
<ul>
<li>1NF：数据字段的原子性，增强数据的可用性</li>
<li>2NF：取消字段的部分依赖，建立数据的关联性，减少数据冗余</li>
<li>3NF：取消字段的传递依赖，将相关实体独立划分，减少数据冗余</li>
<li>逆规范化：为了提升数据访问效率，刻意增加数据冗余（磁盘空间利用率与访问效率的矛盾）</li>
</ul>
<p>2、在进行数据表设计的时候，需要严格遵循范式规范</p>
<ul>
<li>基于规范设计数据表</li>
<li>在设计表中深入认知范式规范</li>
<li>熟练的基于业务设计数据表</li>
</ul>
<h2 id="5-2-表关系"><a href="#5-2-表关系" class="headerlink" title="5.2 表关系"></a>5.2 表关系</h2><p><strong>表关系</strong>：一个表代表一个实体，实体之间都有关联关系的</p>
<ul>
<li>根据范式的要求来设计表关系，减少数据冗余</li>
<li>根据实际需求来设计表关系，提升访问效率</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>设计一个简单新闻管理系统的数据库</p>
<ul>
<li><p>新闻信息表：id、标题、内容、发布时间、作者id（作者表主属性）、分类id（分类表主属性）、阅读量、推荐数</p>
</li>
<li><p>作者表：id、作者名字、作者来源id（来源表）</p>
</li>
<li><p>来源表：id、来源名字、来源描述</p>
</li>
<li><p>分类表：id、分类名字、分类级别（父分类id）</p>
</li>
<li><p>评论表：id、评论人id（评论表）、评论时间、评论内容（不回复）</p>
</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、表关系是体现数据实际联系的方式</p>
<p>2、表关系的设计好坏直接关联数据维护的准确性、有效性</p>
<p>3、良好的数据库设计有助于后期程序开发</p>
<h3 id="1、一对一关系"><a href="#1、一对一关系" class="headerlink" title="1、一对一关系"></a>1、一对一关系</h3><p><strong>一对一关系</strong>：一张表中的一条记录与另外一张表中有且仅有一条记录有关系</p>
<ul>
<li>一对一关系通常是用来将一张原本就是一体的表拆分成两张表<ul>
<li>频繁使用部分：常用字段</li>
<li>不常使用部分：生僻字段</li>
<li>使用相同的主键对应</li>
</ul>
</li>
<li>一对一关系设计较多使用在优化方面</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、一张表的数据字段较多且数据量较大</p>
<p>2、表中有部分字段使用频次较高，而另一部分较少使用</p>
<p>3、将常用字段和不常用字段拆分成两张表，使用同样的主键对应</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、学生信息表</p>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>姓名</th>
<th>性别</th>
<th>年龄</th>
<th>身高</th>
<th>体重</th>
<th>籍贯</th>
<th>政治面貌</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张飞</td>
<td>男</td>
<td>20</td>
<td>178</td>
<td>160</td>
<td>蜀</td>
<td>农民</td>
</tr>
<tr>
<td>2</td>
<td>武则天</td>
<td>女</td>
<td>21</td>
<td>168</td>
<td>110</td>
<td>唐</td>
<td>党员</td>
</tr>
</tbody></table>
<ul>
<li>以上数据表信息字段较多</li>
<li>姓名、性别、年龄属于常用字段，频繁查询</li>
</ul>
<p>2、一对一关系设计</p>
<ul>
<li>将常用字段取出，与学号组合成一张常用表</li>
<li>将不常用字段取出，与学号组合成一张不常用表</li>
<li>表与表数据对应关系：基于学号（唯一）是一对一关系</li>
</ul>
<p><strong>常用表</strong></p>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>姓名</th>
<th>性别</th>
<th>年龄</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张飞</td>
<td>男</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>武则天</td>
<td>女</td>
<td>21</td>
</tr>
</tbody></table>
<p><strong>不常用表</strong></p>
<table>
<thead>
<tr>
<th>学号（P）</th>
<th>身高</th>
<th>体重</th>
<th>籍贯</th>
<th>政治面貌</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>178</td>
<td>160</td>
<td>蜀</td>
<td>农民</td>
</tr>
<tr>
<td>2</td>
<td>168</td>
<td>110</td>
<td>唐</td>
<td>党员</td>
</tr>
</tbody></table>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、一对一关系的核心是两张表中记录匹配有且仅有一条匹配</p>
<p>2、一对一关系常用来进行分表，实现优化操作</p>
<p>3、因为一对一关系表通常有相同信息作为匹配条件，所以查询方式也比较方便</p>
<ul>
<li>连表操作：利用共有信息进行匹配，一并查出一条完整信息</li>
<li>多次查询：利用共有信息进行多表查询，利用程序组合成一条完整信息</li>
</ul>
<h3 id="2、一对多关系"><a href="#2、一对多关系" class="headerlink" title="2、一对多关系"></a>2、一对多关系</h3><p><strong>一对多关系</strong>：也叫多对一关系，一张表中的一条记录与另外一张表的多条记录对应，反过来另外一张表的多条记录只能对应当前表的一条记录</p>
<ul>
<li>一对多关系是实体中非常常见的一种关系，实体设计时也应用非常多</li>
<li>一对多关系的核心解决方案是如何让记录能够正确匹配到另外表中的数据<ul>
<li>一表设计：一表记录在另外一张表中有多条记录，所以无法记录多个字段（违背1NF）</li>
<li>多表设计：多表记录在另外一张表中只有一条记录，可以设置字段记录对应的主属性（通常主键）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定实体间的关系为一对多（多对一）关系</p>
<p>2、在多表中增加一个字段记录一表中对应的主属性</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、老师与学科间的关系：一个老师只能教一个学科，但是一个学科有多个老师教授，学科与老师形成的关系就是一对多（反过来老师与学科的关系就是多对一关系）</p>
<p><strong>老师表</strong>（多表）</p>
<table>
<thead>
<tr>
<th>老师ID（P）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张老师</td>
<td>35</td>
<td>男</td>
</tr>
<tr>
<td>2</td>
<td>李老师</td>
<td>34</td>
<td>女</td>
</tr>
<tr>
<td>3</td>
<td>王老师</td>
<td>30</td>
<td>男</td>
</tr>
</tbody></table>
<p><strong>学科表</strong>（一表）</p>
<table>
<thead>
<tr>
<th>学科ID（P）</th>
<th>名字</th>
<th>课时长度</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>PHP</td>
<td>600</td>
</tr>
<tr>
<td>2</td>
<td>Java</td>
<td>800</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>以上两个实体没有体现彼此之间的关联关系</li>
<li>实际上讲师与学科肯定是有关联的</li>
</ul>
<p>2、在多表（讲师）中增加字段维护一表（学科）的关系型，形成多对一关系</p>
<table>
<thead>
<tr>
<th>老师ID（P）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
<th>学科ID</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张三</td>
<td>35</td>
<td>男</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>34</td>
<td>女</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>王五</td>
<td>30</td>
<td>男</td>
<td>2</td>
</tr>
</tbody></table>
<ul>
<li>基于新的讲师表与学科表产生了关联关系（多对一）</li>
<li>基于讲师表可以知道讲师所属学科</li>
<li>基于学科ID可以统计出不同学科的讲师数量</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、一对多关系设计是将实体的关系在表结构层进行强制关联（没有关系程序层也可以控制，但是会非常麻烦）</p>
<ul>
<li>便于连表操作</li>
<li>便于数据分析统计（数据库层）</li>
</ul>
<p>2、一对多关系的核心在于分析出表与表之间的关系</p>
<h3 id="3、多对多关系"><a href="#3、多对多关系" class="headerlink" title="3、多对多关系"></a>3、多对多关系</h3><p><strong>多对多关系</strong>：一张表中的一条记录对应另外一个表中多条记录，反过来一样</p>
<ul>
<li>多对多关系在实体中是最常见的关系</li>
<li>多对多关系是无法在自身表中维护对应表关系的（违背1NF），需要通过第三方表来实现将多对多关系变成多个多对一关系<ul>
<li>设计一个中间表：记录两张表之间的对应关系（主属性）</li>
<li>中间表与其他表都是多对一的关系</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定实体间的关系为多对多关系</p>
<p>2、设计中间表，记录两张表的对应关系</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、老师与学生之间的关系：一个老师会教授多个学生，一个学生也会听多个老师的课，所以实体关系是多对多关系</p>
<p><strong>老师表</strong></p>
<table>
<thead>
<tr>
<th>老师ID（P）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张老师</td>
<td>35</td>
<td>男</td>
</tr>
<tr>
<td>2</td>
<td>李老师</td>
<td>34</td>
<td>女</td>
</tr>
<tr>
<td>3</td>
<td>王老师</td>
<td>30</td>
<td>男</td>
</tr>
</tbody></table>
<p><strong>学生表</strong></p>
<table>
<thead>
<tr>
<th>学生ID（P）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>小明</td>
<td>15</td>
<td>男</td>
</tr>
<tr>
<td>2</td>
<td>小红</td>
<td>14</td>
<td>女</td>
</tr>
<tr>
<td>3</td>
<td>小萌</td>
<td>14</td>
<td>女</td>
</tr>
</tbody></table>
<ul>
<li>以上实体没有从结构上体现表之间的关系</li>
</ul>
<p>2、设计一个中间表：老师与学生关系表，将老师与学生的对应关系对应上（多对一）</p>
<p><strong>中间表</strong></p>
<table>
<thead>
<tr>
<th>ID（P）</th>
<th>学生ID</th>
<th>老师ID</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>7</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>8</td>
<td>3</td>
<td>3</td>
</tr>
</tbody></table>
<ul>
<li>中间表与老师表的对应关系是多对一：通过老师ID可以找到每一个上过课的老师</li>
<li>中间表与学生表的对应关系是多对一：通过学生ID可以找到每一个听过课的学生</li>
<li>老师找学生：老师表–》中间表（找出老师对应的学生ID）–》学生表（找出学生ID对应的学生信息）</li>
<li>学生找老师：学生表–》中间表（找出学生对应的老师ID）–》老师表（找出老师ID对应的老师信息）</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、多对多关系在表上不能直接维护（字段设计违背1NF）</p>
<p>2、多对多关系是将关系抽离形成中间关系表，形成多个多对一的关系</p>
<p>3、多对多关系是否建立主要看业务上是否存在数据要求，如果不存在数据需求，那么就没必要刻意设计</p>
<h3 id="4、总结-1"><a href="#4、总结-1" class="headerlink" title="4、总结"></a>4、总结</h3><p>1、表关系的设计是要遵循范式规范作为前提</p>
<p>2、表关系的设计是根据实体关系以及业务需求进行设计</p>
<ul>
<li>一对一关系：主要在于优化访问效率、传输效率</li>
<li>一对多关系：在于如何让实体间的联系在结构中体现（后期可以使用外键进行相关约束保证数据的有效性）</li>
<li>多对多关系：与一对多关系一样，清晰明了的体现实体间的结构联系</li>
</ul>
<p>3、在设计数据库的时候，要严格使用表关系来进行实体关联设计</p>
<ul>
<li>基于表关系来实现实体间的关联控制</li>
<li>在设计和应用表的时候提炼对表关系的认知</li>
<li>能够熟练的基于业务控制数据库的关系</li>
</ul>
<h1 id="6-MySQL高级SQL操作"><a href="#6-MySQL高级SQL操作" class="headerlink" title="6 MySQL高级SQL操作"></a>6 MySQL高级SQL操作</h1><p><strong>高级SQL操作</strong>：利用SQL指令的变化实现一些复杂业务的数据操作</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、统计不同班级的人数信息</p>
<ul>
<li><p>按照现有SQL操作，即便数据表已经存在数据，但是我们也无法通过SQL实现，只能取出来后通过其他代码对数据进行加工实现</p>
</li>
<li><p>通过高级SQL学习，我们就可以通过一条SQL指令完成操作</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),班级ID from 学生表 group by 班级ID;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、高级SQL操作能够帮助我们解决复杂的需求问题</p>
<p>2、在实际开发过程中，高级SQL操作占据的比例相当高</p>
<h2 id="6-1-数据新增"><a href="#6-1-数据新增" class="headerlink" title="6.1 数据新增"></a>6.1 数据新增</h2><h3 id="1、批量插入"><a href="#1、批量插入" class="headerlink" title="1、批量插入"></a>1、批量插入</h3><p><strong>批量插入</strong>：是一种优化数据逐条插入的方式</p>
<ul>
<li><p>批量插入数据的语法与简单数据插入的语法差不多</p>
</li>
<li><p>批量插入分为两种</p>
<ul>
<li>全字段批量插入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名 values(值列表1),(值列表2),...(值列表N);</span><br></pre></td></tr></table></figure>

<ul>
<li>部分字段批量插入（注意字段默认值）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名 (字段列表) values (值列表1),(值列表2),...(值列表N);</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、用户的操作涉及到多记录同时插入（通常数据批量导入）</p>
<p>2、组装成批量插入SQL指令</p>
<ul>
<li>字段为全字段（逻辑主键不存在没问题）：全字段批量插入SQL</li>
<li>部分字段：组织字段列表并检查其他字段是否允许默认值</li>
</ul>
<p>3、执行批量插入</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、批量插入学生成绩（t_30全字段）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_30 values(null,&#39;Tom&#39;,&#39;Computer&#39;,90),</span><br><span class="line">(null,&#39;Lily&#39;,&#39;Computer&#39;,92);</span><br></pre></td></tr></table></figure>



<p>2、批量插入学生考试信息（t_30不包含成绩）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_30 (stu_name,course) values(&#39;Tony&#39;,&#39;English&#39;),(&#39;Ray&#39;,&#39;Math&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、批量插入可以针对性解决数据的批量导入之类的业务</p>
<p>2、批量插入可以一次性解决多条数据插入，能够有效降低客户端占用问题，提升数据操作效率</p>
<ul>
<li>MySQL8以后默认有事务安全，即批量要么都成功要么都失败，不会出现部分问题</li>
</ul>
<h3 id="2、蠕虫复制"><a href="#2、蠕虫复制" class="headerlink" title="2、蠕虫复制"></a>2、蠕虫复制</h3><p><strong>蠕虫复制</strong>：从已有表中复制数据直接插入到另外一张表（同一张表）</p>
<ul>
<li>蠕虫复制的目标是<strong>快速增加表中的数据</strong><ul>
<li>实现表中数据复制（用于数据备份或者迁移）</li>
<li>实现数据的指数级递增（多用于测试）</li>
</ul>
</li>
<li>蠕虫复制语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名 [(字段列表)] select 字段列表 from 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意事项<ul>
<li>字段列表必须对应上</li>
<li>字段类型必须匹配上</li>
<li>数据冲突需要事先考虑</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定一张需要插入数据的表（一般与要蠕虫复制数据的表结构一致）</p>
<p>2、确定数据的来源表</p>
<ul>
<li>字段数量匹配</li>
<li>字段类型匹配</li>
<li>所选字段不存在冲突（数据可能是重复数据）</li>
</ul>
<p>3、使用蠕虫复制</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建一张新表，将t_30表中的数据迁移到新表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table t_35(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    stu_name varchar(20) not null,</span><br><span class="line">    course varchar(20) not null,</span><br><span class="line">    score decimal(5,2)</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_35 select * from t_30;</span><br></pre></td></tr></table></figure>



<p>2、快速让t_35表中的数据达到超过100条（重复执行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_35 (stu_name,course,score) select stu_name,course,score from t_35;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、蠕虫复制的目标就是批量利用已有数据来丰富表数据</p>
<ul>
<li>数据迁移：一次性复制表数据</li>
<li>数据增长：重复执行自我复制增长（数据测试使用）</li>
</ul>
<h3 id="3、主键冲突"><a href="#3、主键冲突" class="headerlink" title="3、主键冲突"></a>3、主键冲突</h3><p><strong>主键冲突</strong>：在数据进行插入时包含主键指定，而主键在数据表已经存在</p>
<ul>
<li><p>主键冲突的业务通常是发生在业务主键上（业务主键本身有业务意义）</p>
</li>
<li><p>主键冲突的解决方案</p>
<ul>
<li>忽略冲突：保留原始记录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert ignore into 表名 [(字段列表)] values(值列表);</span><br></pre></td></tr></table></figure>

<ul>
<li>冲突更新：冲突后部分字段变成更新</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名 [(字段列表)] values(值列表) on duplicate key update 字段 &#x3D; 新值[,字段&#x3D;新值...];</span><br><span class="line"># 1、尝试新增</span><br><span class="line"># 2、更新</span><br></pre></td></tr></table></figure>

<ul>
<li>冲突替换：先删除原有记录，后新增记录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace into 表名 [(字段列表)] values(值列表); # 效率没有insert高（需要检查是否冲突）</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定当前业务可能存在主键冲突</p>
<p>2、选择主键冲突的解决方案</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、用户名作为主键的用户注册（冲突不能覆盖）：username，password，regtime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table t_36(</span><br><span class="line">    username varchar(50) primary key,</span><br><span class="line">    password char(32) not null,</span><br><span class="line">    regtime int unsigned not null</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_36 values(&#39;username&#39;,&#39;password&#39;,12345678);</span><br><span class="line"># 冲突忽略</span><br><span class="line">insert ignore into t_36 values(&#39;username&#39;,&#39;12345678&#39;,12345678);</span><br></pre></td></tr></table></figure>



<p>2、用户名作为主键的记录用户使用信息（不存在新增、存在则更新时间）：username，logintime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table t_37(</span><br><span class="line">    username varchar(50) primary key,</span><br><span class="line">    logintime int unsigned</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_37 values(&#39;username&#39;,12345678);	# 当前时间戳</span><br><span class="line"></span><br><span class="line"># 冲突更新（替换部分字段数据）</span><br><span class="line">insert into t_37 values(&#39;username&#39;,12345678) on duplicate key update logintime &#x3D; unix_timestamp();	# 当前时间戳</span><br></pre></td></tr></table></figure>

<ul>
<li>如果主键不冲突：新增</li>
<li>如果主键冲突：更新指定字段</li>
<li>上述方式适用于字段较多，但是可能冲突时数据变化的字段较少</li>
</ul>
<p>3、用户名作为主键的记录用户使用信息（不存在新增、存在则更新全部）：username，logintime、clientinfo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table t_38(</span><br><span class="line">    username varchar(50) primary key,</span><br><span class="line">    logintime int unsigned,</span><br><span class="line">    clientinfo varchar(255) not null</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_38 values(&#39;username&#39;,unix_timestamp(),&#39;&#123;PC:chrome&#125;&#39;);</span><br><span class="line"></span><br><span class="line"># 替换插入</span><br><span class="line">replace into t_38 values(&#39;username&#39;,unix_timestamp(),&#39;&#123;phone:uc&#125;&#39;);</span><br></pre></td></tr></table></figure>

<ul>
<li>replace遇到主键重复就会先删除、后新增</li>
<li>如果有较多字段需要更新：建议使用替换</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、主键冲突的解决方案有三种，但是需要根据具体的业务来选择合适的方式</p>
<ul>
<li>忽略新数据：<code>insert ignore</code></li>
<li>更新部分数据：<code>insert ... on duplicate key update</code></li>
<li>全部替换：<code>replace into</code></li>
</ul>
<p>2、从效率上来讲，<code>insert into</code>不考虑冲突的效率最高，三种解决冲突的方式都会有效率下降（需要检索），其中三种本身的效率依次是：忽略新数据 &gt; 更新部分数据 &gt; 替换全部</p>
<h2 id="6-2-数据查询"><a href="#6-2-数据查询" class="headerlink" title="6.2 数据查询"></a>6.2 数据查询</h2><blockquote>
<p>小结</p>
</blockquote>
<p>1、数量掌握高级数据查询后，以前需要多次操作的业务基本都可以通过一些复杂SQL的编写实现一次性进行数据筛选提炼，从而达到一次性解决问题的要求</p>
<h3 id="1、查询选项"><a href="#1、查询选项" class="headerlink" title="1、查询选项"></a>1、查询选项</h3><p><strong>查询选项</strong>：用于对查询结果进行<strong>简单数据筛选</strong></p>
<ul>
<li>查询选项是在select关键字之后，有两个互斥值<ul>
<li>all：默认，表示保留所有记录</li>
<li>distinct：去重，重复的记录（所有字段都重复）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、查询的结果需要去除重复记录</p>
<p>2、使用distinct查询选项去重（默认就是all保留全部）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>查看商品表中所有品类的商品信息：重复的商品只保留一次（名字、价格、属性都一致）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create table t_39(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    goods_name varchar(50) not null,</span><br><span class="line">    goods_price decimal(10,2) default 0.00,</span><br><span class="line">    goods_color varchar(20),</span><br><span class="line">    goods_weight int unsigned comment &#39;重量，单位克&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_39 values(null,&#39;mate10&#39;,5499.00,&#39;blue&#39;,320),</span><br><span class="line">(null,&#39;mate10&#39;,5499.00,&#39;gray&#39;,320),</span><br><span class="line">(null,&#39;nokia3301&#39;,1299,&#39;black&#39;,420);</span><br><span class="line"></span><br><span class="line"># 考虑所有字段的去重（不含逻辑主键）</span><br><span class="line">select distinct goods_name,goods_price,goods_color,goods_weight from t_39;</span><br><span class="line">select goods_name,goods_price,goods_color,goods_weight from t_39; # 保留所有</span><br><span class="line"></span><br><span class="line"># 不考虑颜色去重</span><br><span class="line">select distinct goods_name,goods_price,goods_weight from t_39;</span><br><span class="line">select all goods_name,goods_price,goods_weight from t_39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、select选项主要是用来进行数据全保留或者去重选择的</p>
<ul>
<li>all：默认，保留全部（关键字可以没有）</li>
<li>distinct：手动选择，去重（针对所选字段构成的记录，而不是某个字段）</li>
</ul>
<p>2、distinct选项一般用于制作数据报表时使用</p>
<h3 id="2、字段选择-amp-别名"><a href="#2、字段选择-amp-别名" class="headerlink" title="2、字段选择&amp;别名"></a>2、字段选择&amp;别名</h3><p><strong>字段选择</strong>：根据实际需求选择的要获取数据的字段信息</p>
<ul>
<li>根据实际需求，明确所需要的字段名字，使用英文逗号<code>,</code>分隔</li>
<li>获取所有字段，使用星号<code>*</code>通配所有字段</li>
<li>字段数据可以不一定是来自数据源（select只要有结果即可）<ul>
<li>数据常量：<code>select 1</code></li>
<li>函数或者变量：<code>select unix_timestamp(),@@version</code> （@@是系统变量的前缀，后面跟变量名）</li>
</ul>
</li>
</ul>
<p><strong>字段别名</strong>：给字段取的临时名字</p>
<ul>
<li>字段别名使用as语法实现<ul>
<li>字段名 as 别名</li>
<li>字段名 别名</li>
</ul>
</li>
<li>字段别名的目的通常为了保护数据<ul>
<li>字段冲突：多张表同时操作有同名字段（系统默认覆盖），想保留全部</li>
<li>数据安全：对外提供数据不使用真实字段名字</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、明确需要查询的字段信息</p>
<ul>
<li>全部：<code>*</code></li>
<li>部分：确定字段列表</li>
</ul>
<p>2、确定存在数据冲突或者需要数据保护（通常可以理解为对外提供给别的系统访问）</p>
<ul>
<li>使用别名</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查询商品信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 全部查询</span><br><span class="line">select * from t_39;</span><br><span class="line"></span><br><span class="line"># 需求为商品名字和价格</span><br><span class="line">select goods_name,goods_price from t_39;</span><br><span class="line"></span><br><span class="line"># 别名使用</span><br><span class="line">select goods_name as gn,goods_price gp from t_39;</span><br></pre></td></tr></table></figure>

<p>2、不需要数据源的数据获取：select的表达式本身能算出结果）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前时间戳和版本号</span><br><span class="line">select unix_timestamp() as now,@@version as version,@@version;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、字段的选择只要在保证数据需求能实现的情况下，尽可能少使用<code>*</code>代替（MySQL优化）</p>
<ul>
<li>减少服务器的数据读取压力</li>
<li>减少网络传输压力</li>
<li>让客户端能够精确解析数据（不用大海捞针）</li>
</ul>
<p>2、字段别名的灵活使用一方面可以保证原始数据的安全，也可以为数据使用者提供便利</p>
<ul>
<li>同名字段覆盖问题（连表操作学习时会遇到）</li>
<li>原始字段保护</li>
<li>数据字段的简化</li>
</ul>
<p>3、select是SQL中用于取出数据的一种指令，这种指令未必一定需要从数据表取出数据，只要是本身能够有数据的表达式，都可以使用select获取</p>
<h3 id="3、数据源"><a href="#3、数据源" class="headerlink" title="3、数据源"></a>3、数据源</h3><p><strong>数据源</strong>：from关键字之后，数据的来源。只要最终结果是一个二维表，都可以当做数据源</p>
<ul>
<li>单表数据源：数据源就是一张表  <code>from 表名</code></li>
<li>多表数据源：数据来源是多张表（逗号分隔） <code>from  表名1,表名2,...表名N</code></li>
<li>子查询数据源：数据来源是一个查询结果 <code>from (select 字段列表 from 表名) as 别名</code><ul>
<li>数据源要求必须是一个<code>表</code></li>
<li>如果是查询结果必须给起一个表别名</li>
</ul>
</li>
<li>数据表也可以指定别名<ul>
<li>表名 as 别名</li>
<li>表名 别名</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、单表数据源：最简单的数据源，直接从一个数据表获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_27;</span><br></pre></td></tr></table></figure>

<p>2、多表数据源：利用一张表的一条数据匹配另外一张表的所有记录，记录结果为：记录数 = 表1记录数 * 表2记录数；字段数 = 表1字段数 + 表2字段数（笛卡尔积）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_27,t_30;</span><br></pre></td></tr></table></figure>

<p>3、子查询数据源：数据来源是一个select对应的查询结果</p>
<ul>
<li>查询语句需要使用括号包裹</li>
<li>查询结果需要指定别名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from (select * from t_27,t_30) t; # 数据有冲突查不出来</span><br><span class="line">select * from (select * from t_27) as t;</span><br></pre></td></tr></table></figure>

<p>4、如果有时候名字较长或者使用不方便，可以利用表别名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from t_30 as t;</span><br><span class="line"></span><br><span class="line">select t1.*,t2.stu_name from t_27 as t1,t_30 t2;</span><br></pre></td></tr></table></figure>

<ul>
<li>一般情况下别名设置是为了后续条件中可以直接使用别名</li>
<li>如果多表操作下，可以使用表别名来明确提取表字段</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据源是为查询、检索提供数据支持的，使用时需要明确指定</p>
<p>2、通常情况下数据源不会使用简单的多表数据源（笛卡尔积）</p>
<p>3、数据表的别名在负责SQL查询操作时非常有用，而且有些地方是必须使用（如子查询数据源）</p>
<h3 id="4、where子句"><a href="#4、where子句" class="headerlink" title="4、where子句"></a>4、where子句</h3><p><strong>where子句</strong>：跟在from数据源之后，对数据进行条件匹配</p>
<ul>
<li>where是在磁盘读取后，进入内存之前进行筛选<ul>
<li>不符合条件的数据不会进入内存</li>
</ul>
</li>
<li>where筛选的内容因为还没进入内存，所以数据是没有被加工过的<ul>
<li>字段别名不能在where中使用</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要查询的数据需要进行条件筛选</p>
<p>2、使用where进行数据筛选</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查询t_35表中学生为lily的成绩信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_35 where stu_name &#x3D; &#39;Lily&#39;;</span><br></pre></td></tr></table></figure>



<p>2、因为where是在磁盘取数据时进行条件筛选，此时数据没有进入内存，所以字段别名是无效的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">select stu_name name,score from t_35 where name &#x3D; &#39;Lily&#39;;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、where是用来匹配条件筛选数据的</p>
<p>2、where是在数据从磁盘取出，还没进入内存前进行筛选：筛选过后合适的才会进入到内存（后续才能显示）</p>
<p>3、成熟的项目中几乎每次执行查询都是会使用条件查询的</p>
<h3 id="5、运算符"><a href="#5、运算符" class="headerlink" title="5、运算符"></a>5、运算符</h3><p><strong>运算符</strong>：用于进行运算的符号</p>
<ul>
<li>比较运算符<ul>
<li>&gt;（大于）、&lt;（小于）、=（等于）、&gt;=（大于等于）、&lt;=（小于等于）、&lt;&gt;（不等于）</li>
<li>between  A  and  B：A和B之间（A小于B），包括A和B本身（数值比较）</li>
<li>in (数据1,数据2,…数据N)：在列举的数据之中</li>
<li>like ‘pattern’：像上面样的，用于字符串比较<ul>
<li>_：单下划线，匹配对应位置的一个任意字符（ab_：ab开头+一个字符，匹配abc，ab1，但不能匹配abcd）</li>
<li>%：匹配当前位置（往后）任意数量任意字符（ab%：ab开头+任意数量任意字符，匹配abc，ab1，abcd）</li>
</ul>
</li>
</ul>
</li>
<li>逻辑运算符<ul>
<li>and（逻辑与）、or（逻辑或）、not（逻辑非）</li>
</ul>
</li>
<li>null运算符<ul>
<li>is null（为空）、is not null（不为空）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要使用运算符进行运算</p>
<p>2、根据数据要求使用准确的运算符</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查询成绩不及格的所有学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 成绩条件：成绩是数值，又是比大小，可以直接使用比较运算符</span><br><span class="line">select * from t_35 where score &lt; 60;</span><br></pre></td></tr></table></figure>



<p>2、查询成绩在60-90间的学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 成绩条件：区间60到90，可以有两种解决方案</span><br><span class="line"></span><br><span class="line">select * from t_35 where score between 60 and 90;</span><br><span class="line">select * from t_35 where score &gt;&#x3D; 60 and score &lt;&#x3D; 90;</span><br></pre></td></tr></table></figure>



<p>3、查询还没有成绩的学生</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 成绩条件：成绩为null，所以不能用比较符号查，只能使用is null实现</span><br><span class="line">select * from t_35 where score is null;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、运算符可以用来进行字段数据运算，配合where进行条件筛选</p>
<p>2、基本运算符与其他编程语言都差不多，SQL中有几个特殊的要了解一下</p>
<ul>
<li>between and：一种&gt;= and &lt;=的便捷写法</li>
<li>in：用来做具体选择，类似于switch里的case</li>
<li>is null/is not null：字段值为Null的判定方式</li>
</ul>
<p>3、熟练应用的前提是不断熟练的使用，掌握每个运算符带来的结果和效果</p>
<h3 id="6、group-by子句"><a href="#6、group-by子句" class="headerlink" title="6、group by子句"></a>6、group by子句</h3><p><strong>group by子句</strong>：分组统计，根据某个字段将所有的<strong>结果分类</strong>，并进行<strong>数据统计分析</strong></p>
<ul>
<li>分组的目的不是为了显示数据，一定是为了统计数据</li>
<li>group by子句一定是出现在where子句之后（如果同时存在）</li>
<li>分组统计可以进行统计细分：先分大组，然后大组分小组</li>
<li>分组统计需要使用统计函数<ul>
<li>group_concat()：将组里的某个字段全部保留</li>
<li>any_value()：不属于分组字段的任意一个组里的值</li>
<li>count()：求对应分组的记录数量<ul>
<li>count(字段名)：统计某个字段值的数量（NULL不统计）</li>
<li>count(*)：统计整个记录的数量（较多）</li>
</ul>
</li>
<li>sum()：求对应分组中某个字段是和</li>
<li>max()/min()：求对应分组中某个字段的最大/最小值</li>
<li>avg()：求对应分组中某个字段的平均值</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要进行数据统计</p>
<p>2、确定统计对象：分组字段（可以多个）</p>
<p>3、确定要统计的数据形式：选择对应统计函数</p>
<p>4、分组统计</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建一张表，存储学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create table t_40(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">name varchar(10) not null,</span><br><span class="line">gender enum(&#39;男&#39;,&#39;女&#39;,&#39;保密&#39;),</span><br><span class="line">age tinyint unsigned not null,</span><br><span class="line">class_name varchar(10) not null comment &#39;班级名称&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_40 values(null,&#39;鸣人&#39;,&#39;男&#39;,18,&#39;木叶1班&#39;),</span><br><span class="line">(null,&#39;佐助&#39;,&#39;男&#39;,18,&#39;木叶1班&#39;),</span><br><span class="line">(null,&#39;佐井&#39;,&#39;男&#39;,19,&#39;木叶2班&#39;),</span><br><span class="line">(null,&#39;大蛇丸&#39;,&#39;男&#39;,28,&#39;木叶0班&#39;),</span><br><span class="line">(null,&#39;卡卡西&#39;,&#39;男&#39;,29,&#39;木叶0班&#39;),</span><br><span class="line">(null,&#39;小樱&#39;,&#39;女&#39;,18,&#39;木叶1班&#39;),</span><br><span class="line">(null,&#39;雏田&#39;,&#39;女&#39;,18,&#39;木叶1班&#39;),</span><br><span class="line">(null,&#39;我爱罗&#39;,&#39;男&#39;,19,&#39;木叶1班&#39;),</span><br><span class="line">(null,&#39;向日葵&#39;,&#39;女&#39;,6,&#39;木叶10班&#39;),</span><br><span class="line">(null,&#39;博人&#39;,&#39;男&#39;,8,&#39;木叶10班&#39;),</span><br><span class="line">(null,&#39;鼬&#39;,&#39;男&#39;,28,&#39;木叶0班&#39;);</span><br></pre></td></tr></table></figure>



<p>2、统计每个班的人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),class_name from t_40 group by class_name;</span><br></pre></td></tr></table></figure>



<p>3、多分组：统计每个班的男女学生数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),class_name,gender from t_40 group by class_name,gender;</span><br></pre></td></tr></table></figure>



<p>4、统计每个班里的人数，并记录班级学生的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(*),group_concat(name),class_name from t_40 group by class_name;</span><br><span class="line">select count(*),any_value(name),class_name from t_40 group by class_name;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>分组原理</p>
</blockquote>
<p>以统计班级学生为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(获取数据后分组开始)--&gt;B[匹配班级名字分组]</span><br><span class="line">B--&gt;|木叶1班|C[木叶1班组&lt;br&gt;鸣人&lt;br&gt;佐助&lt;br&gt;小樱&lt;br&gt;雏田&lt;br&gt;我爱罗]</span><br><span class="line">B--&gt;|木叶2班|D[木叶2班组&lt;br&gt;佐井]</span><br><span class="line">B--&gt;|木叶0班|E[木叶0班组&lt;br&gt;大蛇丸&lt;br&gt;卡卡西&lt;br&gt;鼬]</span><br><span class="line">B--&gt;|木叶10班|F[木叶10班组&lt;br&gt;博人&lt;br&gt;向日葵]</span><br><span class="line">C--&gt;G[统计结果&lt;br&gt;只对结果负责&lt;br&gt;结果就是函数,而函数只对小组工作&lt;br&gt;木叶1班组5人 木叶2班组1人 木叶0班组3人 木叶10班组2人]</span><br><span class="line">D--&gt;G</span><br><span class="line">E--&gt;G</span><br><span class="line">F--&gt;G</span><br><span class="line">G--&gt;H[返回结果]</span><br><span class="line">H--&gt;I((分组结束))</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、分组与统计是不分离的，分组必然要用到统计，而统计一旦使用实际上就进行了分组</p>
<p>2、分组统计使用数据数据的查询只能依赖统计函数和被分组字段，而不能是其他字段（MySQL7以前可以，不过数据没意义：因为系统只保留组里的第一个）</p>
<p>3、group by子句有自己明确的位置：在where之后（where可以没有）</p>
<h3 id="7、回溯统计"><a href="#7、回溯统计" class="headerlink" title="7、回溯统计"></a>7、回溯统计</h3><p><strong>回溯统计</strong>：在进行分组时（通常是多分组），每一次结果的回溯都进行一次汇总统计</p>
<ul>
<li>回溯统计语法：在统计之后使用 <code>with rollup</code></li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要进行分组统计</p>
<p>2、确定是多分组统计</p>
<p>3、需要对每次分组结果进行汇总</p>
<p>4、使用回溯统计</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>统计每个班的男女同学数量，同时要知道班级人数总数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 只统计每个班的男女同学数量，没有班级汇总</span><br><span class="line">select count(*),class_name,gender,group_concat(name) from t_40 group by class_name,gender;</span><br><span class="line"></span><br><span class="line"># 汇总统计：回溯</span><br><span class="line">select count(*),class_name,gender,group_concat(name) from t_40 group by class_name,gender with rollup;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>回溯统计原理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(统计开始)--&gt;B[大分组:班级名字分组]</span><br><span class="line">B--&gt;|木叶1班|C[木叶1班组&lt;br&gt;鸣人&lt;br&gt;佐助&lt;br&gt;小樱&lt;br&gt;雏田&lt;br&gt;我爱罗]</span><br><span class="line">B--&gt;|木叶2班|D[木叶2班组&lt;br&gt;佐井]</span><br><span class="line">B--&gt;|木叶0班|E[木叶0班组&lt;br&gt;大蛇丸&lt;br&gt;卡卡西&lt;br&gt;鼬]</span><br><span class="line">B--&gt;|木叶10班|F[木叶10班组&lt;br&gt;博人&lt;br&gt;向日葵]</span><br><span class="line">C--&gt;G[小分组:性别分组]</span><br><span class="line">G--&gt;|男|H[木叶1班组:男&lt;br&gt;鸣人&lt;br&gt;佐助&lt;br&gt;我爱罗]</span><br><span class="line">G--&gt;|女|I[木叶1班组:女&lt;br&gt;小樱&lt;br&gt;雏田]</span><br><span class="line">D--&gt;J[小分组:性别分组]</span><br><span class="line">J--&gt;|男|K[木叶2班组:男&lt;br&gt;佐井]</span><br><span class="line">E--&gt;L[小分组:性别分组]</span><br><span class="line">L--&gt;|男|M[木叶0班组:男&lt;br&gt;大蛇丸&lt;br&gt;卡卡西&lt;br&gt;鼬]</span><br><span class="line">F--&gt;N[小分组:性别分组]</span><br><span class="line">N--&gt;|男|O[木叶10班组:男&lt;br&gt;博人]</span><br><span class="line">N--&gt;|女|P[木叶10班组:女&lt;br&gt;向日葵]</span><br><span class="line">H--&gt;Q[性别回溯&lt;br&gt;木叶1班组:NULL&lt;br&gt;鸣人&lt;br&gt;佐助&lt;br&gt;小樱&lt;br&gt;雏田&lt;br&gt;我爱罗]</span><br><span class="line">I--&gt;Q</span><br><span class="line">K--&gt;R[性别回溯&lt;br&gt;木叶2班组:NULL&lt;br&gt;佐井]</span><br><span class="line">M--&gt;S[性别回溯&lt;br&gt;木叶0班组:NULL&lt;br&gt;大蛇丸&lt;br&gt;卡卡西&lt;br&gt;鼬]</span><br><span class="line">O--&gt;T[性别回溯&lt;br&gt;木叶10班组:NULL&lt;br&gt;博人&lt;br&gt;向日葵]</span><br><span class="line">P--&gt;T</span><br><span class="line">Q--&gt;U[班级名字回溯&lt;br&gt;NULL:NULL&lt;br&gt;全部人]</span><br><span class="line">R--&gt;U</span><br><span class="line">S--&gt;U</span><br><span class="line">T--&gt;U</span><br><span class="line">U--&gt;V((回溯统计结束))</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结+</p>
</blockquote>
<p>1、回溯统计一般用在多字段分组中，用来统计各级分组的汇总数据</p>
<p>2、因为回溯统计会将对应的分组字段置空（不置空无法合并），所以回溯的数据还需要经过其他程序语言加工处理才能取出数据来</p>
<h3 id="8、分组排序"><a href="#8、分组排序" class="headerlink" title="8、分组排序"></a>8、分组排序</h3><p><strong>分组排序</strong>：在分组后统计结果时可以根据分组字段进行升序或者降序显示数据</p>
<ul>
<li>默认的系统就会自动对分组结果根据分组字段进行升序排序</li>
<li>可以设定分组结果的排序方式<ul>
<li>group by 字段名 [ASC]：升序排序（默认）</li>
<li>group by 字段名 DESC：降序排序</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定使用分组统计</p>
<p>2、需要对结果进行降序排序（升序不用管）</p>
<p>3、使用分组降序排序</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>对分组结果女性优先显示：gender为枚举，男值为1，女值为2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),class_name,gender,group_concat(name),any_value(name) from t_40 group by class_name,gender desc;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、分组排序是针对分组的结果，通过分组字段进行排序</p>
<p>2、一般情况下较少使用分组排序</p>
<h3 id="9、having子句"><a href="#9、having子句" class="headerlink" title="9、having子句"></a>9、having子句</h3><p><strong>having子句</strong>：类似于where子句，是用来进行条件筛选数据的</p>
<ul>
<li><p>having子句本身是针对<strong>分组统计结果进行条件筛选</strong>的</p>
</li>
<li><p>having子句必须出现在group by子句之后（如果同时存在）</p>
</li>
<li><p>having针对的数据是在内存里已经加载的数据</p>
</li>
<li><p>having几乎能做where能做的所有事，但是where却不一定</p>
<ul>
<li>字段别名（where针对磁盘数据，那时还没有）</li>
<li>统计结果（where在group by之前）</li>
<li>分组统计函数（having通常是针对group by存在的）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、前面有分组统计</p>
<p>2、需要针对分组统计后的结果进行数据筛选</p>
<p>3、使用having组织条件进行筛选</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、获取班级人数小于3的班级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select count(*) as &#96;count&#96;,class_name,group_concat(name) from t_40 group by class_name having &#96;count&#96; &lt; 3;</span><br><span class="line"></span><br><span class="line">select count(*) as &#96;count&#96;,class_name,group_concat(name) from t_40 group by class_name having count(*) &lt; 3; # 多用了一次函数（效率降低）</span><br><span class="line"></span><br><span class="line">select class_name,group_concat(name) from t_40 group by class_name having count(*) &lt; 3; # 没办法，前面没统计，只能自己统计</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、having也是用于数据筛选的，但是本质是针对分组统计，如果没有分组统计，不要使用having进行数据筛选</p>
<p>2、能用where解决问题的地方绝不使用having</p>
<ul>
<li>where针对磁盘读取数据，源头解决问题</li>
<li>where能够限制无效数据进入内存，内存利用率较高，而having是针对内存数据筛选</li>
</ul>
<h3 id="10、order-by子句"><a href="#10、order-by子句" class="headerlink" title="10、order by子句"></a>10、order by子句</h3><p><strong>order by子句</strong>：排序，根据某个指定的字段进行升序或者降序排序</p>
<ul>
<li>排序的参照物是校对集</li>
<li>order by子句在having子句字后（如果同时存在）</li>
<li>排序分为升序和降序：默认是升序<ul>
<li>order by 字段 [ASC]：升序</li>
<li>order by 字段 DESC：降序</li>
</ul>
</li>
<li>多字段排序：在根据某个字段排序好后，可以再细分排序</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要排序的字段</p>
<p>2、确定排序的方式：升序 or 降序</p>
<p>3、使用排序</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、单字段排序：给所有学生按照年纪大小升序排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 order by age;</span><br><span class="line">select * from t_40 order by age asc;</span><br></pre></td></tr></table></figure>

<p>2、多字段排序：先性别降序排序，然后按年龄升序排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 order by gender desc,age;</span><br><span class="line">select * from t_40 order by gender desc,age asc;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、排序是针对前面所得到的结果进行排序（已经进入到内存的数据）</p>
<p>2、多字段排序是在第一个字段排好序的情况下，不改变原来排序的基调后，再小范围排序（类似分组）</p>
<p>3、实际开发中排序的使用非常常见，尤其是在数值、时间上多见</p>
<h3 id="11、limit子句"><a href="#11、limit子句" class="headerlink" title="11、limit子句"></a>11、limit子句</h3><p><strong>limit子句</strong>：限制数据的获取数量（记录数）</p>
<ul>
<li>limit子句必须在order by子句之后（如果同时存在）</li>
<li>limit限制数量的方式有两种<ul>
<li>limit 数量：限制获取的数量（不保证一定能获取到指定数量）</li>
<li>limit 起始位置,数量：限制数据获取的位置以及数量（分页）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要对记录数进行限制</p>
<p>2、确定限制的方式：限定数量 or 限定位置+限定数量</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、获取t_40表中前3条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 limit 3;</span><br></pre></td></tr></table></figure>

<p>2、获取t_40表中第3条以后的3条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 limit 3,3;</span><br><span class="line">select * from t_40 limit 6,3;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、limit限制数量可以有效的减少服务器的压力和传输压力</p>
<p>2、常利用limit来实现分页获取数据</p>
<h3 id="12、总结"><a href="#12、总结" class="headerlink" title="12、总结"></a>12、总结</h3><p>1、查询操作是所有操作里使用的最多也是最终的操作</p>
<p>2、查询操作的完整语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select select选项 字段列表[别名]|* from 数据源[别名] where子句 group by子句 having子句 order by子句 limit 子句;</span><br></pre></td></tr></table></figure>

<ul>
<li>各个位置的顺序不能调换</li>
<li>五子句（where、group by、having、order by、limit）可以没有，但是出现后一定要保证顺序</li>
<li>group by到最后都是针对已经加载带内存中的数据进行加工处理</li>
</ul>
<p>3、很多结构的组合其实可以达到同一效果，但是可能过程和效率会不同</p>
<h2 id="6-3-数据更新"><a href="#6-3-数据更新" class="headerlink" title="6.3 数据更新"></a>6.3 数据更新</h2><p><strong>限制更新</strong>：即更新时对更新的记录数进行限制</p>
<ul>
<li>限制更新通过limit来实现</li>
<li>限制更新其实是局部更新的一种手段，一般更多情况下是依据条件精确更新</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要进行批量更新：符合条件的部分</p>
<p>2、确定更新的数量</p>
<p>3、使用limit限制更新数量</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>对会员选3个发送10元红包（添加到账户）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table t_41(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    username varchar(50) not null unique,</span><br><span class="line">    password char(32) not null,</span><br><span class="line">    account decimal(10,2) default 0.00</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_41 values(null,&#39;username1&#39;,&#39;password&#39;,default),</span><br><span class="line">(null,&#39;username2&#39;,&#39;password&#39;,default),</span><br><span class="line">(null,&#39;username3&#39;,&#39;password&#39;,default),(null,&#39;username4&#39;,&#39;password&#39;,default),(null,&#39;username5&#39;,&#39;password&#39;,default);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update t_41 set account &#x3D; account + 10 limit 3;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、限制更新可以实现批量小范围操作</p>
<p>2、实际开发当中，极少出现这类操作，一般都愿意精准操作（利用where条件明确更新条件）</p>
<p>3、更新操作不可逆</p>
<h2 id="6-4-数据删除"><a href="#6-4-数据删除" class="headerlink" title="6.4 数据删除"></a>6.4 数据删除</h2><blockquote>
<p>学习目标：了解数据删除的其他规则，理解数据删除的危害</p>
</blockquote>
<ul>
<li>限制删除</li>
<li>清空数据</li>
</ul>
<h3 id="1、限制删除"><a href="#1、限制删除" class="headerlink" title="1、限制删除"></a>1、限制删除</h3><p><strong>限制删除</strong>：限制要删除的记录数</p>
<ul>
<li>使用limit限制删除数量</li>
<li>一般很少使用限制删除，通常是通过where条件精确删除</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要进行数据批量删除</p>
<p>2、确定通过where条件限定后无法完全满足删除条件</p>
<p>3、使用limit限制删除数量完成目标</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>删除没有账户余额的一个用户（当前用户量少，一般数量会大些）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from t_41 where account &#x3D; 0 limit 1;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、限制删除本质也是删除，操作不可逆，谨慎使用</p>
<p>2、更愿意使用精确删除</p>
<h3 id="2、清空数据"><a href="#2、清空数据" class="headerlink" title="2、清空数据"></a>2、清空数据</h3><p><strong>清空数据</strong>：将表中的所有数据清除，并且将表的所有状态回到原始状态</p>
<ul>
<li>清空数据的本质是先删除表，后创建表</li>
<li>清空数据能够让表的一些变化状态回到原始状态<ul>
<li>自增长重新回到初始值</li>
</ul>
</li>
<li>清空语法： <code>truncate 表名</code></li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要删除表中所有数据</p>
<p>2、确定需要让表状态回到原始</p>
<p>3、truncate清空数据</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>清空用户数据表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate t_41;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、清空数据表是一种比delete更彻底的数据删除方式，所以使用之前必须要慎重</p>
<p>2、一般只会在开发阶段才会使用这种数据删除操作，如表数据发生错乱，或者业务发生变化</p>
<h1 id="7-MySQL多表操作"><a href="#7-MySQL多表操作" class="headerlink" title="7 MySQL多表操作"></a>7 MySQL多表操作</h1><blockquote>
<p>示例</p>
</blockquote>
<p>不管是大型还是小型项目，一个数据库里都会有N张表，表之间也通过一对一、多对一或者多对多关系进行关联：如新闻管理系统</p>
<p>作者表：id、用户名、密码</p>
<p>新闻表：id、标题、内容、发布时间、作者id</p>
<p>显示新闻的时候是肯定需要显示作者姓名的</p>
<ul>
<li>原始方式：查出新闻–&gt;查出作者ID–&gt;查出作者<ul>
<li>步骤多</li>
<li>如果是批量显示新闻就更麻烦</li>
</ul>
</li>
<li>多表操作：使用连接查询一条SQL搞定</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、多表操作是实际开发时经常遇到的解决问题的方案</p>
<p>2、多表操作能够在数据库层就实现大量数据的组合或者筛选</p>
<h2 id="7-1-联合查询"><a href="#7-1-联合查询" class="headerlink" title="7.1 联合查询"></a>7.1 联合查询</h2><h3 id="1、联合查询"><a href="#1、联合查询" class="headerlink" title="1、联合查询"></a>1、联合查询</h3><p><strong>联合查询</strong>：union，是指将多个查询结果合并成一个结果显示</p>
<ul>
<li>联合查询是针对查询结果的合并（多条select语句合并）</li>
<li>联合查询语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 查询【决定字段名字】</span><br><span class="line">    union 查询选项</span><br><span class="line">select 查询</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>联合查询要求：联合查询是结果联合显示<ul>
<li>多个联合查询的字段结果数量一致</li>
<li>联合查询的字段来源于第一个查询语句的字段</li>
</ul>
</li>
<li>查询选项：与select选项雷士<ul>
<li>all：保留所有记录</li>
<li>distinct：保留去重记录（默认）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要进行多个表数据的联合操作</p>
<ul>
<li>表结构一致</li>
<li>数据汇总</li>
</ul>
<p>2、确定数据的要求：全部保留 or 去重</p>
<p>3、使用联合查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建一个表与t_40，并插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table t_42 like t_40;</span><br><span class="line"></span><br><span class="line">insert into t_42 values(null,&#39;犬夜叉&#39;,&#39;男&#39;,200,&#39;神妖1班&#39;),</span><br><span class="line">(null,&#39;日暮戈薇&#39;,&#39;女&#39;,16,&#39;现代1班&#39;),</span><br><span class="line">(null,&#39;桔梗&#39;,&#39;女&#39;,88,&#39;法师1班&#39;),</span><br><span class="line">(null,&#39;弥勒&#39;,&#39;男&#39;,28,&#39;法师2班&#39;),</span><br><span class="line">(null,&#39;珊瑚&#39;,&#39;女&#39;,20,&#39;法师2班&#39;),</span><br><span class="line">(null,&#39;七宝&#39;,&#39;保密&#39;,5,&#39;宠物1班&#39;),</span><br><span class="line">(null,&#39;杀生丸&#39;,&#39;男&#39;,220,&#39;神妖1班&#39;),</span><br><span class="line">(null,&#39;铃&#39;,&#39;女&#39;,4,&#39;现代1班&#39;),</span><br><span class="line">(null,&#39;钢牙&#39;,&#39;男&#39;,68,&#39;神妖1班&#39;),</span><br><span class="line">(null,&#39;奈落&#39;,&#39;男&#39;,255,&#39;神妖1班&#39;),</span><br><span class="line">(null,&#39;神乐&#39;,&#39;女&#39;,15,&#39;神妖2班&#39;);</span><br></pre></td></tr></table></figure>

<ul>
<li>t_42与t_40结构一样，可以理解为因为数据量大拆分到了两个表中</li>
</ul>
<p>2、使用联合查询将两张表的数据拼接到一起显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 </span><br><span class="line">union</span><br><span class="line">select * from t_42;</span><br></pre></td></tr></table></figure>



<p>3、联合查询选项默认是distinct</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40</span><br><span class="line">union </span><br><span class="line">select * from t_40;</span><br><span class="line"></span><br><span class="line">select * from t_40</span><br><span class="line">union all</span><br><span class="line">select * from t_40;</span><br></pre></td></tr></table></figure>



<p>4、联合查询不要求字段类型一致，只对数量要求一致，而且字段与第一条查询语句相关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select name from t_40</span><br><span class="line">union all</span><br><span class="line">select age from t_40;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：如果数据不能对应，那么查询没有意义</li>
</ul>
<p>5、如果使用where对数据进行筛选，where针对的是select指令，而不是针对union结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40 </span><br><span class="line">union all</span><br><span class="line">select * from t_42</span><br><span class="line">where gender &#x3D; &#39;女&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>where只针对第二条select有效</li>
<li>若要全部有效，需要select都使用where</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、union是负责将多次查询的结果统一拼凑显示</p>
<ul>
<li>记录数增加</li>
<li>字段数不变（第一条SQL指令决定）</li>
</ul>
<p>2、union常用方式</p>
<ul>
<li>因为数据量大分表存储，然后统一查看或者统计</li>
<li>根据不同维度对数据进行筛选，然后统一查看或者统计</li>
</ul>
<p>3、union默认是去重的，想要保留全部查询结果，需要使用union all</p>
<h3 id="2、联合查询排序"><a href="#2、联合查询排序" class="headerlink" title="2、联合查询排序"></a>2、联合查询排序</h3><p><strong>联合查询排序</strong>：针对联合查询的结果进行排序</p>
<ul>
<li>order by本身是对内存结果进行排序，union的优先级高于order by，所以order by默认是对union结果进行排序</li>
<li>如果想要对单独select的结果进行排序，需要两个步骤<ul>
<li>将需要排序的select指令进行括号包裹（括号里使用order by）</li>
<li>order by必须配合limit才能生效（limit一个足够大的数值即可）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要对联合查询进行排序</p>
<p>2、确定排序内容</p>
<ul>
<li>针对union结果排序</li>
<li>针对union前的select结果进行排序</li>
</ul>
<p>3、选择合适的排序方式</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、将t_40和t_42表的结果使用年龄降序排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from t_40</span><br><span class="line">union all</span><br><span class="line">select * from t_42</span><br><span class="line">order by age desc; #针对的是整个union之后的结果</span><br></pre></td></tr></table></figure>



<p>2、t_40表按年龄降序排序，t_42表按年龄升序排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 无效方式</span><br><span class="line">(select * from t_40 order by age desc)</span><br><span class="line">union </span><br><span class="line">(select * from t_42 order by age);</span><br><span class="line"></span><br><span class="line"># 正确方式</span><br><span class="line">(select * from t_40 order by age desc limit 99999)</span><br><span class="line">union </span><br><span class="line">(select * from t_42 order by age desc limit 99999);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、联合排序需要区分排序的内容是select结果还是union结果</p>
<ul>
<li>union结果：在最后使用排序即可</li>
<li>select结构：需要针对select使用排序<ul>
<li>select必须使用括号包裹</li>
<li>select里的排序必须配合limit才会生效</li>
</ul>
</li>
</ul>
<h2 id="7-2-连接查询"><a href="#7-2-连接查询" class="headerlink" title="7.2 连接查询"></a>7.2 连接查询</h2><p><strong>连接查询</strong>：join，将两张表依据某个条件进行数据拼接</p>
<ul>
<li>join左右各一张表：join关键字左边的表叫左表，右边的表叫右表</li>
<li>连接查询的结果都是记录会保留左右表的所有字段（字段拼接）<ul>
<li>具体字段数据依据查询需求确定</li>
<li>表字段冲突需要使用表别名和字段别名区分</li>
</ul>
</li>
<li>不同的连表有不同的连接方式，对于结果的处理也不尽相同</li>
<li>连接查询不限定表的数量，可以进行多表连接，只是表的连接需要一个一个的连（A join B join C …）</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、连接查询就是通过字段拼接，把两张表的记录变成一条记录：字段数量增加</p>
<p>2、连接查询的目的是将分散在不同表的数据组合到一起，方便外部使用数据</p>
<h3 id="1、交叉连接"><a href="#1、交叉连接" class="headerlink" title="1、交叉连接"></a>1、交叉连接</h3><p><strong>交叉连接</strong>：cross join，不需要连接条件的连接</p>
<ul>
<li>交叉连接产生的结果就是笛卡尔积<ul>
<li>左表的每一条记录都会与右表的所有记录连接并保留</li>
</ul>
</li>
<li>交叉连接没有实际数据价值，只是丰富了连接查询的完整性</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>交叉连接t_41和t_42表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_41 cross join t_42; # t_41,t_42</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、笛卡尔积无意义，尽量避免出现</p>
<h3 id="2、内连接"><a href="#2、内连接" class="headerlink" title="2、内连接"></a>2、内连接</h3><p><strong>内连接</strong>：[inner] join，将两张表根据指定的条件连接起来，严格连接</p>
<ul>
<li>内连接是将一张表的每一条记录去另外一张表根据条件匹配<ul>
<li>匹配成功：保留连接的数据</li>
<li>匹配失败：都不保留</li>
</ul>
</li>
<li>内连接语法： <code>左表 join 右表 on 连接条件</code></li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要从多张表中获取数据组成记录</p>
<p>2、确定连接的要求是保留连接成功的，不成功的数据不要</p>
<p>3、使用内连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、设计学生表和专业表：学生对专业多对一关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 学生表</span><br><span class="line">create table t_43(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    course_no int</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_43 values(null,&#39;Student1&#39;,1),</span><br><span class="line">(null,&#39;Student2&#39;,1),</span><br><span class="line">(null,&#39;Student3&#39;,2),</span><br><span class="line">(null,&#39;Student4&#39;,3),</span><br><span class="line">(null,&#39;Student5&#39;,1),</span><br><span class="line">(null,&#39;Student6&#39;,default);</span><br><span class="line"></span><br><span class="line"># 专业表</span><br><span class="line">create table t_44(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null unique</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_44 values(null,&#39;Computer&#39;),(null,&#39;Software&#39;),(null,&#39;Network&#39;);</span><br></pre></td></tr></table></figure>



<p>2、获取已经选择了专业的学生信息，包括所选专业</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 学生和专业在两个表中，所以需要连表</span><br><span class="line"># 学生必须有专业，而专业也必须存在，所以是内连接</span><br><span class="line"># 连接条件：专业编号</span><br><span class="line"># 两张表有两个字段冲突：id、name，所以需要使用别名</span><br><span class="line">select t_43.*,t_44.name as course_name from t_43 inner join t_44 on t_43.course_no &#x3D; t_44.id;</span><br><span class="line"></span><br><span class="line"># 表名的使用也可以使用别名</span><br><span class="line">select s.*,c.name as c_name from t_43 as s inner join t_44 c on s.course_no &#x3D; c.id;</span><br></pre></td></tr></table></figure>

<ul>
<li>字段冲突的话在MySQL里倒是不影响，只是会同时存在，但是后续其他地方使用就不方便了</li>
</ul>
<blockquote>
<p>原理分析</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(连接开始&lt;br&gt;A inner join B on a.aid &#x3D; b.id)--&gt;B[连接条件循环匹配匹配&lt;br&gt;A表逐条取出记录与B表的每条记录匹配]</span><br><span class="line">B--&gt;|a.aid &#x3D; b.id|C[保留匹配结果&lt;br&gt;根据字段要求保留]</span><br><span class="line">C--&gt;|继续下一个|B</span><br><span class="line">B--&gt;E[全部匹配完毕]</span><br><span class="line">B--&gt;|a.aid &lt;&gt; b.id|D[放弃]</span><br><span class="line">D--&gt;|继续下一个|B</span><br><span class="line">E--&gt;F((取出所有匹配成功结果:结束))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、内连接匹配规则就是必须保证左表和右表同时存储连接关系，这样的数据才会保留</p>
<p>2、扩展：内连接可以没有on条件，那么得到的结果就是交叉连接（笛卡尔积），无意义</p>
<p>3、扩展：内连接的on关键字可以换成where，结果是一样（但是不建议使用）</p>
<h3 id="3、外连接"><a href="#3、外连接" class="headerlink" title="3、外连接"></a>3、外连接</h3><p><strong>外连接</strong>：outer join，是一种不严格的连接方式</p>
<ul>
<li>外连接分为两种<ul>
<li>左外连接（左连接）：left join</li>
<li>右外连接（右连接）：right join</li>
</ul>
</li>
<li>外连接有主表和从表之分<ul>
<li>左连接：左表为主表</li>
<li>右连接：右表为主表</li>
</ul>
</li>
<li>外连接是将主表的记录去匹配从表的记录<ul>
<li>匹配成功保留</li>
<li>匹配失败（全表）：也保留，只是从表字段置空</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定进行连表操作</p>
<p>2、确定要有数据保护，即表中数据匹配失败也要保留</p>
<p>3、确定主从表</p>
<p>4、选择对应外连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查出所有的学生信息，包括所在班级（左连接）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主要数据是学生，而且是全部学生：外连接、且学生表是主表</span><br><span class="line">select s.*,c.name c_name from t_43 s left join t_44 c on s.course_no &#x3D; c.id;</span><br></pre></td></tr></table></figure>



<p>2、查出所有班级里的所有学生（右连接）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主表是班级</span><br><span class="line">select s.*,c.name c_name from t_43 s right join t_44 c on s.course_no &#x3D; c.id;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、外连接与内连接的区别在于数据匹配失败的时候，外连接会保留一条记录</p>
<ul>
<li>主表数据保留</li>
<li>从表数据置空</li>
</ul>
<p>2、外连接不论是左连接还是右连接，字段的顺序不影响，都是先显示左表数据，后显示右表数据</p>
<p>3、外连接必须使用on作为连接条件（不能没有或者使用where替代）</p>
<h3 id="4、自然连接"><a href="#4、自然连接" class="headerlink" title="4、自然连接"></a>4、自然连接</h3><p><strong>自然连接</strong>：natural join，是一种自动寻找连接条件的连接查询</p>
<ul>
<li><p>自然连接不是一种特殊的连接方式，而是一种自动匹配条件的连接</p>
</li>
<li><p>自然连接包含自然内连接和自然外连接</p>
<ul>
<li>自然内连接：natural join</li>
<li>自然外连接：natural left/right join</li>
</ul>
</li>
<li><p>自然连接条件匹配模式：自动寻找相同字段名作为连接条件（字段名相同）</p>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、需要进行连表查询结果</p>
<p>2、连表查询的表字段能够直接关联（字段名字相同：非常高的表结构设计）</p>
<p>3、选择合适的连接方式：内连接 or 外连接</p>
<p>4、使用自然连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、自然连接t_43和t_44表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  * from t_43 natural join t_44;</span><br></pre></td></tr></table></figure>

<p>2、自然连接是不管字段是否有关系的，只管名字是否相同：如果想要自然连接成功，那么字段的设计就必须非常规范</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create table t_45(</span><br><span class="line">    s_id int primary key auto_increment,</span><br><span class="line">    s_name varchar(50) not null,</span><br><span class="line">    c_id int comment &#39;课程id&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_45 select * from t_43;</span><br><span class="line"></span><br><span class="line">create table t_46(</span><br><span class="line">    c_id int primary key auto_increment,</span><br><span class="line">    c_name varchar(50) not null unique</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_46 select * from t_44;</span><br><span class="line"></span><br><span class="line"># 自然连接：条件只有一个相同的c_id</span><br><span class="line">select * from t_45 natural join t_46;</span><br></pre></td></tr></table></figure>

<ul>
<li>自然连接会将同名条件合并成一个字段（数据一样）</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、自然连接本身不是一种特别连接，是基于内连接、外连接和交叉连接实现自动条件匹配而已</p>
<ul>
<li>没有条件（没有同名字段）：交叉连接</li>
<li>有条件：内连接/外连接（看关键字使用）</li>
</ul>
<p>2、自然连接使用较少，因为一般情况下表的设计很难做到完全标准或者不会出现无关同名字段</p>
<h3 id="5、using关键字"><a href="#5、using关键字" class="headerlink" title="5、using关键字"></a>5、using关键字</h3><p><strong>using关键字</strong>：连接查询时如果是同名字段作为连接条件，using可以代替on出现（比on更好）</p>
<ul>
<li>using是针对同名字段（using(id) === A.id = B.id）</li>
<li>using关键字使用后会自动合并对应字段为一个</li>
<li>using可以同时使用多个字段作为条件</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、需要进行连表进行数据查询</p>
<p>2、两个表的连接条件字段同名</p>
<p>3、使用using关键字作为连接条件</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>查询t_45中所有的学生信息，包括所在班级名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select s.*,c.c_name from t_45 s left join t_46 c using(c_id);</span><br><span class="line">select * from t_45 s left join t_46 c using(c_id);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、using关键字用来简化同名条件字段的连接条件行为</p>
<p>2、using关键字与自然连接相似，但是比自然连接灵活，可以指定有效的同名连接条件，忽略无效的同名字段</p>
<h3 id="6、总结-1"><a href="#6、总结-1" class="headerlink" title="6、总结"></a>6、总结</h3><p>1、连接查询是实际开发过程中应用最多的查询方式</p>
<ul>
<li>很少出现单表查询操作</li>
<li>实体（表）间或多或少都是有关联的</li>
</ul>
<p>2、连接查询的效率肯定没有单表查询高</p>
<ul>
<li>逆规范化可以适当的运用来提升效率</li>
</ul>
<p>3、连接查询中使用的较多的就是内连接和外连接</p>
<h2 id="7-3-子查询"><a href="#7-3-子查询" class="headerlink" title="7.3 子查询"></a>7.3 子查询</h2><p><strong>子查询</strong>：sub query，通过select查询结果当做另外一条select查询的条件或者数据源</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>想查出某个专业的所有学生信息</p>
<ul>
<li>查询的目标是学生表</li>
<li>查询的条件在专业表</li>
</ul>
<p>按照以前的知识，可以产生两种解决方案：</p>
<p>1、分开查询</p>
<ul>
<li>从专业表通过名字查出专业id</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select c_id from t_46 where c_name &#x3D; &#39;专业名字&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>从学生表通过专业id取出学生信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_45 where c_id &#x3D; &#39;查出来的专业id&#39;;</span><br></pre></td></tr></table></figure>

<p>2、连表查询</p>
<ul>
<li>将学生表与专业表通过专业id相连</li>
<li>对整个连表结果通过where条件进行筛选</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s.* from t_45 s right join t_46 c using(c_id) where c.c_name &#x3D; &#39;专业名字&#39;;</span><br></pre></td></tr></table></figure>

<p>从解决方案分析</p>
<p>1、分开查询数据量小，但是麻烦</p>
<p>2、连接查询方便，但是效率不高（先连后筛选）</p>
<p>如果能够将方案1变成一个简单的方式就好了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_45 where c_id &#x3D; (select c_id from t_46 where c_name &#x3D; &#39;专业名字&#39;);</span><br></pre></td></tr></table></figure>

<p><strong>以上就是子查询</strong></p>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、子查询就是能够将一些具有先后顺序的查询组装到一个查询语句中，从而节省操作的过程，降低复杂程度</p>
<h3 id="1、子查询分类"><a href="#1、子查询分类" class="headerlink" title="1、子查询分类"></a>1、子查询分类</h3><p><strong>子查询分类</strong>：根据子查询<strong>出现的位置</strong>或者<strong>产生的数据效果</strong>分类</p>
<ul>
<li>位置分类<ul>
<li>from子查询：子查询出现在from后做数据源</li>
<li>where子查询：子查询出现在where后做数据条件</li>
</ul>
</li>
<li>按子查询得到的结果分类<ul>
<li>标量子查询：子查询返回的结果是一行一列（一个数据）</li>
<li>列子查询：子查询返回的结果是一列多行（一列数据）</li>
<li>行子查询：子查询返回的结果是一行多列</li>
<li>表子查询：子查询返回的结果是一个二维表</li>
<li>exists子查询：子查询返回的结果是布尔结果（验证型）</li>
</ul>
</li>
<li>子查询都需要使用括号 <code>()</code> 进行包裹，必要时需要对子查询结果进行别名处理（from子查询）</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、通常我们使用子查询结果定义分类</p>
<p>2、位置划分是包含子查询结果的</p>
<ul>
<li>from子查询对应表子查询（表子查询）</li>
<li>where子查询</li>
</ul>
<h3 id="2、标量子查询"><a href="#2、标量子查询" class="headerlink" title="2、标量子查询"></a>2、标量子查询</h3><p><strong>标量子查询</strong>：子查询返回的结果是一行一列，一个值</p>
<ul>
<li>标量子查询是用来做其他查询的条件的</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要从一张表中获取数据（可以是多张）</p>
<p>2、确定查询条件在当前查询表中无法实现但是可以从其他表中精确获得（只有一个）</p>
<p>3、使用标量子查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>获取Computer专业的所有学生</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 数据目标：学生表t_45</span><br><span class="line"># 条件：专业名字，不在t_45中，但是t_45中的专业id可以通过专业名字在另外一张表精确获得（一个值）</span><br><span class="line"></span><br><span class="line">select * from t_45 where c_id &#x3D; (select c_id from t_46 where c_name &#x3D; &#39;Computer&#39;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、标量子查询通常用简单比较符号来制作条件的</p>
<h3 id="3、列子查询"><a href="#3、列子查询" class="headerlink" title="3、列子查询"></a>3、列子查询</h3><p><strong>列子查询</strong>：子查询返回的结果是一列多行</p>
<ul>
<li>列子查询通常是用来做查询条件的</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定要从一张表中获取数据（可以是多张）</p>
<p>2、确定查询条件在当前查询表中无法实现但是可以从其他表中精确获得（一个字段多个数据）</p>
<p>3、使用列子查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、获取所有有学生的班级信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 数据获取目标是班级信息</span><br><span class="line"># 数据获取条件是在学生表中的班级id，是多个</span><br><span class="line"></span><br><span class="line">select * from t_46 where c_id in (select distinct c_id from t_45 where c_id is not null);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、列子查询通常是作为外部主查询的条件，而且是使用in来进行判定</p>
<h3 id="4、行子查询"><a href="#4、行子查询" class="headerlink" title="4、行子查询"></a>4、行子查询</h3><p><strong>行子查询</strong>：子查询返回的结果是一行多列</p>
<ul>
<li>行子查询需要条件中构造行元素（多个字段组成查询匹配条件）<ul>
<li>(元素1,元素2,..元素N)</li>
</ul>
</li>
<li>行子查询通常也是用来作为主查询的结果条件</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定获取数据的条件不只是一个字段</p>
<p>2、确定数据条件的来源不在当前表中（也可以在当前表），但是可以通过条件精确获取到（一行多列）</p>
<p>3、使用行子查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>获取学生表中性别和年龄都与弥勒相同的学生信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询条件有多个：性别和年龄</span><br><span class="line"># 数据的条件的来源在另外一张表中</span><br><span class="line"></span><br><span class="line"># 解决思路：两个标量子查询</span><br><span class="line">select * from t_40 where gender &#x3D; (select gender from t_42 where name &#x3D; &#39;弥勒&#39;) and age &#x3D; (select age from t_42 where name &#x3D; &#39;弥勒&#39;);</span><br></pre></td></tr></table></figure>



<p>问题分析：以上查询解决了问题但是用到了两次子查询（效率降低），而且查询语句是一样的，只是字段不一样，可以使用行子查询解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 构建条件行元素(gender,age)</span><br><span class="line"></span><br><span class="line">select * from t_40 where (gender,age) &#x3D; (select gender,age from t_42 where name &#x3D; &#39;弥勒&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、行子查询是可以使用多个标量子查询替代解决问题的，但是行子查询的效率会比多个标量要高。需要使用到行子查询的时候不会使用标量子查询来解决的</p>
<ul>
<li>如果数据来源不在一张表可以考虑使用多个标量子查询实现</li>
</ul>
<h3 id="5、表子查询"><a href="#5、表子查询" class="headerlink" title="5、表子查询"></a>5、表子查询</h3><p><strong>表子查询</strong>：子查询返回的结果是多行多列（二维表）</p>
<ul>
<li>表子查询多出现在from之后当做数据源（from子查询）</li>
<li>表子查询通常是为了想对数据进行一次加工处理，然后再交给外部进行二次加工处理</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、需要查询的数据通过一次SQL查询不能直接搞定（可能顺序关系导致）</p>
<p>2、如果先把结果加工后（多行多列），外部再来一层结果查询加工可以完成目标</p>
<p>3、使用表子查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>获取学生表中每个班级里年龄最大的学生信息（姓名、年龄、班级名字），然后按年龄降序排序显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 尝试直接解决</span><br><span class="line">select any_value(name),max(age) m_age,class_name from t_42 group by class_name order by m_age desc;</span><br></pre></td></tr></table></figure>

<ul>
<li>分组统计中any_value取的是分组后的第一条记录数据（犬夜叉），而我们要的是最大</li>
</ul>
<p>解决方案：要是在分组之前将所有班级里的学生本身是降序排序，那么分组的第一条数据就是满足条件的数据。但是问题是：order by必须出现在 group by之后，如何解决？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># order by必须在group by之前解决：就要想办法让order by在group by之前而且不在同一条select指令中（同一条无解）</span><br><span class="line"># 必须使用子查询解决在不用SQL中的问题，而子查询的结果应该是全部记录信息，所以应该是表子查询，而且是数据源</span><br><span class="line"></span><br><span class="line">select any_value(name),max(age),class_name from </span><br><span class="line">(select name,age,class_name from t_42 order by age desc) as t</span><br><span class="line">group by class_name;</span><br></pre></td></tr></table></figure>

<ul>
<li>依然无效：原因是MySQL7以后若要子查询中的order by生效，需要像联合查询那样，让子查询带上limit</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select any_value(name),max(age),class_name from </span><br><span class="line">(select name,age,class_name from t_42 order by age desc limit 99999) as t</span><br><span class="line">group by class_name;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为order by在子查询的时候已经对结果进行过排序了，所以分组统计后最终结果也就不用再进行排序了，如果需要再进行排序，只要在最终结果后排序即可<ul>
<li>如果要用到字段排序，建议在外部查询select字段里使用别名（否则又要统计）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select any_value(name),max(age) m_age,class_name from </span><br><span class="line">(select name,age,class_name from t_42 order by age desc limit 99999) as t</span><br><span class="line">group by class_name order by m_age;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、表子查询通常解决的问题是提供数据源</p>
<p>2、表子查询出现的业务</p>
<ul>
<li>一条select指令中所用到的子句顺序不能满足查询条件</li>
<li>数据的来源可能是多张数据表</li>
</ul>
<p>3、特别注意：在MySQL7以后，子查询中使用的order by子句需要配合limit才会生效</p>
<h3 id="6、exists子查询"><a href="#6、exists子查询" class="headerlink" title="6、exists子查询"></a>6、exists子查询</h3><p><strong>exists子查询</strong>：代入查询，将主表（外部查询）的每一行代入到子表（子查询表）进行校验</p>
<ul>
<li><p>子查询返回的结果是布尔结果</p>
<ul>
<li>成功返回true</li>
<li>失败返回false</li>
</ul>
</li>
<li><p>exists子查询通常是作为where条件使用</p>
<ul>
<li>where exists(子查询)</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定查询的数据来自主表</p>
<p>2、确定条件是需要去子表（其他表）进行验证：不需要去子表获取数据之类的</p>
<p>3、使用exists子查询</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>获取所有有学生的班级信息t_46</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 获取的数据是班级表t_46</span><br><span class="line"># 班级是否有学生需要在t_45中确认，并不需要t_45提供任何数据显示</span><br><span class="line"></span><br><span class="line">select * from t_46 c where exists(select c_id from t_45 where c.c_id &#x3D; c_id);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、exists子查询通常用来解决那种不需要数据但是需要去表中确认关系的查询问题</p>
<ul>
<li>在exists子查询中尽量少的选择字段（不建议使用*），因为都是无价值的</li>
</ul>
<h3 id="7、比较方式"><a href="#7、比较方式" class="headerlink" title="7、比较方式"></a>7、比较方式</h3><p><strong>比较方式</strong>：在子查询中可以使用一些特定的比较方式</p>
<ul>
<li><p>特定的比较方式都是基于比较符号一起使用</p>
</li>
<li><p>all：满足后面全部条件</p>
<ul>
<li>&gt; all(结果集)：数据要大于结果集中的全部数据</li>
</ul>
</li>
<li><p>any：满足任意条件</p>
<ul>
<li>= any(结果集)：数据只要与结果集中的任何一个元素相等</li>
</ul>
</li>
<li><p>some：满足任意条件（与any完全一样）</p>
</li>
<li><p>结果集：可以是直接的数据也可以是子查询结果（通常是列子查询）</p>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、找出t_40表中与t_42表中年龄相同的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 数据获取在t_40表</span><br><span class="line"># 数据条件在t_42表</span><br><span class="line"></span><br><span class="line"># 解决方案1：使用in列子查询</span><br><span class="line">select * from t_40 where age in (select distinct age from t_42);</span><br><span class="line"></span><br><span class="line"># 解决方案2：使用exists子查询</span><br><span class="line">select * from t_40 t1 where exists(select id from t_42 where t1.age &#x3D; age);</span><br><span class="line"></span><br><span class="line"># 解决方案3：使用any或者some匹配（列子查询）</span><br><span class="line">select * from t_40 where age &#x3D; some(select age from t_42);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、比较方式其实很多都可以实现替代，越精准的数据匹配方式效率就越高</p>
<h3 id="8、总结"><a href="#8、总结" class="headerlink" title="8、总结"></a>8、总结</h3><p>1、子查询通常使用较多的是标量子查询、列子查询和exists子查询</p>
<p>2、子查询的效率是比连接查询的效率要低的，要适当选择使用</p>
<ul>
<li>子查询是在主表的每一次记录匹配时都会执行一次（where子查询）<ul>
<li>主表数据大，子表数据小：影响较小</li>
<li>主表数据小，子表数据大：影响较大</li>
</ul>
</li>
<li>from子查询因为只执行一次，影响不大</li>
</ul>
<p>3、理论上来讲，不限制子查询的嵌套，但是考虑到效率的降低，不建议使用子查询嵌套</p>
<h1 id="8-MySQL安全管理"><a href="#8-MySQL安全管理" class="headerlink" title="8 MySQL安全管理"></a>8 MySQL安全管理</h1><p><strong>安全管理</strong>：用各种方式来确保数据库的安全和数据的安全</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>携程的数据库被程序员删库跑路…</p>
<ul>
<li>如果有用户管理，那么可以通过权限限制其没有权限删除</li>
<li>如果有数据备份，即便数据删除，也可以很快的实现数据还原，减小损失</li>
<li>…</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、安全管理是每一个接触数据库的人都应该考虑的问题，尤其是DBA（数据库管理员）</p>
<p>2、数据库安全的维度有很多</p>
<ul>
<li>管理安全：用户、权限、备份还原等</li>
<li>结构安全：外键、视图、事务等</li>
<li>执行层：预处理</li>
</ul>
<h2 id="8-1-外键约束"><a href="#8-1-外键约束" class="headerlink" title="8.1 外键约束"></a>8.1 外键约束</h2><h3 id="1、外键"><a href="#1、外键" class="headerlink" title="1、外键"></a>1、外键</h3><p><strong>外键</strong>：foreign key，表中指<strong>向外部表主键</strong>的字段定义成外键</p>
<ul>
<li>外键必须要通过语法指定才能称之为外键<ul>
<li>[constraint<code>外键名</code>] foreign key(当前表字段名) references 外部表(主键字段)</li>
</ul>
</li>
<li>外键构成条件<ul>
<li>外键字段必须与对应表的主键字段类型一致</li>
<li>外键字段本身要求是一个索引（创建外键会自动生成一个索引）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定表中字段与另外一张表存在关联关系</p>
<p>2、使用外键明确关联外表</p>
<p>3、外键约束成功</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建专业表和学生表，学生表中的专业id指向专业表id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table t_47(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null unique</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">create table t_48(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    c_id int comment &#39;指向t_46表中的id主键&#39;,</span><br><span class="line">    constraint &#96;c_id&#96; foreign key(c_id) references t_47(id)</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<p>2、外键可以不指定名字，系统会自动生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t_49(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    c_id int,</span><br><span class="line">    foreign key(c_id) references t_47(id)</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、外键是需要保证字段与外部连接的主键字段一致的</p>
<p>2、一张表可以有多个外键，但是一个字段只能产生一个外键</p>
<h3 id="2、外键约束"><a href="#2、外键约束" class="headerlink" title="2、外键约束"></a>2、外键约束</h3><p><strong>外键约束</strong>：当表建立外键关系后，外键就会对主表（外键指向的表）和子表（外键所在的表）里的数据产生约束效果</p>
<ul>
<li>外键约束的是写操作（默认操作）<ul>
<li>新增：子表插入的数据对应的外键必须在主表存在</li>
<li>修改：主表的记录如果在子表存在，那么主表的主键不能修改（主键不能修改）</li>
<li>删除：主表的记录如果在子表存在，那么主表的主键不能删除</li>
<li>删除：主表的记录如果在子表存在，那么主表的主键不能删除</li>
</ul>
</li>
<li>外键约束控制：外键可以在定义时控制外键的约束作用<ul>
<li>控制类型<ul>
<li>on update：父表更新时子表的表现</li>
<li>on delete：父表删除时子表的表现</li>
</ul>
</li>
<li>控制方式<ul>
<li>cascade：级联操作，父表操作后子表跟随操作</li>
<li>set null：置空操作，父表操作后，子表关联的外键字段置空</li>
<li>restrict：严格模式，不允许父表操作（默认的）</li>
<li>no action：子表不管</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定表的外键关联关系</p>
<p>2、确定主表的约束控制</p>
<p>3、明确使用相应的约束控制</p>
<p>4、系统自动约束</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、子表不能插入主表不存在的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into t_48 values(null,&#39;Tony&#39;,2);	# 错误</span><br><span class="line"></span><br><span class="line">insert into t_47 values(null,&#39;English&#39;);</span><br><span class="line">insert into t_48 values(null,&#39;Peny&#39;,1);</span><br></pre></td></tr></table></figure>



<p>2、默认的外键产生后，主键不能更新被关联的主键字段或者删除被关联的主键记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">update t_47 set id &#x3D; 2;</span><br><span class="line">delete from t_47 where id &#x3D; 1;</span><br></pre></td></tr></table></figure>



<p>3、限制外键约束，一般使用更新级联，删除置空</p>
<ul>
<li>on update cascade：更新级联</li>
<li>on delete set null：删除置空</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table t_50(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null unique</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">create table t_51(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    c_id int, # 如果要允许置空，就不能not null</span><br><span class="line">    foreign key(c_id) references t_50(id) on update cascade on delete set null</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_50 values(null,&#39;Chinese&#39;),(null,&#39;Computer&#39;);</span><br><span class="line">insert into t_51 values(null,&#39;Tony&#39;,1),(null,&#39;Petter&#39;,2);</span><br></pre></td></tr></table></figure>



<ul>
<li>子表依然不允许插入父表不存在的外键</li>
<li>但是可以插入外键为Null的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">insert into t_51 values(null,&#39;Lilei&#39;,3);</span><br><span class="line"></span><br><span class="line">insert into t_51 values(null,&#39;Lilei&#39;,NULL); # OK                               </span><br></pre></td></tr></table></figure>

<ul>
<li>父表的更新（主键）会让关联的外键自动级联更新</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_50 set id &#x3D; 3 where id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<ul>
<li>父表的删除会让关联的外键自动自动置空</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from t_50 where id &#x3D; 3;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、外键约束对子表和父表都有约束</p>
<ul>
<li>子表约束：子表不能插入父表不存在的外键</li>
<li>父表约束<ul>
<li>更新约束（默认不允许）</li>
<li>删除约束（默认不允许）</li>
</ul>
</li>
<li>一般约束<ul>
<li>级联更新</li>
<li>删除置空</li>
</ul>
</li>
</ul>
<p>2、外键约束增强了数据的安全性和可靠性，但是会增加程序对于数据的不可控性，所以是实际开发中一般会通过程序逻辑控制来保证数据的完整性和安全性，外间使用较少</p>
<h3 id="3、外键管理"><a href="#3、外键管理" class="headerlink" title="3、外键管理"></a>3、外键管理</h3><p><strong>外键管理</strong>：在表创建后期维护外键</p>
<ul>
<li>新增外键</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add [constraint &#96;外建名&#96;] foreign key(外键字段) references 表名(主键) [on 外键约束]</span><br></pre></td></tr></table></figure>

<ul>
<li>删除外键</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop foreign key 外键名;</span><br></pre></td></tr></table></figure>

<ul>
<li>更新外键：先删除后新增</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、删除外键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_51 drop foreign key t_51_ibfk_1;	# 系统生成的外键</span><br></pre></td></tr></table></figure>



<p>2、追加外键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t_51 add constraint &#96;t_51_50&#96; foreign key(c_id) references t_50(id);</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：追加外键需要保证外键字段里的值要么为Null，要么在父表中都能找到</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、外键的使用最好的创建表结构的时候就维护好，后期的维护对子表数据有要求</p>
<h2 id="8-2-事务安全"><a href="#8-2-事务安全" class="headerlink" title="8.2 事务安全"></a>8.2 事务安全</h2><h3 id="1、事务"><a href="#1、事务" class="headerlink" title="1、事务"></a>1、事务</h3><p><strong>事务</strong>：要做的某个事情</p>
<ul>
<li>计算机中的事务是指某个程序执行单元（写操作）</li>
<li>事务安全：当事务执行后，保障事务的执行是有效的，而不会导致数据错乱</li>
<li>事务安全通常针对的是一连串操作（多个事务）而产生的统一结果</li>
</ul>
<ul>
<li>MySQL中默认的写操作是直接写入的<ul>
<li>执行写操作SQL</li>
<li>同步到数据表</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>银行转账：从A账户转账到B账户</p>
<p>创建数据表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table t_52(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    account decimal(10,2) default 0.00</span><br><span class="line">)charset utf8;</span><br><span class="line"></span><br><span class="line">insert into t_52 values(null,&#39;Tom&#39;,10000),(null,&#39;Lucy&#39;,100);</span><br></pre></td></tr></table></figure>



<p>转账：Tom向Lucy转账，一定是分为两步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Tom扣钱</span><br><span class="line">update t_52 set account &#x3D; account - 1000 where id &#x3D; 1;</span><br><span class="line"></span><br><span class="line"># Lucy收钱</span><br><span class="line">update t_52 set account &#x3D; account + 1000 where id &#x3D; 2;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上两步必须都成功转账才能叫成功</li>
<li>两步操作无法确保哪一步会出问题（尤其是第二步）</li>
<li>为了保障两步都成功才能叫事务安全</li>
</ul>
<blockquote>
<p>事务安全原理</p>
</blockquote>
<p>事务安全是在操作前告知系统，接下来所有的操作都暂<strong>不同步到数据表</strong>，而是记录到<strong>事务日志</strong>，指导后续所有操作都成功，再进行同步；否则取消所有操作</p>
<p>以上述转账为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(转账开始)--&gt;B[开启事务]</span><br><span class="line">B--&gt;C&#123;事务1:Tom转出1000&#125;</span><br><span class="line">C--&gt;|成功|D[记录到事务日志]</span><br><span class="line">C--&gt;|失败|G</span><br><span class="line">D--&gt;E&#123;事务2:Lucy转入1000&#125;</span><br><span class="line">D--&gt;|失败|G</span><br><span class="line">E--&gt;|成功|F[记录到事务日志]</span><br><span class="line">F--&gt;G[关闭事务&lt;br&gt;成功:提交事务 同步到数据表\清除事务日志&lt;br&gt;失败:回滚事务 清除事务日志]</span><br><span class="line">G--&gt;H((结束))</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、事务的目的就是为了保障连续操作的一致性，保证结果的完整性</p>
<p>2、事务的原理是通过将操作结果暂时保存在事务日志中，等所有操作的结果都是成功的，然后一并同步到数据表</p>
<h3 id="2、事务处理"><a href="#2、事务处理" class="headerlink" title="2、事务处理"></a>2、事务处理</h3><p><strong>事务处理</strong>：利用自动或者手动方式实现事务管理</p>
<ul>
<li>自动事务处理：系统默认，操作结束直接同步到数据表（事务关闭状态）<ul>
<li>系统控制：变量 autocommit（值为ON，自动提交）</li>
</ul>
</li>
<li>手动事务处理<ul>
<li>开启事务： <code>start transaction</code></li>
<li>关闭事务<ul>
<li>提交事务：<code>commit</code>（同步到数据表同时清空日志数据）</li>
<li>回滚事务：<code>rollback</code>（清空日志数据）</li>
</ul>
</li>
</ul>
</li>
<li>事务回滚：在长事务执行中，可以在某个已经成功的节点处设置回滚点，后续回滚的话可以回到某个成功点<ul>
<li>设置回滚点：<code>savepoint 回滚点名字</code></li>
<li>回滚到回滚点：<code>rollback to 回滚点名字</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定操作需要使用到事务操作</p>
<p>2、开启事务</p>
<p>3、执行事务</p>
<ul>
<li>如果需要回滚点设置：设置回滚点</li>
<li>如果需要回滚：回滚到回滚点</li>
</ul>
<p>4、结束事务</p>
<ul>
<li>成功提交事务：同步到数据表，清空事务日志</li>
<li>失败回滚事务：清空事务日志</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、手动事务：启用事务转账，成功提交事务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开启事务</span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line"># Tom扣钱</span><br><span class="line">update t_52 set account &#x3D; account - 1000 where id  &#x3D; 1;</span><br><span class="line"></span><br><span class="line"># Lucy收钱</span><br><span class="line">update t_52 set account &#x3D; account + 1000 where id  &#x3D; 2;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>



<p>2、手动事务：启用事务转账，成功提交事务（回滚点）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 开启事务</span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line"># Tom扣钱</span><br><span class="line">update t_52 set account &#x3D; account - 1000 where id&#x3D; 1;</span><br><span class="line"></span><br><span class="line"># 设置回滚点</span><br><span class="line">savepoint sp1;</span><br><span class="line"></span><br><span class="line"># Lucy收钱</span><br><span class="line">update t_52 set account &#x3D; account + 10000 where id&#x3D; 2;</span><br><span class="line"></span><br><span class="line"># 操作失败回到回滚点</span><br><span class="line">rollback to sp1;</span><br><span class="line"></span><br><span class="line"># Lucy收钱</span><br><span class="line">update t_52 set account &#x3D; account + 1000 where id&#x3D; 2;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>



<p>3、自动事务</p>
<ul>
<li>Mysql默认是自动提交事务的：所以事务一旦发生就会立即写入到数据表（不能多个事务一起完成任务）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;autocommit&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭自动提交事务（当前设置级别用户级：当前用户档次连接有效）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set autocommit &#x3D; 0;	</span><br></pre></td></tr></table></figure>

<ul>
<li>手动提交事务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_52 values(null,&#39;Liu&#39;,1000);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、事务处理要应用到多次写操作组成的大事务中，如金融安全等</p>
<p>2、事务处理通常都会使用手动控制事务，没必要去修改原本的自动提交的机制，开启所有事务</p>
<p>3、扩展：事务处理的支持是有条件的</p>
<ul>
<li>存储引擎需要为InnoDB</li>
</ul>
<h3 id="3、事务特点"><a href="#3、事务特点" class="headerlink" title="3、事务特点"></a>3、事务特点</h3><p><strong>事务特点</strong>：事务处理具有ACID四大特性</p>
<ul>
<li>原子性（Atomicity ）：一个事务操作是一个整体，不可拆分，要么都成功，要么都失败</li>
<li>一致性（Consistency）：事务执行之前和执行之后都必须处于一致性状态，数据的完整性没有被破坏（事务逻辑的准确性）</li>
<li>隔离性（Isolation ）：事务操作过程中，其他事务不可见</li>
<li>持久性（Durability ）：事务一旦提交，结果不可改变</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、事务特点需要在对应事务操作时，结合多个用户来看才能看的完整和亲切</p>
<p>2、扩展</p>
<ul>
<li><strong>事务锁</strong>：当一个事务开启时，另外一个事务是不能对当前事务锁占用的数据进行操作的<ul>
<li>行所：当前事务只占用了一行（id精确检索数据），那么其他事务可以操作其他行数据</li>
<li>表所：当前事务占用了整张表（like扫码整个表），那么其他事务对整张表都不能操作</li>
</ul>
</li>
<li><strong>脏读</strong>：一个事务在对某个数据进行操作但尚未提交，而另外一个事务读到了这个“历史”数据其实已经被修改</li>
</ul>
<h2 id="8-3-预处理"><a href="#8-3-预处理" class="headerlink" title="8.3 预处理"></a>8.3 预处理</h2><h3 id="1、预处理"><a href="#1、预处理" class="headerlink" title="1、预处理"></a>1、预处理</h3><p><strong>预处理</strong>：prepare statement，一种预先编译SQL指令的方式（然后命令执行）</p>
<ul>
<li>预处理不同于直接处理，是将要执行的SQL指令先发送给服务器编译，然后通过指令执行<ul>
<li>发送预处理：<code>prepare 预处理名字 from &#39;要执行的SQL指令&#39;</code></li>
<li>执行预处理：<code>execute 预处理名字</code></li>
</ul>
</li>
<li>预处理管理<ul>
<li>预处理属于<strong>会话级别</strong>：即当前用户当次连接有效（断开会被服务器清理掉）</li>
<li>删除预处理：<code>deallocate | drop prepare 预处理名字</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、要执行的SQL指令想使用预处理</p>
<ul>
<li>重复执行的指令</li>
<li>涉及数据安全的指令</li>
</ul>
<p>2、发送预处理指令</p>
<p>3、执行预处理</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、查询学生的SQL指令需要重复执行很多次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 普通操作</span><br><span class="line">select * from t_42;</span><br><span class="line"></span><br><span class="line"># 预处理操作：发送预处理</span><br><span class="line">prepare p1 from &#39;select * from t_42&#39;;</span><br><span class="line"></span><br><span class="line"># 预处理操作：执行预处理</span><br><span class="line">execute p1;</span><br><span class="line"></span><br><span class="line"># 删除预处理</span><br><span class="line">deallocate  prepare p1;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>预处理原理</p>
</blockquote>
<p>普通处理和预处理对比</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A(普通处理)--&gt;B[接收SQL指令]</span><br><span class="line">B--&gt;C[编译SQL]</span><br><span class="line">C--&gt;D[执行SQL]</span><br><span class="line">D--&gt;E((返回结果))</span><br><span class="line"></span><br><span class="line">A1(预处理)--&gt;B1[接收预处理指令]</span><br><span class="line">B1--&gt;C1[编译预处理指令]</span><br><span class="line">C1--&gt;D1&#123;是否执行&#125;</span><br><span class="line">D1--&gt;|execute&lt;br&gt;以后都不需要执行接收SQL和编译SQL|E1[执行SQL&lt;br&gt;可重复执行]</span><br><span class="line">D1--&gt;|不执行|F1</span><br><span class="line">E1--&gt;F1((返回结果))</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、预处理就是把要执行的结构（SQL指令）提前发送给服务器端，服务器进行编译但不执行，等待执行指令后才执行</p>
<p>2、预处理的作用</p>
<ul>
<li>性能优化<ul>
<li>效率优化：同样的SQL不用每次都进行编译（编译耗时）<ul>
<li>普通处理：每次都需要编译</li>
<li>预处理：编译一次</li>
</ul>
</li>
<li>网络传输优化：复杂的SQL指令只需要传输一次<ul>
<li>普通处理：每次都需要网络传输SQL指令</li>
<li>预处理：传输一次SQL指令，以后都是执行指令</li>
</ul>
</li>
</ul>
</li>
<li>安全：有效防止SQL注入（外部通过数据的特殊使用使得SQL的执行方式改变）<ul>
<li>普通处理：直接发送给服务器执行（容易出现SQL注入）</li>
<li>预处理：发送的是结构，数据是后期执行传入（传入协议不一样，数据安全性高）</li>
</ul>
</li>
</ul>
<h3 id="2、预处理传参"><a href="#2、预处理传参" class="headerlink" title="2、预处理传参"></a>2、预处理传参</h3><p><strong>预处理传参</strong>：在执行预处理的时候传入<strong>预处理需要的可变数据</strong></p>
<ul>
<li><p>一般预处理都不会是固定死的SQL指令，而是具有一些数据可变的执行（条件）</p>
<ul>
<li>可变数据的位置使用占位符 <code>?</code> 占位</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prepare 预处理名字 from &#96;预处理指令 变化部分使用?替代&#96;</span><br></pre></td></tr></table></figure></li>
<li><p>在执行预处理的时候将实际数据传进去代替占位符执行SQL</p>
<ul>
<li>数据存储到变量（预处理传入的值必须是变量保存的）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @变量名 &#x3D; 值</span><br></pre></td></tr></table></figure>

<ul>
<li>使用using关键字传参</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execute 预处理名字 using @变量名</span><br></pre></td></tr></table></figure>

<ul>
<li>数据传入的顺序与预处理中占位符的顺序一致</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、同样的SQL指令要执行N次，但是条件不一致</p>
<p>2、使用预处理占位符发送预处理指令</p>
<p>3、设定变量保存要传入的数据</p>
<p>4、执行预处理，携带变量参数</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>向t_40表中插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 准备预处理：涉及参数</span><br><span class="line">prepare t_40_insert from &#39;insert into t_40 values(null,?,?,?,?)&#39;;</span><br><span class="line"></span><br><span class="line"># 设置变量并传入参数</span><br><span class="line">set @name &#x3D; &#39;药师兜&#39;;</span><br><span class="line">set @gender &#x3D; &#39;男&#39;;</span><br><span class="line">set @age &#x3D; 23;</span><br><span class="line">set @class_name &#x3D; &#39;木叶1班&#39;;</span><br><span class="line"></span><br><span class="line"># 执行预处理</span><br><span class="line">execute t_40_insert using @name,@gender,@age,@class_name;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、预处理传参是实际应用预处理时最常见的方式</p>
<p>2、预处理指令可以适用于增删改查各种指令</p>
<p>3、如果预处理的指令不是在一次连接中重复使用，那么预处理反而会降低效率。所以预处理的执行如果不是考虑到安全因素，那么一定是SQL需要重复执行</p>
<h2 id="8-4-视图"><a href="#8-4-视图" class="headerlink" title="8.4 视图"></a>8.4 视图</h2><h3 id="1、视图"><a href="#1、视图" class="headerlink" title="1、视图"></a>1、视图</h3><p><strong>视图</strong>：view，一种由select指令组成的<strong>虚拟表</strong></p>
<ul>
<li>视图是虚拟表，可以使用表管理（结构管理）<ul>
<li>为视图提供数据的表叫做基表</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 创建视图</span><br><span class="line">create view 视图名字 as select指令;</span><br><span class="line"></span><br><span class="line"># 访问视图：一般都是查询</span><br><span class="line">select *&#x2F;字段名 from 视图名字;</span><br></pre></td></tr></table></figure>

<ul>
<li>视图有结构，但不存储数据<ul>
<li>结构：select选择的字段</li>
<li>数据：访问视图时执行的select指令</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要使用视图提供数据</p>
<ul>
<li>数据来源是多张表</li>
<li>对外部系统提供数据支撑（保护基表数据）</li>
</ul>
<p>2、使用视图</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、需要对外提供一个学生详情的数据，经常使用：可以利用视图实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 对外提供数据，要保护数据本身的安全</span><br><span class="line"># 需要长期使用</span><br><span class="line"></span><br><span class="line"># 创建视图</span><br><span class="line">create view v_student_info as select * from t_45 left join t_46 using(c_id);</span><br><span class="line"># 使用视图：像表一样使用</span><br><span class="line">select * from v_student_info;</span><br></pre></td></tr></table></figure>



<p>2、有些复杂的SQL又是经常用到的，如多张表的连表操作：可以利用视图实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 院系表</span><br><span class="line">create table t_53(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_53 values(null,&#39;语言系&#39;),(null,&#39;考古系&#39;);</span><br><span class="line"></span><br><span class="line"># 专业表</span><br><span class="line">create table t_54(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    s_id int not null comment &#39;学院id&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_54 values(null,&#39;English&#39;,1),(null,&#39;Chinese&#39;,1);</span><br><span class="line"></span><br><span class="line"># 学生表</span><br><span class="line">create table t_55(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    s_id int not null comment &#39;专业Id&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into t_55 values(null,&#39;Lilei&#39;,2),(null,&#39;Mark&#39;,2),(null,&#39;Tony&#39;,1);</span><br><span class="line"></span><br><span class="line"># 获取所有学生的明细信息</span><br><span class="line">select stu.*,sub.name as sub_name,sub.s_id as sch_id,sch.name as sch_name from t_55 as stu left join t_54 sub on stu.s_id &#x3D; sub.id left join t_53 sch on sub.s_id &#x3D; sch.id;</span><br><span class="line"></span><br><span class="line"># 以视图保存这类复杂指令，后续可以直接访问视图</span><br><span class="line">create view v_student_detail as select stu.*,sub.name as sub_name,sub.s_id as sch_id,sch.name as sch_name from t_55 as stu left join t_54 sub on stu.s_id &#x3D; sub.id left join t_53 sch on sub.s_id &#x3D; sch.id;</span><br><span class="line"></span><br><span class="line">select * from v_student_detail;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、视图是用来提供数据支持的，是由select指令组成的结构</p>
<ul>
<li>存在结构</li>
<li>不存在数据（数据是使用时调用select指令动态获取数据）</li>
</ul>
<p>2、视图的目的</p>
<ul>
<li>方便提供全面数据：可以根据需求组织数据，而实际上不会在数据库产生数据冗余</li>
<li>数据安全：视图本质是来源于数据基表，但是对外可以保护基本的数据结构</li>
</ul>
<h3 id="2、视图管理"><a href="#2、视图管理" class="headerlink" title="2、视图管理"></a>2、视图管理</h3><p><strong>视图管理</strong>：对视图结构的管理</p>
<ul>
<li>视图查看：显示视图结构和具体视图信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show tables;	# 查看全部视图</span><br><span class="line">show create table&#x2F;view 视图名字;	# 查看视图创建指令</span><br><span class="line">desc 视图名字;	 # 查看视图结构</span><br></pre></td></tr></table></figure>

<ul>
<li>视图修改：更改视图逻辑</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 更改视图</span><br><span class="line">alter view 视图名 as 新的查询指令;</span><br><span class="line">create or replace view 视图名 as 新的查询指令;	# 创建新的或者替换新的</span><br></pre></td></tr></table></figure>

<ul>
<li>视图删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view 视图名; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例</p>
</blockquote>
<p>1、查看全部视图和视图明细</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show tables;	# 查看全部表，包括视图</span><br><span class="line">desc v_student_detail;	# 查看视图结构</span><br><span class="line">show create view v_student_detail;	# 查看视图创建明细</span><br></pre></td></tr></table></figure>



<p>2、修改视图：重置视图数据逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter view v_student_info as select t1.s_name,t2.c_name from t_45 t1 left join t_46 t2 using(c_id);</span><br><span class="line">create or replace view v_student_info as select t1.s_name,t2.c_name from t_45 t1 left join t_46 t2 using(c_id);</span><br></pre></td></tr></table></figure>



<p>3、删除视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view v_student_info;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、视图操作与表操作类似，通常情况下不会经常的去修改维护，而是会在一开始就维护好</p>
<p>2、视图管理可以与表一样对结构进行管理</p>
<h3 id="3、视图数据操作"><a href="#3、视图数据操作" class="headerlink" title="3、视图数据操作"></a>3、视图数据操作</h3><p><strong>视图数据操作</strong>：直接对视图进行写操作（增删改）然后实现基表数据的变化</p>
<ul>
<li>视图所有的数据操作都是最终对基表的数据操作</li>
<li>视图操作条件<ul>
<li>多基表视图：不允许操作（增删改都不行）</li>
<li>单基表视图：允许增删改<ul>
<li>新增条件：视图的字段必须包含基表中所有不允许为空的字段</li>
</ul>
</li>
<li>with check option：操作检查规则<ul>
<li>默认不需要这个规则（创建视图时指定）：视图操作只要满足前面上述条件即可</li>
<li>增加此规则：视图的数据操作后，必须要保证该视图还能把通过视图操作的数据查出来（否则失败）</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、根据需求确定需要使用视图</p>
<p>2、确定允许视图进行数据操作（通常用户权限设定，且是单基表视图）</p>
<p>3、确定视图数据的操作是否需要操作检查（有where条件筛选，且只对新增和更新有影响）</p>
<ul>
<li>需要：增加with check option</li>
<li>不需要</li>
</ul>
<p>4、使用视图进行数据操作（最终数据写落点是基表）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、增加一个单表视图和多表视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create view v_student_1 as select s_id,s_name from t_45;</span><br><span class="line">create view v_student_2 as select s.*,c.c_name from t_45 s left join t_46 c using(c_id);</span><br><span class="line">create or replace view v_student_3 as select * from t_45 where c_id is not null with check option;</span><br></pre></td></tr></table></figure>



<p>2、新增数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into v_student_1 values(null,&#39;student7&#39;);	# 正确：视图包含所有必有字段</span><br><span class="line">insert into v_student_2 values(null,&#39;student8&#39;,null,null); # 错误：不可插入</span><br><span class="line">insert into v_student_3 values(null,&#39;student8&#39;,null);	# 错误：check option，因为第三个字段c_id为NULL，不符合视图筛选条件，查不出来</span><br><span class="line">insert into v_student_3 values(null,&#39;Student9&#39;,1);	# 正确</span><br></pre></td></tr></table></figure>



<p>3、更新数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update v_student_1 set s_name &#x3D; &#39;boy&#39; where s_id &#x3D; 8;</span><br><span class="line">update v_student_2 set s_name &#x3D; &#39;boy&#39; where s_id &#x3D; 7; # 错误：不可修改</span><br><span class="line">update v_student_3 set c_id &#x3D; null where s_id &#x3D; 1;	  # 错误：check option，修改后c_id为null，变得不符合视图筛选条件了</span><br><span class="line">update v_student_3 set s_name &#x3D; &#39;boy&#39; where s_id &#x3D; 1; # 正确</span><br></pre></td></tr></table></figure>



<p>4、删除数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete from v_student_1 where s_id &#x3D; 2;</span><br><span class="line">delete from v_student_2 where s_id &#x3D; 3;	# 错误：不可删除</span><br><span class="line">delete from v_student_3 where s_id &#x3D; 1;	# 可以删除，说明with check option不影响删除操作</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、视图数据操作一般情况下是不允许的，通常之所以对外提供视图就提供数据的只读操作</p>
<p>2、视图数据操作与视图的基表数量和字段有关</p>
<ul>
<li>多基表视图不允许任何写操作</li>
<li>单基表视图允许更新和删除、根据情况允许新增（视图包含基表中所有不允许为空字段）</li>
</ul>
<p>3、with check option是针对有where条件的视图组成有效，需要手动选择是否增加该选项</p>
<ul>
<li>视图数据的新增、修改后，必须与原来的查询结果是一致的（新增一定要能在视图中看到）</li>
<li>视图数据的删除不受with check option影响</li>
<li>视图数据的新增、修改都是针对当前视图能查出来的，否则既不报错也不生效</li>
<li>with check option还可以更复杂，如果有兴趣可以深入的了解一下</li>
</ul>
<h3 id="4、视图算法"><a href="#4、视图算法" class="headerlink" title="4、视图算法"></a>4、视图算法</h3><p><strong>视图算法</strong>：指视图在执行过程中对于内部的select指令的处理方式</p>
<ul>
<li>视图算法在创建视图时指定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create ALGORITHM &#x3D; 算法 view 视图名字 as select指令;</span><br></pre></td></tr></table></figure>

<ul>
<li>视图算法一共有三种<ul>
<li>undefined：默认的，未定义算法，即系统自动选择算法</li>
<li>merge：合并算法，就是将视图外部查询语句跟视图内部select语句合并后执行，效率高（系统优先选择）</li>
<li>temptable：临时表算法，即系统将视图的select语句查出来先得出一张临时表，然后外部再查询（temptable算法视图不允许写操作）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定使用视图</p>
<p>2、确定视图算法：考虑视图内部SQL指令中的子句使用情况</p>
<p>3、创建视图并使用视图</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建三种不同算法视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create algorithm &#x3D; undefined view v_student_4 as select * from t_42 order by age desc;</span><br><span class="line">create algorithm &#x3D; merge view v_student_5 as select * from t_42 order by age desc;</span><br><span class="line">create algorithm &#x3D; temptable view v_student_6 as select * from t_42 order by age desc;</span><br></pre></td></tr></table></figure>

<p>2、使用视图：为了体现算法效果，给视图增加分组效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(*),any_value(name),any_value(age),class_name,max(age) from v_student_4 group by class_name;</span><br><span class="line">select count(*),any_value(name),any_value(age),class_name,max(age) from v_student_5 group by class_name;</span><br><span class="line">select count(*),any_value(name),any_value(age),class_name,max(age) from v_student_6 group by class_name;</span><br></pre></td></tr></table></figure>

<p>3、临时表算法的视图不能进行数据插入操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into v_student_6 values(null,&#39;冥加&#39;,&#39;男&#39;,100,&#39;神妖1班&#39;); # 错误：不可插入</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、视图算法是用来结合外部外的查询指令的优化思路，主要的优化方式有两种</p>
<ul>
<li>merge：合并算法，将视图的select与外部select合并成一条，然后执行一次（效率高）</li>
<li>temptable：临时表算法，视图的指令单独执行得到一个二维表，然后外部select再执行（安全）</li>
<li>undefined：未定义算法是一种系统自动选择的算法，系统偏向于选择merge算法</li>
</ul>
<p>2、一般在设计视图的时候要考虑到视图算法的可行性，通常视图中如果出现了order by排序的话，就要考虑使用temptable算法</p>
<ul>
<li>只要merge以后，不会导致数据因为子句的先后顺序而混乱（order by与group by的顺序混乱容易出问题）</li>
</ul>
<h2 id="8-5-数据备份与还原"><a href="#8-5-数据备份与还原" class="headerlink" title="8.5 数据备份与还原"></a>8.5 数据备份与还原</h2><p><strong>备份</strong>：backup，将数据或者结构按照一定的格式存储到另外一个文件中，以保障阶段数据的完整性和安全性</p>
<ul>
<li>将当前正确数据进行数据保存</li>
<li>备份通常是有固定的时间节点</li>
</ul>
<p><strong>还原</strong>：restore，在当前数据出问题的情况下，将之前备份的数据替换掉当前数据，保证系统的持续、正确的运行</p>
<ul>
<li>基于备份进行数据还原</li>
<li>备份还原不一定能够保证所有损失挽回</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、数据的备份与还原是作为一个正常运行的数据库必须做的事情</p>
<ul>
<li>确保数据的安全</li>
<li>将数据出错的风险降低到最小</li>
</ul>
<p>2、数据库的备份与还原是作为一个DBA最基本的技术要求（开发者也要会）</p>
<h3 id="1、表数据备份"><a href="#1、表数据备份" class="headerlink" title="1、表数据备份"></a>1、表数据备份</h3><p><strong>表数据备份</strong>：单独针对表里的<strong>数据部分</strong>进行备份（数据导出）</p>
<ul>
<li>将数据从表中查出，按照一定格式存储到外部文件<ul>
<li>字段格式化：fields<ul>
<li>terminated by：字段数据结束后使用的符号，默认是空格</li>
<li>enclosed by：字段数据包裹，默认什么都没有</li>
<li>escaped by：特殊字符的处理，默认是转义</li>
</ul>
</li>
<li>行格式化：lines<ul>
<li>terminated by：行结束符号，默认是\n，自动换行</li>
<li>starting by：行开始符号，默认没有</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 字段列表|*  into outfile 外部文件路径 </span><br><span class="line">    [fields terminated by 格式 enclosed by 格式]</span><br><span class="line">    [lines terminated by 格式 starting by 格式]</span><br><span class="line">from 数据表;</span><br></pre></td></tr></table></figure>

<ul>
<li>表数据备份不限定数据的来源是一张表还是多张表（可以连表）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要对表数据进行导出处理（备份），而且不需要考虑字段名字</p>
<p>2、确定导出的数据的处理</p>
<ul>
<li>字段处理（可以默认）</li>
<li>行处理（可以默认）</li>
</ul>
<p>3、执行表数据导出</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、将t_40表的数据按照默认的方式导出到文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * into outfile  &#39;D:&#x2F;t_40.csv&#39; from t_40;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果系统提示：secure-file-priv问题，说明配置没有允许进行文件的导入导出。需要在配置文件里（my.ini）配置好这个配置项：secure-file-priv = 数据导入导出路径/不指定值（重启MySQL生效）</li>
</ul>
<p>2、将t_40表的数据按照指定格式导出到文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select name,gender,age,class_name into outfile &#39;D:&#x2F;t_40_self.csv&#39;</span><br><span class="line">    fields terminated by &#39;-&#39; enclosed by &#39;&quot;&#39;</span><br><span class="line">    lines starting by &#39;GO:&#39;</span><br><span class="line">from t_40;</span><br></pre></td></tr></table></figure>



<p>3、多表数据导出：t_45连接t_46表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * into outfile &#39;D:&#x2F;t_45_46.csv&#39; from t_45 left join t_46 using(c_id);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、表数据备份是一种将表中的数据按照一定的格式导出到外部文件进行保存</p>
<ul>
<li>数据取出后方便进行加工管理</li>
<li>SQL有不同的语法，但是数据的识别是一致的，所以方便进行数据库间的切换</li>
</ul>
<p>2、表数据备份通常是为了进行数据加工后存入回表中，或者到其他表</p>
<p>3、目前比较少用这种方式进行数据备份</p>
<h3 id="2、表数据还原"><a href="#2、表数据还原" class="headerlink" title="2、表数据还原"></a>2、表数据还原</h3><p><strong>表数据还原</strong>：将<strong>符合数据表结构</strong>的数据导入到数据表中（数据导入）</p>
<ul>
<li>将一定格式的数据按照一定的解析方式解析成符合表字段格式的数据导入到数据表<ul>
<li>字段处理</li>
<li>行处理</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">load data infile &#39;数据文件所在路径&#39; into table 表名</span><br><span class="line">    [fields terminated by 格式 enclosed by 格式]</span><br><span class="line">    [lines terminated by 格式 starting by 格式]</span><br><span class="line">    [(字段列表)];	# 如果是部分表字段，那么必须将字段列表放到最后</span><br></pre></td></tr></table></figure>

<ul>
<li>数据文件来源<ul>
<li>表数据备份的数据文件</li>
<li>外部获取或者制作的符合格式的数据</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、数据文件里的数据满足数据表的字段要求</p>
<ul>
<li>数据类型</li>
<li>字段对应数（自增长id、可以为空字段除外）</li>
</ul>
<p>2、数据文件里的数据可以通过字段加工、行加工处理满足表字段要求</p>
<p>3、使用数据导入</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、将t_40.csv数据导入到db_3数据库中的一个与t_40表结构一致的表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table t_40 like db_2.t_40;</span><br><span class="line"></span><br><span class="line">load data infile &#39;D:&#x2F;t_40.csv&#39; into table t_40; # 有可能因为字符集出现问题           </span><br><span class="line">load data infile &#39;D:&#x2F;t_40.csv&#39; into table t_40 charset utf8; </span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：数据加载的时候需要注意外部数据的字符集，在加载的时候需要指定字符集为外部文件数据格式，在表后增加字符集<code>charset 外部文件数据字符集</code></p>
<p>2、将t_40_self文件里的数据导入到db_3.t_40表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data infile &#39;D:&#x2F;t_40_self.csv&#39; into table t_40 charset utf8 fields terminated by &#39;-&#39; enclosed by &#39;&quot;&#39; lines starting by &#39;GO:&#39; (name,gender,age,class_name) ;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、表数据还原其实是将外部符合条件的数据，按照一定的格式要求导入到数据表中</p>
<p>2、数据导入可以解决不同格式数据或者不同数据库产品间的数据互相导入到对应数据库产品的问题</p>
<p>3、目前较少使用这种方式进行数据导入：数据的生成应该是业务产生，而不是人工参与（破坏数据的客观有效性，使得数据不真实）</p>
<h3 id="3、文件备份"><a href="#3、文件备份" class="headerlink" title="3、文件备份"></a>3、文件备份</h3><p><strong>文件备份</strong>：直接对数据表进行文件保留，属于物理备份</p>
<ul>
<li>文件备份操作简单，直接将数据表（或者数据库文件夹）进行保存迁移</li>
<li>MySQL中不同表存储引擎产生的文件不一致，保存手段也不一致<ul>
<li>InnoDB：表结构文件在ibd文件中，数据和索引存储在外部统一的ibdata文件中(Mysql7以前话是frm后缀)</li>
<li>MyIsam：每张表的数据、结构和索引都是独立文件，直接找到三个文件迁移即可</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、设定备份时间节点</p>
<p>2、设定备份文件存储位置</p>
<p>3、确定备份表的存储引擎</p>
<p>4、根据节点进行文件备份：将文件转移（复制）到其他存储位置</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、MyIsam表的文件备份：找到三个文件，复制迁移</p>
<ul>
<li>sdi：表结构文件</li>
<li>MYI：索引文件</li>
<li>MYD：数据文件</li>
</ul>
<p>2、InnoDB表的文件备份：找到两个文件，复制迁移</p>
<ul>
<li>ibd：表结构文件</li>
<li>ibdata：所有InnoDB数据文件</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、文件备份是一种简单粗暴的数据备份方式，是直接将数据文件打包管理的方式</p>
<ul>
<li>MyIsam存储引擎相对比较适合文件备份，因为MyIsam存储引擎表文件独立，不关联其他表</li>
<li>InnoDB不适合文件备份，因为不管是备份一张表还是全部数据表，都需要备份整个数据存储文件ibdata（适合整库迁移）</li>
</ul>
<p>2、文件备份方式非常占用磁盘空间</p>
<h3 id="4、文件还原"><a href="#4、文件还原" class="headerlink" title="4、文件还原"></a>4、文件还原</h3><p><strong>文件还原</strong>：利用备份的文件，替换出现问题的文件，还原到备份前的良好状态</p>
<ul>
<li><p>直接将备份的文件放到对应的位置即可</p>
</li>
<li><p>文件还原影响</p>
<ul>
<li>MyIsam存储引擎：单表备份，单表还原，不影响其他任何数据</li>
<li>InnoDB存储引擎：单表结构，整库数据，只适合整库备份还原，否则会影响其他InnoDB存储表</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、找到出问题的数据文件</p>
<ul>
<li>MyIsam：表结构、表数据、表索引三个文件（删掉即可）</li>
<li>InnoDB：表结构、整库数据表ibdata（删掉）</li>
</ul>
<p>2、将备份数据放到相应删除的文件位置</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、MyIsam数据备份表的数据迁移：单表迁移到不同数据库</p>
<p>2、InnoDB数据备份完成整个数据库的迁移（包括数据库用户信息）</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、文件备份的还原通常使用较少</p>
<ul>
<li>数据备份占用空间大，这种备份方式就少</li>
<li>InnoDB的备份是针对整个数据库里所有InnoDB表，还原会覆盖掉所有不需要还原的表</li>
</ul>
<p>2、文件备份与还原通常可以在数据迁移的情况下使用</p>
<ul>
<li>MyIsam：独立表的迁移（现在很少用，myisam很少用）</li>
<li>InnoDB：整个数据库的迁移</li>
</ul>
<h3 id="5、SQL备份"><a href="#5、SQL备份" class="headerlink" title="5、SQL备份"></a>5、SQL备份</h3><p><strong>SQL备份</strong>：将数据库的数据以SQL指令的形式保存到文件当中，属于逻辑备份</p>
<ul>
<li><p>SQL备份是利用Mysqldump.exe客户端实现备份</p>
</li>
<li><p>SQL备份是将备份目标（数据表）以SQL指令形式，从表的结构、数据和其他信息保存到文件</p>
<p><code>mysqldump.exe -h -P -u -p [备份选项] 数据库名字 [数据表列表] &gt; SQL文件路径</code></p>
</li>
<li><p>备份选项很多，常见的主要是数据库的备份多少</p>
<ul>
<li>全库备份：<code>--all-databases</code> 所有数据库的所有表，也不需要指定数据库名字</li>
<li>单库备份：<code>[--databases] 数据库</code> 指定数据库里的所有表（后面不要给表名）</li>
<li>部分表（单表）备份：<code>数据库名字 表1[ 表2...表N]</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定备份的时间：通常是有规则的时间备份</p>
<p>2、确定备份的目标级别：全库、单库、数据表</p>
<p>3、使用mysqldump实现备份</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、全库备份（借助于Windows下的cmd访问mysqldump.exe，当前用户使用root账号）</p>
<p><code>mysqldump.exe -uroot -proot --all-databases &gt; D:/mysql.sql</code></p>
<p>2、单库备份</p>
<p><code>mysqldump -uroot -proot --databases db_2 &gt; D:/db_2.sql</code></p>
<p>3、单表备份（没有创建数据库的指令）</p>
<p><code>mysqldump -uroot -proot db_2 t_40 t_42 &gt; D:/t_40_42.sql</code></p>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、SQL备份是一般更新频次不高的数据库的常用备份方式</p>
<p>2、SQL备份是将数据表（库）以SQL指令形式进行备份</p>
<ul>
<li>结构指令：表创建（库创建）</li>
<li>数据指令：insert数据</li>
</ul>
<p>3、SQL备份能够完成的备份结构和数据，而结构和数据又是独立的，所以比较方便用作备份和还原</p>
<ul>
<li>SQL备份比较耗费时间和占用性能，建议在闲时进行备份（用户不活跃时）</li>
<li>SQL备份可以根据数据表的重要性进行频次区分备份</li>
</ul>
<h3 id="6、SQL还原"><a href="#6、SQL还原" class="headerlink" title="6、SQL还原"></a>6、SQL还原</h3><p><strong>SQL还原</strong>：在需要用到SQL备份数据时，想办法让SQL执行，从而实现备份数据的还原</p>
<ul>
<li>SQL还原可以使用Mysql.exe进行操作</li>
</ul>
<p><code>mysql.exe -h -P -u -p [数据库名字] &lt; SQL文件路径</code></p>
<ul>
<li>SQL还原可以在进入到数据库之后利用SQL指令还原</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source SQL文件路径;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定数据库（表）需要进行数据还原</p>
<ul>
<li>数据错乱</li>
<li>数据不完整</li>
</ul>
<p>2、找到对应节点的SQL备份文件</p>
<p>3、SQL还原</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、使用mysql客户端对db_2的数据文件进行单库还原（通常针对数据库）</p>
<p><code>mysql.exe -uroot -p &lt; D:/db_2.sql</code></p>
<ul>
<li>注意：如果不是库备份，那么需要指定数据库才能执行的</li>
</ul>
<p><code>mysql.exe -uroot -p db_2 &lt; D:/t_40_42.sql</code></p>
<p>2、在进入数据库之后，使用source指令还原SQL备份（通常针对表）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source D:&#x2F;t_40_42.sql;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、SQL还原是利用SQL备份文件，触发SQL指令执行，从而恢复到指定时间点的结构和数据</p>
<p>2、SQL还原不能百分百保证数据库的数据不受影响</p>
<ul>
<li>SQL备份通常不具有实时性（一般都会有时间间断）</li>
</ul>
<h3 id="7、总结-1"><a href="#7、总结-1" class="headerlink" title="7、总结"></a>7、总结</h3><p>1、数据的备份与还原是作为数据库管理者和使用者都应该掌握的一项技能</p>
<ul>
<li>保障数据安全</li>
<li>保证系统正常运行</li>
<li>保障公司和客户的利益</li>
</ul>
<p>2、数据库备份与还原的方式很多，每一种都有自己的特点和适用点，需要我们熟练区分和选择</p>
<ul>
<li>表数据备份与还原：适用于数据导出和导入，数据具有结构，但是不包含字段和类型</li>
<li>文件备份与还原：简洁方便，但是需要区分存储引擎InnoDB和MyIsam（InnoDB不适合进行文件备份）</li>
<li>SQL备份与还原：不限定存储引擎，随时随地可以备份，不过备份和还原的效率都比较低（完整备份）</li>
</ul>
<p>3、数据库的备份与还原是一门学问，所以不同的企业、业务都会选择不同的备份策略，也有可能使用交叉策略备份来确保数据的安全，而且一般会将备份文件与运行环境分离开来以确保数据真正的隔离和安全。</p>
<h2 id="8-6-用户管理"><a href="#8-6-用户管理" class="headerlink" title="8.6 用户管理"></a>8.6 用户管理</h2><h3 id="1、账号管理"><a href="#1、账号管理" class="headerlink" title="1、账号管理"></a>1、账号管理</h3><p><strong>账号管理</strong>：根据项目的需求设置和管理账号</p>
<ul>
<li>账号是权限依赖的对象，先有账号才有权限</li>
<li>MySQL中账号的组成分为两个部分：用户名 @ 主机地址（root@localhost）<ul>
<li>用户名为用户登录时的名字</li>
<li>主机地址：是允许账号所在客户端的访问的客户端IP（如上述root只能在服务器本机通过客户端访问）</li>
</ul>
</li>
<li>账号管理<ul>
<li>创建账号：<code>create user 用户名@主机地址 identified by &#39;明文密码&#39;;</code></li>
<li>删除账号：<code>drop user 用户名@主机地址</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、根据项目要求创建用户</p>
<p>2、根据项目要求删除用户</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、根据项目情况，跟不同的项目组创建不同的账号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># A团队只允许在公司访问服务器，公司IP为163.177.151.110</span><br><span class="line">create user &#96;admin&#96;@&#96;163.177.151.110&#96; identified by &#39;admin123&#39;;</span><br><span class="line"></span><br><span class="line"># B团队不限定负责数据库管理，不限定工作地点</span><br><span class="line">create user &#96;admin&#96; identified by &#39;admin321&#39;;</span><br></pre></td></tr></table></figure>



<p>2、开发任务结束，A团队的任务已经完成，不需要进行数据库操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user &#96;admin&#96;@&#96;163.177.151.110&#96;;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、账号管理是用户管理的基础，但是账号管理也只是用户管理的一部分</p>
<ul>
<li>账号管理是要考虑数据安全因素划分</li>
<li>账号管理单独应用较少，一般都要配合权限控制</li>
<li>账号管理也是DBA对于数据库管理的一种重要手段：根据项目划分账号</li>
<li>大的项目或者大的数据库服务器上几乎不会给开发使用root账号（权限太大）</li>
</ul>
<h3 id="2、权限管理"><a href="#2、权限管理" class="headerlink" title="2、权限管理"></a>2、权限管理</h3><p><strong>权限管理</strong>：对账号进行权限的支持与回收</p>
<ul>
<li><p>账号创建之初除了登录是没有其他操作权限的</p>
</li>
<li><p>账号的管理通常需要配合权限的使用</p>
<ul>
<li>赋权：给账号绑定相应的权限 <code>grant 权限列表 on 数据库|*.数据表|* to 用户名@主机地址 </code></li>
<li>回收：将账号已有的权限回收 <code>revoke 权限列表 on 数据库|*.数据表|* from 用户名@主机地址 </code></li>
<li>刷新权限：<code>flush privileges</code></li>
<li>查看权限：<code>show grants for 用户名@主机地址</code></li>
</ul>
</li>
<li><p>MySQL提供的权限列表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Privilege</th>
<th>Grant Table Column</th>
<th>Context</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_all"><code>ALL [PRIVILEGES]</code></a></td>
<td>Synonym for “all privileges”</td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter"><code>ALTER</code></a></td>
<td><code>Alter_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter-routine"><code>ALTER ROUTINE</code></a></td>
<td><code>Alter_routine_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create"><code>CREATE</code></a></td>
<td><code>Create_priv</code></td>
<td>Databases, tables, or indexes</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-role"><code>CREATE ROLE</code></a></td>
<td><code>Create_role_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-routine"><code>CREATE ROUTINE</code></a></td>
<td><code>Create_routine_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-tablespace"><code>CREATE TABLESPACE</code></a></td>
<td><code>Create_tablespace_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-temporary-tables"><code>CREATE TEMPORARY TABLES</code></a></td>
<td><code>Create_tmp_table_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-user"><code>CREATE USER</code></a></td>
<td><code>Create_user_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-view"><code>CREATE VIEW</code></a></td>
<td><code>Create_view_priv</code></td>
<td>Views</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_delete"><code>DELETE</code></a></td>
<td><code>Delete_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop"><code>DROP</code></a></td>
<td><code>Drop_priv</code></td>
<td>Databases, tables, or views</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop-role"><code>DROP ROLE</code></a></td>
<td><code>Drop_role_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_event"><code>EVENT</code></a></td>
<td><code>Event_priv</code></td>
<td>Databases</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_execute"><code>EXECUTE</code></a></td>
<td><code>Execute_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_file"><code>FILE</code></a></td>
<td><code>File_priv</code></td>
<td>File access on server host</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_grant-option"><code>GRANT OPTION</code></a></td>
<td><code>Grant_priv</code></td>
<td>Databases, tables, or stored routines</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_index"><code>INDEX</code></a></td>
<td><code>Index_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_insert"><code>INSERT</code></a></td>
<td><code>Insert_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_lock-tables"><code>LOCK TABLES</code></a></td>
<td><code>Lock_tables_priv</code></td>
<td>Databases</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process"><code>PROCESS</code></a></td>
<td><code>Process_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_proxy"><code>PROXY</code></a></td>
<td>See <code>proxies_priv</code> table</td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_references"><code>REFERENCES</code></a></td>
<td><code>References_priv</code></td>
<td>Databases or tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_reload"><code>RELOAD</code></a></td>
<td><code>Reload_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client"><code>REPLICATION CLIENT</code></a></td>
<td><code>Repl_client_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave"><code>REPLICATION SLAVE</code></a></td>
<td><code>Repl_slave_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_select"><code>SELECT</code></a></td>
<td><code>Select_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-databases"><code>SHOW DATABASES</code></a></td>
<td><code>Show_db_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-view"><code>SHOW VIEW</code></a></td>
<td><code>Show_view_priv</code></td>
<td>Views</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_shutdown"><code>SHUTDOWN</code></a></td>
<td><code>Shutdown_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super"><code>SUPER</code></a></td>
<td><code>Super_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_trigger"><code>TRIGGER</code></a></td>
<td><code>Trigger_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_update"><code>UPDATE</code></a></td>
<td><code>Update_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_usage"><code>USAGE</code></a></td>
<td>Synonym for “no privileges”</td>
<td>Server administration</td>
</tr>
</tbody></table>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、创建新的用户账号</p>
<p>2、根据需求赋予/回收指定数据库（一般整库）或者指定数据表的操作权限</p>
<p>3、刷新权限</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、给用户admin@localhost分配权限：db_2下所有表的所有权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create user &#96;admin&#96;@&#96;localhost&#96; identified by &#39;123456&#39;;</span><br><span class="line">grant all privileges on db_2.* to &#96;admin&#96;@&#96;localhost&#96;;</span><br></pre></td></tr></table></figure>



<p>2、给用户admin分配权限：db_2下的查看视图权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grant select on db_2.v_student_1 to &#96;admin1&#96;;</span><br><span class="line">grant select on db_2.v_student_2 to &#96;admin1&#96;;</span><br><span class="line">grant select on db_2.v_student_3 to &#96;admin1&#96;;</span><br><span class="line">grant select on db_2.v_student_4 to &#96;admin1&#96;;</span><br><span class="line">grant select on db_2.v_student_5 to &#96;admin1&#96;;</span><br><span class="line">grant select on db_2.v_student_6 to &#96;admin1&#96;;</span><br></pre></td></tr></table></figure>



<p>3、回收权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 如果用户不要了，可以直接删除用户，保留用户不给权限，就回收全部权限</span><br><span class="line">revoke all on db_2.* from &#96;admin&#96;@&#96;localhost&#96;;</span><br><span class="line"></span><br><span class="line"># 针对单独授权表的权限回收：只能针对表进行操作</span><br><span class="line">revoke select on db_2.v_student_1 from &#96;admin1&#96;;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、权限管理是整个用户管理的核心：账号只能让用户能够连接服务器，而权限管理才能给用户提供各类操作</p>
<p>2、权限的操作是根据使用账号的用户需要出发的</p>
<ul>
<li>DBA用户通常可以分配整个数据库所有库的权限：all on *.*</li>
<li>项目管理级别的用户可以针对所负责项目的权限：all on 数据库.*（多个项目分配多次）</li>
<li>项目开发者用户可以针对所负责项目模块的权限：权限列表 on 数据库.表名/*（如果是跨项目分配多次）</li>
<li>常用的开发者权限有：<ul>
<li>create、alter、drop：库、表结构操作</li>
<li>insert、select、update、delete：数据操作</li>
<li>references：外键权限</li>
<li>index：索引</li>
</ul>
</li>
</ul>
<p>3、扩展：可以直接使用赋权创建新用户（MySQL7以上不允许这么操作）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select on db_2.* to &#96;user&#96;@&#96;localhost&#96; with grant option;</span><br></pre></td></tr></table></figure>



<h3 id="3、角色管理"><a href="#3、角色管理" class="headerlink" title="3、角色管理"></a>3、角色管理</h3><p><strong>角色管理</strong>：role，即根据角色来分配权限，然后用户只需要关联角色即可（分配角色）：Mysql8以后才有的</p>
<ul>
<li>角色的存在可以更方便的用户维护多个具有相同权限的用户（核心价值）</li>
<li>角色相关操作和语法<ul>
<li>创建角色：<code>create role 角色名字1[,角色名字2,...角色名字N]</code>（可批量创建）</li>
<li>分配权限：<code>grant 权限列表 on 数据库|*.数据表|* to 角色名字</code></li>
<li>绑定角色：<code>grant 角色名字 to 用户名@主机地址</code></li>
<li>撤销角色：<code>revoke 角色名字 from 用户名@主机地址</code></li>
<li>回收角色权限：<code>revoke 权限列表 on 数据库|*.数据表|* from 角色名字</code></li>
<li>删除角色：<code>drop role 角色名字1[,角色名字2,...角色名字N]</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p><strong>关联角色</strong></p>
<p>1、创建角色</p>
<p>2、确定角色的权限：给角色分配权限</p>
<p>3、将角色分配给用户（和第2步可以没有先后关系）</p>
<p><strong>取关角色</strong></p>
<p>1、权限过大：回收角色权限</p>
<p>2、放弃角色：删除角色</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建用户角色，分配给具有同样权限的用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 创建角色（角色与用户名很相似）</span><br><span class="line">create role developer,app_read,app_write;</span><br><span class="line"></span><br><span class="line"># 给角色分配权限</span><br><span class="line">grant all on db_2.* to developer;</span><br><span class="line">grant select on db_2.* to app_read;</span><br><span class="line">grant insert,update,delete on db_2.* to app_write;</span><br><span class="line"></span><br><span class="line"># 创建用户，并分配角色给用户</span><br><span class="line">create user &#39;admin1&#39;@&#39;%&#39; identified by &#39;1234&#39;;</span><br><span class="line">create user &#39;admin2&#39;@&#39;%&#39; identified by &#39;1234&#39;;</span><br><span class="line">create user &#39;admin3&#39;@&#39;%&#39; identified by &#39;1234&#39;;</span><br><span class="line"></span><br><span class="line">grant developer to &#39;admin1&#39;@&#39;%&#39;;</span><br><span class="line">grant app_read to &#39;admin2&#39;@&#39;%&#39;,&#39;admin1&#39;@&#39;%&#39;; # 允许批量给用户分配角色</span><br><span class="line">grant app_write to &#39;admin3&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：虽然权限已经最终关联到用户，但是用户并不能真正使用权限，还需要权限分配者每次登陆服务器时激活角色：<code>set default role all  to 用户名@主机地址</code>（一次只能激活一个角色）</p>
<ul>
<li>激活之后对应的用户需要退出之后重新登录才行</li>
</ul>
<p>2、回收角色权限或者角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 回收角色权限</span><br><span class="line">revoke insert,delete on db_2.* from app_write;</span><br><span class="line"></span><br><span class="line"># 回收角色</span><br><span class="line">revoke app_read from &#39;admin2&#39;@&#39;%&#39;;</span><br><span class="line"></span><br><span class="line"># 删除角色</span><br><span class="line">drop role developer;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、角色管理是利用角色与权限关联，实现角色批量关联用户</p>
<ul>
<li>方便权限的重复利用</li>
<li>方便相同权限用户的批量维护</li>
</ul>
<p>2、角色的使用需要角色创建者（有权限的就行）激活角色才能使用（关联角色的用户需要重新登录才会生效）</p>
<h1 id="9-PHP操作MySQL数据库"><a href="#9-PHP操作MySQL数据库" class="headerlink" title="9 PHP操作MySQL数据库"></a>9 PHP操作MySQL数据库</h1><h2 id="9-1-PHP扩展"><a href="#9-1-PHP扩展" class="headerlink" title="9.1 PHP扩展"></a>9.1 PHP扩展</h2><p><strong>PHP扩展</strong>：PHP中提供了一些PHP本身做不到，但是通过更底层的实现可以帮助PHP解决需求的外部支持</p>
<ul>
<li>PHP的外部支持在PHP安装目录下的ext文件夹下（extension扩展）</li>
<li>PHP的外部支持通常以dll（Windows下，动态链接库）结尾</li>
<li>PHP需要应用扩展就需要在配置文件中（php.ini）加载对应的动态链接库<ul>
<li>扩展路径：extension_dir</li>
<li>扩展名称：extension</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定需要使用的外部扩展的名字</p>
<p>2、确定外部扩展所在的路径（通常是统一放到ext目录下）</p>
<p>3、修改配置文件</p>
<ul>
<li>扩展路径（一次性修改）</li>
<li>扩展名称（按需加载）</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>在PHP中开启MySQLi数据库扩展，允许PHP实现数据库操作</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;配置路径</span></span><br><span class="line"><span class="attr">extension_dir</span> = <span class="string">&quot;D:/server/php7/ext&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;开启mysqli扩展，将mysqli前面的注释去掉</span></span><br><span class="line"><span class="attr">extension</span>=php_mysqli</span><br></pre></td></tr></table></figure>

<ul>
<li>PHP的配置文件已经加载到Apache，要生效，需要重启Apache</li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<p>1、扩展是PHP用来实现一些复杂功能时所要用到的其他技术体系</p>
<ul>
<li>扩展在必要时才加载</li>
<li>扩展加载分为两个部分<ul>
<li>扩展路径</li>
<li>扩展名字</li>
</ul>
</li>
</ul>
<p>2、PHP配置文件的修改要及时的重启服务器才会生效</p>
<h2 id="9-2-MySQLi扩展"><a href="#9-2-MySQLi扩展" class="headerlink" title="9.2 MySQLi扩展"></a>9.2 MySQLi扩展</h2><p><strong>MySQLi扩展</strong>：PHP提供的一套包含面向过程和面向对象两种方式实现的MySQL数据库操作</p>
<ul>
<li>PHP加载了MySQLi扩展后，PHP就可以充当MySQL的客户端<ul>
<li>连接认证服务器</li>
<li>发送SQL指令</li>
<li>接收SQL执行结果</li>
<li>解析结果</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、测试PHP加载MySQLi是否成功（PHPinfo()函数）</p>
<p>2、使用MySQLi提供的连接认证函数连接认证（mysqli_connect()函数）</p>
<p>3、检查连接信息（mysqli_connect_error()函数）</p>
<p>4、执行SQL操作</p>
<ul>
<li>新增操作</li>
<li>删除操作</li>
<li>查询操作</li>
<li>修改操作</li>
</ul>
<p>5、关闭连接（mysqli_close()函数）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>PHP操作MySQLi实现数据库的连接认证和关闭</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">phpinfo();	<span class="comment"># 查看PHP是否加载mysqli成功（测试使用，非正式代码）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、连接认证</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost:3306&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、错误检查</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>) <span class="keyword">die</span>(mysqli_connect_error());</span><br><span class="line"><span class="comment"># iconv函数可以实现字符集转换</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、其他操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、关闭连接</span></span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、mysqli提供的扩展里有很多函数可以帮助我们解决相应问题</p>
<p>2、PHP充当了mysql的客户端来操作服务器</p>
<ul>
<li>连接认证：错误检查</li>
<li>数据操作：错误检查</li>
<li>关闭连接</li>
</ul>
<h2 id="9-3-MySQLi常用函数"><a href="#9-3-MySQLi常用函数" class="headerlink" title="9.3 MySQLi常用函数"></a>9.3 MySQLi常用函数</h2><ul>
<li>mysqli_connect：连接认证，正确返回连接对象，失败返回false</li>
<li>mysqli_connect_error：连接时错误获取错误信息</li>
<li>mysqli_select_db：选择数据库，失败返回false，成功返回true</li>
<li>mysqli_set_charset：设置客户端字符集</li>
<li>mysqli_query：执行SQL指令，第一个参数为连接对象，第二个参数为SQL指令<ul>
<li>失败返回false</li>
<li>成功<ul>
<li>写操作返回true</li>
<li>读操作返回一个结果集对象</li>
</ul>
</li>
</ul>
</li>
<li>mysqli_insert_id：上一步新增操作产生的自增长id</li>
<li>mysqli_affected_rows：上一个操作（写）受影响的行数</li>
<li>mysqli_num_rows：当前结果集对象（读）中记录数</li>
<li>mysqli_fetch_assoc：从当前结果集中查询出一条记录，返回一个关联数组<ul>
<li>结果集指针与数组指针一样移动</li>
</ul>
</li>
<li>mysqli_fetch_row：从当前结果集中查询出一条记录，返回一个索引数组</li>
<li>mysqli_fetch_all：从结果集中取出所有记录，返回二维数组</li>
<li>mysqli_errno：上述所有操作（读写）出现错误的编号</li>
<li>mysqli_error：上述所有操作出现错误的信息</li>
<li>mysqli_free_result：释放当前查询得到的结果集</li>
<li>mysqli_close：断开当前连接</li>
</ul>
<h2 id="9-4-新增数据"><a href="#9-4-新增数据" class="headerlink" title="9.4 新增数据"></a>9.4 新增数据</h2><p><strong>新增数据</strong>：利用mysqli扩展将数据写入到数据库</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、收集用户数据和新增需求</p>
<p>2、连接认证数据库</p>
<p>3、设置字符集</p>
<p>4、选择数据库</p>
<p>5、组织新增SQL指令，确认是否需要获取自增长id</p>
<p>6、发送给数据库（mysqli_query函数）</p>
<p>7、判定执行指令的执行情况</p>
<ul>
<li>mysqli_errno：错误编号</li>
<li>mysqli_error：错误信息</li>
</ul>
<p>8、获取自增长id（确定需要获取），否则返回受影响的行数</p>
<p>9、新增完成，关闭连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>新增一个学生信息入库到db_2表中的t_40表中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、接收数据（通常外部传入，需要验证）</span></span><br><span class="line"><span class="variable">$name</span> = <span class="string">&#x27;自来也&#x27;</span>;</span><br><span class="line"><span class="variable">$gender</span> = <span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"><span class="variable">$age</span> = <span class="number">30</span>;</span><br><span class="line"><span class="variable">$class_name</span> = <span class="string">&#x27;木叶0班&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、连接认证数据库并处理可能出现的错误信息</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、选择数据库</span></span><br><span class="line">mysqli_select_db(<span class="variable">$conn</span>,<span class="string">&#x27;db_2&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、组织SQL指令</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into t_40 values(null,&#x27;<span class="subst">$name</span>&#x27;,&#x27;<span class="subst">$gender</span>&#x27;,<span class="subst">$age</span>,&#x27;<span class="subst">$class_name</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="comment"># 确定是否返回自增长id</span></span><br><span class="line"><span class="variable">$auto_id</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、执行SQL写入数据库</span></span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"><span class="comment"># if($res === false) die(mysqli_error($conn));</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、返回结果</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$auto_id</span>)) <span class="keyword">echo</span> mysqli_insert_id(<span class="variable">$conn</span>);	<span class="comment"># 自增长ID</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">echo</span> mysqli_affected_rows(<span class="variable">$conn</span>);				<span class="comment"># 受影响的行数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、关闭连接</span></span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、新增数据主要是利用mysqli_query执行写操作，然后得出受影响行数，必要时进行自增长id获取（在执行mysqli_query之后）</p>
<p>2、无论何时，我们都需要对进行的操作进行结果验证（凡是涉及到的数据存在外部来源时）</p>
<h2 id="9-5-更新数据"><a href="#9-5-更新数据" class="headerlink" title="9.5 更新数据"></a>9.5 更新数据</h2><p><strong>更新数据</strong>：利用MySQLi扩展，将已有数据进行更新入库</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、收集用户更新的数据信息并验证</p>
<p>2、连接认证数据库</p>
<p>3、设置字符集</p>
<p>4、选择数据库</p>
<p>5、组织更新SQL指令</p>
<p>6、发送给数据库（mysqli_query函数）</p>
<p>7、判定执行指令的执行情况</p>
<ul>
<li>mysqli_errno：错误编号</li>
<li>mysqli_error：错误信息</li>
</ul>
<p>8、返回受影响的行数</p>
<p>9、更新完成，关闭连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>将所有db_2库中t_40表中所有人的年龄都+1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、接收数据（通常外部传入，需要验证）</span></span><br><span class="line"><span class="comment"># 当前需求来自内部，不需要外部数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、连接认证数据库并处理可能出现的错误信息</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、选择数据库</span></span><br><span class="line">mysqli_select_db(<span class="variable">$conn</span>,<span class="string">&#x27;db_2&#x27;</span>) <span class="keyword">or</span> dir(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、组织SQL指令</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update t_40 set age = age + 1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、执行SQL写入数据库</span></span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span> === <span class="literal">false</span>) <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、返回结果</span></span><br><span class="line"><span class="keyword">echo</span> mysqli_affected_rows(<span class="variable">$conn</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、关闭连接</span></span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、更新操作通常是用户已有数据上的编辑后提交实现</p>
<p>2、更新操作较少出现全部更新，一般都是个别数据更新或者批量更新，都是需要进行where条件指定的</p>
<h2 id="9-6-删除数据"><a href="#9-6-删除数据" class="headerlink" title="9.6 删除数据"></a>9.6 删除数据</h2><p><strong>删除数据</strong>：利用MySQLi扩展，将已有数据从数据表删除</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、收集用户删除的数据信息并验证（通常有权限验证）</p>
<p>2、连接认证数据库</p>
<p>3、设置字符集</p>
<p>4、选择数据库</p>
<p>5、如果有必要，需要验证要删除的数据在数据库是否存在</p>
<p>6、组织删除SQL指令</p>
<p>7、发送给数据库（mysqli_query函数）</p>
<p>8、判定执行指令的执行情况</p>
<ul>
<li>mysqli_errno：错误编号</li>
<li>mysqli_error：错误信息</li>
</ul>
<p>9、返回受影响的行数</p>
<p>10、删除完成，关闭连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>删除db_2库里t_45表中没有班级的学生</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、接收数据（通常外部传入，需要验证）</span></span><br><span class="line"><span class="comment"># 当前需求来自内部，不需要外部数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、连接认证数据库并处理可能出现的错误信息</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、选择数据库</span></span><br><span class="line">mysqli_select_db(<span class="variable">$conn</span>,<span class="string">&#x27;db_2&#x27;</span>) <span class="keyword">or</span> dir(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、组织SQL指令</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from t_45 where c_id is null&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、执行SQL写入数据库</span></span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、返回结果</span></span><br><span class="line"><span class="keyword">echo</span> mysqli_affected_rows(<span class="variable">$conn</span>);;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、关闭连接</span></span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、删除操作与更新操作本质是一样的，都是写操作（包括新增），只是业务层面上有一些区别</p>
<ul>
<li>新增：用户需要提交全部数据（数据最多，无主键，自增长）</li>
<li>更新：用户提交部分更新数据（数据较少，有主键，更新条件）</li>
<li>删除：用户一般是点击或者选择执行（只有主键）</li>
</ul>
<p>2、很多时候，重要的业务数据一般对用户提供删除操作，但是实际并不删除：设置一个字段，用来记录是否删除（最终删除演变成更新操作）</p>
<h2 id="9-7-查询数据"><a href="#9-7-查询数据" class="headerlink" title="9.7 查询数据"></a>9.7 查询数据</h2><p><strong>查询数据</strong>：利用MySQLi扩展，从数据库查询出数据，并进行浏览器显示（变成浏览器能够识别的格式）</p>
<ul>
<li>数据查询逻辑<ul>
<li>mysqli_query将数据查询出来，此时是一个结果集对象（PHP和浏览器都不可识别）</li>
<li>利用结果集查询mysqli_fetch系列函数将结果集翻译出来，此时是一个数组（PHP能识别）</li>
<li>PHP将数组按照指定格式解析到HTML中（浏览器能识别）</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、根据需求确定要获取的数据来源</p>
<p>2、连接认证数据库</p>
<p>3、设置字符集</p>
<p>4、选择数据库</p>
<p>5、组织查询SQL指令</p>
<p>6、发送给数据库（mysqli_query函数）</p>
<p>7、判定执行指令的执行情况</p>
<ul>
<li>mysqli_errno：错误编号</li>
<li>mysqli_error：错误信息</li>
</ul>
<p>8、解析查询结果集</p>
<ul>
<li>索引数组：mysqli_fetch_row()：不包含字段名</li>
<li>关联数组：mysqli_fetch_assoc()：包含字段名（数组下标：使用较多）</li>
</ul>
<p>9、释放结果集资源：mysqli_free_result()</p>
<p>10、实现数据输出</p>
<p>11、查询完成，关闭连接</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>获取db_2库里t_40表中所有学生信息并显示在表格里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、接收数据：查询条件，当前没有条件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、连接认证数据库并处理可能出现的错误信息</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、选择数据库</span></span><br><span class="line">mysqli_select_db(<span class="variable">$conn</span>,<span class="string">&#x27;db_2&#x27;</span>) <span class="keyword">or</span> dir(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、组织SQL指令</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from t_40&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、执行SQL查出所有数据</span></span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span> === <span class="literal">false</span>) <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、解析结果</span></span><br><span class="line"><span class="variable">$one</span> = mysqli_fetch_assoc(<span class="variable">$res</span>);	<span class="comment"># 取出一条记录</span></span><br><span class="line">                                                          </span><br><span class="line"><span class="comment"># 取出全部：循环</span></span><br><span class="line"><span class="variable">$lists</span> = [];</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$one</span> = mysqli_fetch_assoc(<span class="variable">$res</span>))&#123;</span><br><span class="line">    <span class="variable">$lists</span>[] = <span class="variable">$one</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、释放结果集资源</span></span><br><span class="line">mysqli_free_result(<span class="variable">$res</span>);</span><br><span class="line">                                                          </span><br><span class="line"><span class="comment"># 9、关闭连接</span></span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br><span class="line">                                                          </span><br><span class="line"><span class="comment"># 10、输出表格</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;table&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;id&lt;/td&gt;&lt;td&gt;姓名&lt;/td&gt;&lt;td&gt;性别&lt;/td&gt;&lt;td&gt;年龄&lt;/td&gt;&lt;td&gt;班级&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$lists</span> <span class="keyword">as</span> <span class="variable">$one</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$one[&#x27;id&#x27;]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$one[&#x27;name&#x27;]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$one[&#x27;gender&#x27;]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$one[&#x27;age&#x27;]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$one[&#x27;class_name&#x27;]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/table&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、查询操作是数据库操作最常见的操作</p>
<ul>
<li>查询得到的结果不能直接被PHP接续，是一种结果集</li>
<li>结果集需要通过MySQLi提供的函数进行解析，取出里面的数据变成PHP可以理解的数据</li>
</ul>
<h2 id="9-8-总结"><a href="#9-8-总结" class="headerlink" title="9.8 总结"></a>9.8 总结</h2><p>1、PHP要操作数据库是通过扩展实现的，MySQLi扩展是目前通用的一种面向过程的MySQL扩展（也支持面向对象）</p>
<p>2、扩展的使用本质是使用扩展里提供的函数来帮助我们解决需求问题</p>
<ul>
<li>连接认证数据库：mysqli_connect</li>
<li>设置字符集：mysqli_set_charset</li>
<li>选择数据库：mysqli_select_db</li>
<li>执行SQL指令：mysqli_query</li>
<li>判定执行结果，获取错误信息：mysqli_errno/mysqli_error</li>
<li>新增获取自增长id：mysqli_insert_id</li>
<li>写操作获取受影响的行数：mysqli_affected_rows</li>
<li>解析查询结果：<strong>mysqli_fetch_assoc</strong>/mysqli_fetch_row</li>
<li>释放结果集资源：mysqli_free_result</li>
<li>关闭连接资源：mysqli_close</li>
</ul>
<p>3、不管是写操作还是读操作，每一次SQL操作有一些过程是相同的，应该进行封装实现代码复用</p>
<ul>
<li>数据库的连接认证以及错误处理（包括字符集和数据库选择）</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 成功返回连接，失败返回false</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">&amp;<span class="variable">$error</span>,<span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$dbname</span>,<span class="variable">$host</span> = <span class="string">&#x27;localhost&#x27;</span>,<span class="variable">$port</span> = <span class="string">&#x27;3306&#x27;</span>,<span class="variable">$charset</span> = <span class="string">&#x27;utf8&#x27;</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 连接认证</span></span><br><span class="line">    <span class="variable">$conn</span> = @mysqli_connect(<span class="variable">$host</span>,<span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$dbname</span>,<span class="variable">$port</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定：连接失败，将错误信息记录下来，并返回false</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$conn</span>) &#123;</span><br><span class="line">        <span class="variable">$error</span> = iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置字符集</span></span><br><span class="line">    <span class="keyword">if</span>(!mysqli_set_charset(<span class="variable">$conn</span>,<span class="variable">$charset</span>))&#123;</span><br><span class="line">        <span class="variable">$error</span> = mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回正确结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$conn</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>SQL的执行和错误检测，以及错误处理</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL执行，返回执行结果，执行失败返回false，并记录错误信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$sql</span>,&amp;<span class="variable">$error</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行失败</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$error</span> = mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回执行结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数据的查询操作（一条记录和多条记录）</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询：分为一条记录查询或者多条记录查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$sql</span>,&amp;<span class="variable">$error</span>,<span class="variable">$all</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 调用执行函数</span></span><br><span class="line">    <span class="variable">$res</span> = execute(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定结果</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析结果</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$all</span>)&#123;</span><br><span class="line">        <span class="comment"># 获取全部结果</span></span><br><span class="line">        <span class="variable">$lists</span> = [];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysqli_fetch_assoc(<span class="variable">$res</span>))&#123;</span><br><span class="line">            <span class="variable">$lists</span>[] = <span class="variable">$res</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$lists</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># 获取一条结果</span></span><br><span class="line">        <span class="keyword">return</span> mysqli_fetch_assoc(<span class="variable">$res</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>写操作封装</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写操作：考虑是否需要获取自增长id</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$sql</span>,&amp;<span class="variable">$error</span>,<span class="variable">$insert</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 默认操作为删改操作（不需要自增长ID的操作）</span></span><br><span class="line">    <span class="variable">$res</span> = execute(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定结果</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 针对用户需求判定</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$insert</span>) <span class="keyword">return</span> mysqli_insert_id(<span class="variable">$conn</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> mysqli_affected_rows(<span class="variable">$conn</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-新闻管理系统"><a href="#10-新闻管理系统" class="headerlink" title="10 新闻管理系统"></a>10 新闻管理系统</h1><h2 id="10-1-表单传值"><a href="#10-1-表单传值" class="headerlink" title="10.1 表单传值"></a>10.1 表单传值</h2><h3 id="1、表单传值"><a href="#1、表单传值" class="headerlink" title="1、表单传值"></a>1、表单传值</h3><p><strong>表单传值</strong>：通过HTML表单，实现数据在浏览器端录入，并传递给后端语言</p>
<ul>
<li>表单传值是一种数据的传递方式</li>
<li>表单传值有多种，但是在网站应用里通常使用两种<ul>
<li>GET传值</li>
<li>POST传值</li>
</ul>
</li>
<li>表单传值给服务器做动态数据支撑提供了必要条件<ul>
<li>数据可以从浏览器端存储到服务器（数据新增）</li>
<li>数据可以通过浏览器让服务器进行数据筛选（数据查询）</li>
</ul>
</li>
<li>表单传值需要用到表单元素<ul>
<li>form表单：用来包裹多个表单元素一并提交</li>
<li>input表单元素<ul>
<li>text：文本数据</li>
<li>password：密文数据</li>
<li>textarea：长文本数据</li>
<li>hidden：隐藏数据</li>
<li>submit：提交按钮</li>
</ul>
</li>
<li>下拉框表单：select</li>
<li>按钮选择<ul>
<li>radio：单选框（互斥选框）</li>
<li>CheckBox：多选框</li>
</ul>
</li>
<li>url传值<ul>
<li>a标签：直接在请求链接后使用 ? + 数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定浏览器传值给服务器</p>
<p>2、选择传值的方式</p>
<ul>
<li>url传值：a标签</li>
<li>form表单传值：表单元素</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、url传值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;login.php?username&#x3D;XXX&quot;&gt;登录&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>2、表单传值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   	&lt;body&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;#提交对象：login.php&quot; method&#x3D;&quot;GET&#x2F;POST&quot;&gt;</span><br><span class="line">            用户名：&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">            密码：&lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、表单传值是利用HTML里的表单元素收集用户数据，或者是提供url绑定数据</p>
<ul>
<li>form表单：通常是用户提交写入的数据</li>
<li>url绑定：通常是系统提供的数据，然后让用户点击操作</li>
</ul>
<p>2、表单传值打通了用户与服务器的数据关系，允许用户将自己的数据提交给服务器，从而有了服务器的可操作空间 </p>
<h3 id="2、POST传值"><a href="#2、POST传值" class="headerlink" title="2、POST传值"></a>2、POST传值</h3><p><strong>POST传值</strong>：通过form表单使用post方式，将数据从浏览器以<strong>肉眼不可见</strong>形式传输给服务器</p>
<ul>
<li>POST传值必须使用form表单<ul>
<li>form表单的属性method的值为post（不区分大小写）</li>
<li>所有需要提交给服务器的数据元素都必须在form表单内部</li>
</ul>
</li>
<li>要提交的表单元素本身必须拥有name属性（无name属性无法提交）</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、form表单method属性使用post</p>
<p>2、根据需要提交的数据的数量和类型选择合适的form表单元素</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、提交用户登录信息：用户名和密码信息，提交给login.php处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   	&lt;body&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;login.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            用户名：&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">            密码：&lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>2、提交新闻信息入库：标题、作者、内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">   	&lt;body&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;insert.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            标题：&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;title&quot;&gt;</span><br><span class="line">            作者：&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;author&quot;&gt;</span><br><span class="line">            内容：&lt;textarea name&#x3D;&quot;content&quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、post提交数据是基于form表单，只能通过form表单实现</p>
<p>2、post提交的数据不会在浏览器的地址栏出现，是为了让数据的安全性增加</p>
<p>3、post的原始意义在于数据的提交入库：也就是说通过post提交的数据通常是要进行数据库的写操作的（安全要求除外）</p>
<h3 id="3、GET传值"><a href="#3、GET传值" class="headerlink" title="3、GET传值"></a>3、GET传值</h3><p><strong>GET传值</strong>：将浏览器的数据以<strong>肉眼可见</strong>的形式提交给服务器</p>
<ul>
<li>GET传值可以通过form表单实现也可以通过url直接实现<ul>
<li>form表单：method属性使用GET（要提交的元素必须有name属性）</li>
<li>URL：直接在a标签href属性里增加要传递的数据</li>
</ul>
</li>
<li>GET传值的数据可以在浏览器地址栏里看到</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定使用GET方式传递数据</p>
<p>2、选择合适的传值方式</p>
<ul>
<li>form表单method为GET提交多个数据</li>
<li>a标签href属性提交数据：index.php?name=value&amp;name=value…</li>
</ul>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、使用form表单提交检索数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;check.php&quot; action&#x3D;&quot;get&quot;&gt;</span><br><span class="line">            商品名字：&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;goods_name&quot;&gt;</span><br><span class="line">            商品颜色：&lt;select name&#x3D;&quot;goods_color&quot;&gt;</span><br><span class="line">                &lt;option value&#x3D;1&gt;红色&lt;&#x2F;option&gt;</span><br><span class="line">                &lt;option value&#x3D;2&gt;绿色&lt;&#x2F;option&gt;</span><br><span class="line">                &lt;option value&#x3D;3&gt;蓝色&lt;&#x2F;option&gt;</span><br><span class="line">            &lt;&#x2F;select&gt;</span><br><span class="line">        	&lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;查询&quot;&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>2、使用url传值：要删除的数据（新闻）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;delete.php?id&#x3D;1&quot;&gt;太平洋竟然漏水&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;delete.php?id&#x3D;2&quot;&gt;珠穆朗玛峰长高了&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;delete.php?id&#x3D;3&quot;&gt;白令海峡结冰了&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;delete.php?id&#x3D;4&quot;&gt;北极熊去南极找企鹅&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href&#x3D;&quot;delete.php?id&#x3D;5&quot;&gt;百慕大又双叕沉船&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、GET传值是会让用户能够直接在地址栏里看到具体的数据信息的</p>
<p>2、GET传值的目的，通常是为了将数据提交给服务器用户数据的查询操作（提交的数据通常是查询条件）</p>
<p>3、GET不会传输特别重要的数据信息</p>
<h3 id="4、PHP接收表单数据"><a href="#4、PHP接收表单数据" class="headerlink" title="4、PHP接收表单数据"></a>4、PHP接收表单数据</h3><p><strong>PHP接收表单数据</strong>：PHP将用户通过表单传递的数据变成PHP可识别的数据和可操作的方式</p>
<ul>
<li>PHP接收数据的系统行为，自动接收（PHP语言为了开发者使用方便）</li>
<li>PHP接收数据有三种方式，每一种方式都是表单元素的name属性的值作为数组元素下标，具体数据作为数组元素的值<ul>
<li>$_GET：接收浏览器GET方式传递的数据</li>
<li>$_POST：接收浏览器POST方式传递的数据</li>
<li>$_REQUEST：接收浏览器GET和POST提交的数据<ul>
<li>POST与GET如果有同名表单（名字），POST会覆盖GET</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、明确浏览器数据提交的方式：开发者后台定义后，不受浏览器端用户控制</p>
<p>2、选择合适的PHP接收方式</p>
<p>3、在浏览器请求的PHP脚本中使用PHP接收指令</p>
<p>4、通过数组下标（表单元素名字）访问数据（提交的值）</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、接收用户登录提交的信息：login.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户是POST提交，所以应该使用$_POST或者$_REQUEST接收</span></span><br><span class="line">var_dump(<span class="variable">$_GET</span>,<span class="variable">$_POST</span>,<span class="variable">$_REQUEST</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出数据加工</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br></pre></td></tr></table></figure>



<p>2、接收用户的删除信息：delete.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全接收方式</span></span><br><span class="line"><span class="variable">$id</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) ? intval(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) : <span class="number">0</span>;</span><br><span class="line"><span class="comment"># isset判定是为了让脚本在没有真正接到数据时不会报错，从而不友好</span></span><br><span class="line"><span class="comment"># intval是因为id通常是逻辑的，需要加工成整型，这样可以防止外部进行SQL攻击</span></span><br><span class="line"><span class="comment"># 默认值0是为了方便后续进行判定，因为逻辑主键不会存在0的</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、PHP提供了三种方式接收用户提交的普通表单数据</p>
<ul>
<li>$_GET：接收浏览器GET方式传递的数据</li>
<li>$_POST：接收浏览器POST方式传递的数据</li>
<li>$_REQUEST：接收浏览器GET和POST提交的数据（因为覆盖所以不安全）</li>
</ul>
<p>2、接收数据时要考虑到数据的安全性</p>
<ul>
<li>恶意访问：isset进行存在性判定</li>
<li>数据乱写：类型转换保证数据安全</li>
<li>数据判定：保证数据的可靠性再进行服务器其他操作（提升服务器的有效工作效率）</li>
</ul>
<h2 id="10-2-新闻管理系统"><a href="#10-2-新闻管理系统" class="headerlink" title="10.2 新闻管理系统"></a>10.2 新闻管理系统</h2><h3 id="1、数据库设计"><a href="#1、数据库设计" class="headerlink" title="1、数据库设计"></a>1、数据库设计</h3><p><strong>数据库设计</strong>：根据要做的系统分析出内部存在的实体以及实体间的联系，然后创建对应的表来实现需求里复杂的关系</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、分析找出需求中存在的实体（确定表数量）</p>
<p>2、找出实体本身应该存在的信息（确定表内在属性）</p>
<p>3、找出实体间的关联关系（确定表关系）</p>
<p>4、必要时确定表关系的约束性（外键、唯一键等）</p>
<p>5、创建数据库</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、一个新闻管理系统应该包含的信息如下</p>
<ul>
<li>新闻发布者：作者author</li>
<li>新闻本身：news</li>
<li>新闻分类：category</li>
<li>发布者来源：新闻平台platform</li>
<li>评论信息：comment</li>
<li>用户管理：user</li>
</ul>
<p><strong>简易新闻管理系统</strong>：作者、新闻</p>
<p>2、确定试题内在联系（简易新闻管理系统）</p>
<ul>
<li>作者：作者id、名字、所属平台</li>
<li>新闻：新闻id，标题、内容、发布时间</li>
</ul>
<p>3、确定实体间的关联关系（简易新闻管理系统）</p>
<ul>
<li>新闻：作者id</li>
</ul>
<p>4、创建数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 数据库</span><br><span class="line">create database news charset utf8;</span><br><span class="line"></span><br><span class="line"># 创建数据表</span><br><span class="line">create table news.author(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    platform varchar(50) comment &#39;发布平台&#39;</span><br><span class="line">)charset utf8;</span><br><span class="line">insert into news.author values(null,&#39;佚名&#39;,&#39;佚名自媒体&#39;),</span><br><span class="line">(null,&#39;留白&#39;,&#39;海上自媒体&#39;),(null,&#39;花田错&#39;,&#39;音乐自媒体&#39;);</span><br><span class="line"></span><br><span class="line">create table news.news(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    title varchar(50) not null comment &#39;新闻标题&#39;,</span><br><span class="line">    content text not null comment &#39;新闻内容&#39;,</span><br><span class="line">    a_id int unsigned not null comment &#39;作者id&#39;,</span><br><span class="line">    publish int unsigned not null comment &#39;发布时间&#39;</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、根据需求设计数据库实际上是一个经验活，需要做的多之后才知道具体该怎么划分和设计，但是总的步骤是不变的</p>
<ul>
<li>确定实体数量（表）</li>
<li>确定实体内在关联（字段）</li>
<li>确定实体间关系（外联）</li>
<li>设置数据库</li>
</ul>
<p>2、数据库的设计就是看上去平台可能不大，但是实际涉及的实体数量和字段却很多。大型项目的实体数量和字段数量是非常多的</p>
<h3 id="2、新增新闻"><a href="#2、新增新闻" class="headerlink" title="2、新增新闻"></a>2、新增新闻</h3><p><strong>新增新闻</strong>：用户通过新增表单实现新闻入库</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定访问新增表单的url：用户直接访问（add.php）</p>
<ul>
<li><p>获取作者信息</p>
</li>
<li><p>PHP加载HTML文件进行表单展示</p>
</li>
</ul>
<p>2、确定表单的提交方式和提交对象</p>
<ul>
<li>method：post提交</li>
<li>action：将来处理新闻新增的PHP文件：insert.php</li>
<li>显示作者信息</li>
</ul>
<p>3、PHP接收用户提交的数据</p>
<ul>
<li>安全接收</li>
<li>数据逻辑验证</li>
</ul>
<p>4、PHP操作数据库</p>
<ul>
<li>连接认证（选择数据库）</li>
<li>字符集设置</li>
<li>安全验证</li>
</ul>
<p>5、组织SQL入库</p>
<ul>
<li>组织SQL指令</li>
<li>执行SQL指令</li>
<li>安全验证SQL执行</li>
</ul>
<p>6、提示操作结果</p>
<ul>
<li>正确：跳转到列表页</li>
<li>错误：回到新增页面</li>
</ul>
<blockquote>
<p>实现</p>
</blockquote>
<p>1、创建add.php，然后加载添加新闻的表单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 包含模板文件</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;news_add.html&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>2、修改资源：静态资源（js、css）和表单资源</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;insert.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;news_title&quot;</span>&gt;</span>新闻标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&#x27;news_title&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;news_author&quot;</span>&gt;</span>作者<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;a_id&quot;</span>&gt;</span>作者名字<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;news_content&quot;</span>&gt;</span>新闻内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;12&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-block&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、在add.php中，加载新增表单之前要获取所有作者信息（假设作者是注册的）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接认证</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="string">&#x27;3306&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_connect_error());</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有数据</span></span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="string">&#x27;select id,name from author&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出数据</span></span><br><span class="line"><span class="variable">$authors</span> = [];</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysqli_fetch_assoc(<span class="variable">$res</span>))&#123;</span><br><span class="line">    <span class="variable">$authors</span>[] = <span class="variable">$row</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含模板文件</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;news_add.html&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4、在模板中显示所有的作者信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;insert.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;news_title&quot;&gt;新闻标题&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;title&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&#39;news_title&#39;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--正常不用增加这一栏，一般需要用户登录才能发表--&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;news_author&quot;&gt;作者&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;author&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&#39;news_author&#39;&gt;</span><br><span class="line">        &lt;select name&#x3D;&quot;author&quot;&gt;</span><br><span class="line">            &lt;?php foreach($authors as $author):?&gt;</span><br><span class="line">            &lt;option value&#x3D;&quot;&lt;?php echo $author[&#39;id&#39;];?&gt;&quot;&gt;&lt;?php echo $author[&#39;name&#39;];?&gt;&lt;&#x2F;option&gt;</span><br><span class="line">            &lt;?php endforeach;?&gt;</span><br><span class="line">        &lt;&#x2F;select&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;news_content&quot;&gt;新闻内容&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;textarea class&#x3D;&quot;form-control&quot; name&#x3D;&quot;content&quot; rows&#x3D;&quot;12&quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button class&#x3D;&quot;btn btn-primary btn-block&quot;&gt;添加&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>5、创建insert.php接收数据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收数据</span></span><br><span class="line"><span class="variable">$title</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;title&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$a_id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;author&#x27;</span>] ?? <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全判定（简单判定）</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$title</span>) || <span class="keyword">empty</span>(<span class="variable">$content</span>))&#123;</span><br><span class="line">    <span class="comment"># 错误跳转重来</span></span><br><span class="line">    header(<span class="string">&#x27;refresh:3;url=add.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;新闻标题和内容都不能为空！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、连接认证数据库</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接认证</span></span><br><span class="line"><span class="variable">$conn</span> = @mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="string">&#x27;3306&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_connect_error());</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置字符集</span></span><br><span class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$conn</span>));</span><br></pre></td></tr></table></figure>

<p>7、组织数据入库</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据入库：时间戳可以使用mysql自动生成，也可以使用PHP生成好放进去（建议生成好）</span></span><br><span class="line"><span class="variable">$publish</span> = time();</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into news values(null,&#x27;<span class="subst">&#123;$title&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$content&#125;</span>&#x27;,<span class="subst">&#123;$a_id&#125;</span>,<span class="subst">&#123;$publish&#125;</span>)&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>8、判定结果，然后处理</p>
<ul>
<li>正确跳转到列表页（首页）：index.php</li>
<li>失败回到新增页面：add.php</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判定数据</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;refresh:2;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;新闻：&#x27;</span> . <span class="variable">$title</span> . <span class="string">&#x27; 新增成功！&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&#x27;refresh:3;url=add.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;新闻：&#x27;</span> . <span class="variable">$title</span> . <span class="string">&#x27;新增失败！&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后可以不用使用exit终止脚本了</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、新增的核心逻辑是分成两个部分的</p>
<ul>
<li>提供新增表单：让用户可以提供数据</li>
<li>提供新增处理：接收用户数据后安全入库</li>
</ul>
<p>2、表单页面通常属于HTML文件，一般情况下，我们都不会让浏览器直接访问HTML文件，而是访问对应的PHP文件，由PHP去选择是加载HTML文件还是进行其他逻辑处理</p>
<p>3、新增要考虑成功后的逻辑</p>
<ul>
<li>成功后去到列表：提示成功即可，也不需要获取成功操作的其他数据</li>
<li>成功后去到查看详情页：需要获取到当前操作成功的id，然后带着id去请求另外一个实现详情页的文件（PHP文件）</li>
</ul>
<h3 id="3、封装"><a href="#3、封装" class="headerlink" title="3、封装"></a>3、封装</h3><p><strong>封装</strong>：将需要重复使用的代码或者某些特定的功能使用函数进行管理</p>
<ul>
<li>根据业务需求对操作进行封装，后续只需要直接对文件进行包含，然后对函数调用即可</li>
<li>业务封装主要是根据数据库的操作需求实现各类封装<ul>
<li>初始化</li>
<li>数据新增</li>
<li>数据编辑（更新和删除）</li>
<li>数据查询</li>
</ul>
</li>
</ul>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、初始化封装：连接认证、数据库选择、字符集设置</p>
<p>2、SQL指令执行封装：错误处理</p>
<p>3、自动更新封装：提供数据自动构造更新指令，实现更新</p>
<p>4、自动查询操作：提供查询条件，自动构造查询指令，实现查询</p>
<p>5、普通查询：用户自己组装SQL指令</p>
<blockquote>
<p>实现</p>
</blockquote>
<p>1、初始化封装（Sql.php）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化功能：连接认证、选择数据库、设定字符集</span></span><br><span class="line"><span class="comment"># 成功返回连接对象，失败返回false，错误记录在错误参数中</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$user</span>,<span class="variable">$pass</span>,<span class="variable">$dbname</span>,&amp;<span class="variable">$error</span>,<span class="variable">$host</span> = <span class="string">&#x27;localhost&#x27;</span>,<span class="variable">$port</span> = <span class="string">&#x27;3306&#x27;</span>,<span class="variable">$charset</span> = <span class="string">&#x27;utf8&#x27;</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 连接认证</span></span><br><span class="line">    <span class="variable">$conn</span> = @mysqli_connect(<span class="variable">$host</span>,<span class="variable">$user</span>,<span class="variable">$pass</span>,<span class="variable">$dbname</span>,<span class="variable">$port</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证错误</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$conn</span>)&#123;</span><br><span class="line">        <span class="variable">$error</span> = iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,mysqli_connect_error());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置字符集</span></span><br><span class="line">    <span class="keyword">if</span>(!mysqli_set_charset(<span class="variable">$conn</span>,<span class="variable">$charset</span>))&#123;</span><br><span class="line">        <span class="variable">$error</span> = mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$conn</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、SQL指令执行封装</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 外部传入SQL，负责执行也验证SQL语法问题，成功返回结果，失败返回false，错误记录在错误参数中</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$sql</span>,&amp;<span class="variable">$error</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 执行SQL</span></span><br><span class="line">    <span class="variable">$res</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span> === <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="variable">$error</span> = mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回执行的正确结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上操作也是普通的写操作</li>
</ul>
<p>3、简易自动更新</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户提供要更新的数据和主键id，自动组装SQL</span></span><br><span class="line"><span class="comment"># 成功返回受影响的行数，失败返回false（0表示没有更新）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auto_update</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$data</span>,<span class="variable">$table</span>,&amp;<span class="variable">$error</span>,<span class="variable">$id</span> = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 组织更新部分数据：字段名 = 值</span></span><br><span class="line">    <span class="variable">$set</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="variable">$set</span> .= <span class="variable">$k</span> . <span class="string">&quot;=&#x27;<span class="subst">&#123;$v&#125;</span>&#x27;,&quot;</span>;</span><br><span class="line">    &#125; <span class="comment"># title = &#x27;title&#x27;,content = &#x27;content&#x27;,</span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 清除多余的右侧逗号</span></span><br><span class="line">    <span class="variable">$set</span> = rtrim(<span class="variable">$set</span>,<span class="string">&#x27;,&#x27;</span>);	<span class="comment"># $set : title = &#x27;title&#x27;,content = &#x27;content&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 组织更新指令</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;update <span class="subst">&#123;$table&#125;</span> set <span class="subst">&#123;$set&#125;</span> &quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 组装where条件（id不为0才组织）：要求主键字段名字必须为ID</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$id</span>) <span class="variable">$sql</span> .= <span class="string">&#x27; where id = &#x27;</span> . <span class="variable">$id</span>;	</span><br><span class="line">    <span class="comment"># update 表名 set title = &#x27;title&#x27;,content = &#x27;content&#x27; where id = 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行</span></span><br><span class="line">    <span class="keyword">if</span>(query(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>))</span><br><span class="line">        <span class="keyword">return</span> mysqli_affected_rows(<span class="variable">$conn</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>4、简易自动查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统提供查询条件（只能是=比较和and逻辑运算），可以查询一条记录或者多条记录</span></span><br><span class="line"><span class="comment"># 成功返回数组（多条二维数组，一条一维数组）失败返回false，错误记录在参数中</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auto_read</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$table</span>,&amp;<span class="variable">$error</span>,<span class="variable">$where</span> = [],<span class="variable">$all</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 组装查询条件：默认永远为真</span></span><br><span class="line">    <span class="variable">$where_clause</span> = <span class="string">&#x27; where 1 &#x27;</span>;	<span class="comment"># where 1</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$where</span>)&#123;		<span class="comment"># 空数组自动转换成布尔false</span></span><br><span class="line">        <span class="comment"># 解析条件</span></span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$where</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">            <span class="variable">$where_clause</span> .= <span class="string">&#x27; and &#x27;</span> . <span class="variable">$k</span> . <span class="string">&quot; = &#x27;<span class="subst">$v</span>&#x27; &quot;</span>;</span><br><span class="line">        &#125;  <span class="comment"># where 1 and title = &#x27;news&#x27; ...      </span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 组织完整SQL</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from <span class="subst">&#123;$table&#125;</span> <span class="subst">&#123;$where_clause&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = query(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定执行结果</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span> === <span class="literal">false</span>) <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 判定获取一条还是多条</span></span><br><span class="line">    <span class="variable">$lists</span> = [];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$all</span>)&#123;</span><br><span class="line">        <span class="comment"># 获取多条，二维数组存储</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysqli_fetch_assoc(<span class="variable">$res</span>))&#123;</span><br><span class="line">            <span class="variable">$lists</span>[] = <span class="variable">$row</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># 获取一条，一维数组存储</span></span><br><span class="line">        <span class="variable">$lists</span> = mysqli_fetch_assoc(<span class="variable">$res</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 释放资源，返回结果</span></span><br><span class="line">    mysqli_free_result(<span class="variable">$res</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$lists</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>5、普通查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户提供SQL指令，可以查询一条或者多条记录</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$conn</span>,<span class="variable">$sql</span>,&amp;<span class="variable">$error</span>,<span class="variable">$all</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment"># 执行SQL，并判定结果</span></span><br><span class="line">    <span class="variable">$res</span> = query(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span> === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析结果集</span></span><br><span class="line">    <span class="variable">$lists</span> = [];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$all</span>)&#123;</span><br><span class="line">        <span class="comment"># 多条数据：二维数组</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysqli_fetch_assoc(<span class="variable">$res</span>))&#123;</span><br><span class="line">            <span class="variable">$lists</span>[] = <span class="variable">$row</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># 一条数据：一维数组</span></span><br><span class="line">        <span class="variable">$lists</span> = mysqli_fetch_assoc(<span class="variable">$res</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 释放资源，返回结果</span></span><br><span class="line">    mysqli_free_result(<span class="variable">$res</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$lists</span>;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、封装是为了代码能够更好的实现复用</p>
<ul>
<li>复用性</li>
<li>灵活性</li>
</ul>
<p>2、封装需要考虑封装事务的独立性，不要试图用一个函数去解决一个很大的问题</p>
<h3 id="4、新闻列表"><a href="#4、新闻列表" class="headerlink" title="4、新闻列表"></a>4、新闻列表</h3><p><strong>新闻列表</strong>：将新闻信息从数据库取出，然后在模板中显示</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、新增列表处理文件：index.php</p>
<p>2、在PHP中根据模板显示的要求，获取相应的数据</p>
<p>3、PHP加载显示数据的模板</p>
<p>4、在模板中使用PHP输出相应的数据</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、创建首页（列表页）处理脚本index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示新闻列表</span></span><br></pre></td></tr></table></figure>



<p>2、根据模板显示要求获取数据信息：新闻id、标题、内容、作者名字、发布时间</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载封装的数据库操作文件</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;sql.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完成初始化操作</span></span><br><span class="line"><span class="variable">$conn</span> = connect(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="comment"># 判定结果</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>) <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组织数据SQL，获取数据（手动组织：需要连表）</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select n.*,a.name from news n left join author a on n.a_id = a.id&quot;</span>;</span><br><span class="line"><span class="variable">$news</span> = read(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>3、加载模板</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载首页模板</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;news_index.html&#x27;</span>;	<span class="comment"># 注意路径</span></span><br></pre></td></tr></table></figure>

<p>4、在模板中对应位置显示对应的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php foreach($news as $n):?&gt;</span><br><span class="line">    &lt;!-- 列表项开始 --&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;news-list-item&quot;&gt;</span><br><span class="line">        &lt;!-- 作者以及发布时间 --&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;author-time&quot;&gt; &lt;span&gt;&lt;?php echo $n[&#39;name&#39;];?&gt;&lt;&#x2F;span&gt; 发表于 &lt;span&gt;&lt;?php echo date(&#39;Y-m-d H:i:s&#39;,$n[&#39;publish&#39;]);?&gt;&lt;&#x2F;span&gt; &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;!-- 新闻详情 --&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;news-des&quot;&gt;</span><br><span class="line">        	&lt;!-- 新闻标题 --&gt;</span><br><span class="line">            &lt;h3 class&#x3D;&quot;news-title&quot; style&#x3D;&#39;float: left;&#39;&gt;</span><br><span class="line">            	&lt;i&gt;&lt;&#x2F;i&gt;&lt;a href&#x3D;&quot;02-新闻详情页.html&quot;&gt;&lt;?php echo $n[&#39;title&#39;];?&gt;&lt;&#x2F;a&gt;</span><br><span class="line">            &lt;&#x2F;h3&gt;</span><br><span class="line"></span><br><span class="line">         	&lt;!-- 编辑,删除 --&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;operate&quot;&gt;</span><br><span class="line">            	&lt;a href&#x3D;&quot;04-新闻修改页.html&quot;&gt;编辑&lt;&#x2F;a&gt;&amp;nbsp;&amp;nbsp;&lt;a href&#x3D;&quot;#&quot; onclick&#x3D;&quot;return confirm(&#39;你确认要删除本条新闻吗?&#39;)&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div style&#x3D;&#39;clear:both&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 新闻内容 --&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;news-content-des ellipsis&quot;&gt;&lt;?php echo $n[&#39;content&#39;];?&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;!-- 列表项结束 --&gt;</span><br><span class="line">&lt;?php endforeach;?&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、显示数据的核心逻辑是获取数据、显示数据</p>
<h3 id="5、编辑新闻"><a href="#5、编辑新闻" class="headerlink" title="5、编辑新闻"></a>5、编辑新闻</h3><p><strong>编辑新闻</strong>：将已有的新闻取出来，然后再次进行加工操作，并提交更新到服务器</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、提供操作链接：编辑通常是针对单条记录，需要在列表页针对每一条记录制作对应的编辑链接</p>
<p>2、后台新增接收编辑的PHP脚本：edit.php</p>
<ul>
<li>接收要编辑的新闻信息</li>
<li>从数据库取出要编辑的新闻</li>
<li>加载编辑模板（表单）</li>
<li>显示编辑取出来的新闻</li>
</ul>
<p>3、用户编辑数据后提交到update.php</p>
<ul>
<li>接收用户提交的信息<ul>
<li>被编辑的内容（要入库）</li>
<li>不可编辑的内容（条件匹配）</li>
</ul>
</li>
<li>数据安全性验证</li>
<li>组织更新指令更新入库（自动更新）</li>
</ul>
<p>4、根据执行结果提示用户操作信息并进行跳转</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、修改列表页，增加编辑链接：需要传入要编辑的新闻id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 编辑,删除 --&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;operate&quot;&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;edit.php?id&#x3D;&lt;?php echo $n[&#39;id&#39;];?&gt;&quot;&gt;编辑&lt;&#x2F;a&gt;&amp;nbsp;&amp;nbsp;&lt;a href&#x3D;&quot;#&quot; onclick&#x3D;&quot;return confirm(&#39;你确认要删除本条新闻吗?&#39;)&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>2、增加edit.php脚本，实现新闻的获取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收要获取的新闻id</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] ?? <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$id</span>) &#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=<span class="subst">&#123;$_SERVER[&#x27;HTTP_REFERER&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;当前要编辑的新闻不存在！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取新闻数据</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;sql.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = connect(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="comment"># 判定结果</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动查询</span></span><br><span class="line"><span class="variable">$news</span> = auto_read(<span class="variable">$conn</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>,[<span class="string">&#x27;id&#x27;</span> =&gt; <span class="variable">$id</span>]);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$news</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;当前要编辑的新闻不存在！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、加载模板</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载模板</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;news_edit.html&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4、在模板中显示要编辑的数据：id必须传，但是需要隐藏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;update.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;id&quot; value&#x3D;&quot;&lt;?php echo $news[&#39;id&#39;];?&gt;&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">                 &lt;label for&#x3D;&quot;news_title&quot;&gt;新闻标题&lt;&#x2F;label&gt;</span><br><span class="line">                 &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;title&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&#39;news_title&#39; value&#x3D;&#39;&lt;?php echo $news[&#39;title&#39;];?&gt;&#39;&gt;</span><br><span class="line">             &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">             &lt;div class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">                 &lt;label for&#x3D;&quot;news_content&quot;&gt;新闻内容&lt;&#x2F;label&gt;</span><br><span class="line">                 &lt;textarea class&#x3D;&quot;form-control&quot; name&#x3D;&quot;content&quot; rows&#x3D;&quot;12&quot;&gt;&lt;?php echo $news[&#39;content&#39;]?&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">             &lt;&#x2F;div&gt;</span><br><span class="line">             &lt;button class&#x3D;&quot;btn btn-danger btn-block&quot;&gt;修改&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>5、后台增加update.php 用于处理用户提交的表单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收数据：数组接收可能修改的数据（下标与表字段名一致）</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;title&#x27;</span>] 	= <span class="variable">$_POST</span>[<span class="string">&#x27;title&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;content&#x27;</span>]= <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判定</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$data</span>[<span class="string">&#x27;title&#x27;</span>]) || <span class="keyword">empty</span>(<span class="variable">$data</span>[<span class="string">&#x27;content&#x27;</span>]))&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=edit.php?id=&#x27;</span> . <span class="variable">$id</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;标题和内容都不能为空！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动更新</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;sql.php&#x27;</span>;</span><br><span class="line"><span class="variable">$conn</span> = connect(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="comment"># 判定结果</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = auto_update(<span class="variable">$conn</span>,<span class="variable">$data</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>,<span class="variable">$id</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6、根据更新结果进行跳转</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 结果判定</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=detail.php?id=&#x27;</span>.<span class="variable">$id</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;更新成功！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment"># 是没有要更新的数据</span></span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;没有要更新的数据！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、编辑操作是所有增删改查里步骤最复杂的一个</p>
<h3 id="6、删除新闻"><a href="#6、删除新闻" class="headerlink" title="6、删除新闻"></a>6、删除新闻</h3><p><strong>删除新闻</strong>：对已有新闻从数据库指定移出</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、提供操作链接：删除通常是针对单条记录，需要在列表页针对每一条记录制作对应的删除链接（需要明确要删除的数据的参数）</p>
<p>2、后台新增实现删除的PHP脚本：delete.php</p>
<ul>
<li>接收要删除的记录参数（通常是主键）</li>
<li>必要时进行数据安全验证</li>
<li>组织SQL指令执行删除操作</li>
</ul>
<p>3、根据删除结果进行跳转提示</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、修改列表页，增加删除链接：需要传入要删除的新闻id</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 编辑,删除 --&gt;</span><br><span class="line">&lt;div class=&quot;operate&quot;&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;edit.php?id=&lt;?php echo <span class="subst">$n</span>[&#x27;id&#x27;];?&gt;&quot;</span>&gt;编辑&lt;/a&gt;&amp;nbsp;&amp;nbsp;&lt;a href=<span class="string">&quot;delete.php?id=&lt;?php echo <span class="subst">$n</span>[&#x27;id&#x27;];?&gt;&quot;</span> onclick=<span class="string">&quot;return confirm(&#x27;你确认要删除本条新闻吗?&#x27;)&quot;</span>&gt;删除&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>一般删除会做一个前端安全限定：js的确认验证</li>
</ul>
<p>2、后台增加一个delete.php实现数据的删除操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] ?? <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$id</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;当前要删除的新闻不存在！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现数据库操作</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;sql.php&#x27;</span>;</span><br><span class="line"><span class="variable">$conn</span> = connect(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="comment"># 判定结果</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除操作</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from news where id = <span class="subst">&#123;$id&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = query(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判定下执行结果</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)</span><br><span class="line">    <span class="variable">$res</span> = mysqli_affected_rows(<span class="variable">$connn</span>);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;删除成功！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Refresh:3;url=index.php&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;删除失败！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、删除操作是增删改查里本质最简单的一种业务，但是实际开发中删除操作却是非常谨慎的</p>
<ul>
<li>删除不可逆</li>
<li>数据的删除不利于大数据分析</li>
</ul>
<p>2、实际实现中，一般的业务数据可以删除，但是比较重要的数据虽然给用户的感觉是删除，但是实际上数据库里并不会删除</p>
<ul>
<li>数据表增加字段记录状态</li>
<li>数据查询时根据状态来进行数据筛选</li>
<li>数据删除时只要改变状态不让普通查询可查即可</li>
</ul>
<h3 id="7、查看新闻"><a href="#7、查看新闻" class="headerlink" title="7、查看新闻"></a>7、查看新闻</h3><p><strong>查看新闻</strong>：用户通过点击新闻标题查看新闻详细信息</p>
<blockquote>
<p>步骤</p>
</blockquote>
<p>1、找到列表页中出现新闻标题的位置</p>
<p>2、给每一个标题增加一个访问链接：后台处理文件detail.php</p>
<p>3、给每个请求追加具体新闻信息id</p>
<p>4、后台detail.php接收要查看的新闻数据：id</p>
<p>5、从数据库查询新闻信息：按模板显示需求</p>
<p>6、加载显示新闻详情的模板</p>
<p>7、显示数据</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、显示新闻详情</p>
<ul>
<li>在新闻列表页增加标题点击链接，请求detail.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 新闻标题 --&gt;</span><br><span class="line">&lt;h3 class&#x3D;&quot;news-title&quot; style&#x3D;&#39;float: left;&#39;&gt;</span><br><span class="line">    &lt;i&gt;&lt;&#x2F;i&gt;&lt;a href&#x3D;&quot;detail.php?id&#x3D;&lt;?php echo $n[&#39;id&#39;];?&gt;&quot;&gt;&lt;?php echo $n[&#39;title&#39;];?&gt;&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;h3&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在后台增加detail.php获取新闻信息，加载新闻详情模板</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收新闻id</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] ?? <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$id</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;非法访问！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取新闻数据</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;Sql.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = connect(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;news&#x27;</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="comment"># 判定结果</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$conn</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select n.*,a.name from news n left join author a on n.a_id = a.id where n.id = <span class="subst">&#123;$id&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$news</span> = read(<span class="variable">$conn</span>,<span class="variable">$sql</span>,<span class="variable">$error</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$news</span>)&#123;</span><br><span class="line">    header(<span class="string">&#x27;Refresh:3;url=index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;您所访问的新闻不存在！&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模板</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;news_detail.html&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>在模板中显示新闻信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;news-list-item&quot; style&#x3D;&#39;border-bottom: none;&#39;&gt;</span><br><span class="line">    &lt;!-- 新闻标题 --&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;news-title&quot;&gt;&lt;?php echo $news[&#39;title&#39;];?&gt;&lt;&#x2F;h3&gt; </span><br><span class="line">    &lt;!-- 作者以及发布时间 --&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;author-time&quot;&gt; &lt;span&gt;&lt;?php echo $news[&#39;name&#39;]?&gt;&lt;&#x2F;span&gt; 发表于 &lt;span&gt;&lt;?php echo date(&#39;Y-m-d H:i:s&#39;,$news[&#39;publish&#39;]);?&gt;&lt;&#x2F;span&gt; &lt;&#x2F;div&lt;!-- 新闻详情 --&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;news-des&quot;&gt;</span><br><span class="line">                    	</span><br><span class="line">        &lt;!-- 新闻内容 --&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;news-content-des&quot;&gt;&lt;?php echo $news[&#39;content&#39;]?&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>小结</p>
</blockquote>
<p>1、显示详情的话通常是通过列表进入，然后给出点击链接实现</p>
<p>2、数据显示往往比较简单：保证数据查询是到位的</p>
<h3 id="8、分页"><a href="#8、分页" class="headerlink" title="8、分页"></a>8、分页</h3><p><strong>分页</strong>：将数据按照一种类似于页码的逻辑呈现，用户通过不同页码看到的数据不同</p>
<ul>
<li>分页里有几个核心需要关注的数据<ul>
<li>总记录数：决定页码数量的有效记录数</li>
<li>每页显示量：每一个页面里要显示的记录数</li>
<li>总页数：总记录数 / 每页显示量</li>
<li>当前页码：进行数据筛选的最关键标志</li>
</ul>
</li>
<li>分页的逻辑有两大类<ul>
<li>服务器数据分页：服务器在获取数据时，只获取当前用户需要页面的数据<ul>
<li>减少服务器压力</li>
<li>减少网络传输延迟</li>
</ul>
</li>
<li>JS脚本分页：服务器不管分页，一次性提交所有数据给浏览器，JS通过脚本控制每次显示的数据量<ul>
<li>减少请求次数</li>
<li>减少用户分页点击时等待时间</li>
</ul>
</li>
</ul>
</li>
<li>服务器端实现分页，通常是通过数据库的limit来实现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit 0,3;		# 显示前3条</span><br><span class="line">limit 3,6;		# 显示第二个3条</span><br></pre></td></tr></table></figure>

<ul>
<li>分页的效果通常是浏览器上给用户提供一排页码点击链接，用户点击哪个就访问对应页面的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;page&quot;&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;首页&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;上一页&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;1&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;2&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot; class&#x3D;&#39;current&#39;&gt;3&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;4&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;5&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;下一页&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;末页&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>步骤</p>
</blockquote>
<p>1、确定分页模式（通常使用数据库分页）</p>
<p>2、确定分页效果：参照京东分页逻辑</p>
<ul>
<li>有上一页和下一页<ul>
<li>如果已经是第一页：那么上一页不可用（或者没有）</li>
<li>如果已经是最后一页：那么下一页不可用（或者没有）</li>
</ul>
</li>
<li>一共最多显示7个可点击数字页面<ul>
<li>如果总页数小于等于7页：显示所有页码：1，2，3，4，5，6，7</li>
<li>如果总页数大于7页，显示当前页码左右连贯5页（左右各两页）<ul>
<li>当前页码小于等于5：显示前7页，最后增加一个<code>...</code>表示有更多页码：1，2，3，4，5，6，7，…</li>
<li>当前页码大于5页：显示前2页（1和2），然后跟<code>...</code>，然后显示当前页连贯5页：1，2，…<ul>
<li>如果当前页码已经属于最后3页内，显示最后5页数据：1，2，…，6，7，8，9，10</li>
<li>如果当前页码小于最后3页，那么最后增加一个<code>...</code>表示有更多页码：1，2，…，5，6，7，8，9，…</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>3、确定分页链接方式</p>
<ul>
<li>前端设计者已经设计好，针对设计好的进行动态化即可</li>
<li>前端没有提供，一般提供一个ul列表+a标签实现</li>
</ul>
<p>4、在后台实现分页点击的字符串逻辑</p>
<p>5、在前端页面分页处显示后台设计的分页逻辑</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>1、使用京东分页逻辑实现分页，使用前端设计好的a标签形式设计分页字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在所有数据分页都是请求index.php，所以需要在index.php开始处增加页码获取信息（包含每页访问的数量定义）</span></span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] ?? <span class="number">1</span>;</span><br><span class="line"><span class="variable">$pagecount</span> = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取满足条件的数据的总记录数（在获取列表之前：因为不需要获取全部数据了）</span></span><br><span class="line"><span class="variable">$count_sql</span> = <span class="string">&#x27;select count(*) as total from news&#x27;</span>;</span><br><span class="line"><span class="variable">$res</span> = read(<span class="variable">$conn</span>,<span class="variable">$count_sql</span>,<span class="variable">$error</span>);		<span class="comment"># 执行</span></span><br><span class="line"><span class="variable">$count</span> = <span class="variable">$res</span>[<span class="string">&#x27;total&#x27;</span>] ?? <span class="number">0</span>;				<span class="comment"># 取出记录（如果没有那就是0）</span></span><br><span class="line"><span class="variable">$pages</span> = ceil(<span class="variable">$count</span> / <span class="variable">$pagecount</span>);			<span class="comment"># 总页数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算页码数据：使用limit限制</span></span><br><span class="line"><span class="variable">$offset</span> = (<span class="variable">$page</span> - <span class="number">1</span>) * <span class="variable">$pagecount</span>;</span><br><span class="line"><span class="variable">$limit</span> = <span class="string">&quot; limit <span class="subst">$offset</span>,<span class="subst">$pagecount</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼凑原来获取数据的SQL，使得数据分页效果实现</span></span><br><span class="line"><span class="comment"># 连接查询之后，系统会默认按照连接条件进行升序排序，需要调整为新闻id升序排序</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select n.*,a.name from news n left join author a on n.a_id = a.id order by n.id &quot;</span> . <span class="variable">$limit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生分页链接信息</span></span><br><span class="line"><span class="variable">$pageinfo</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首页</span></span><br><span class="line"><span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=1&#x27;&gt;首页&lt;/a&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判定是否需要上一页</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$page</span> != <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable">$prev</span> = <span class="variable">$page</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$prev&#125;</span>&#x27;&gt;上一页&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼凑数字逻辑部分：以页码总数先划分</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$pages</span> &lt;= <span class="number">7</span>)&#123;</span><br><span class="line">    <span class="comment"># 显示所有页码，也不需要...</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt;= <span class="variable">$pages</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="comment"># 判定当前页码是否被选中：增加样式</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$page</span> == <span class="variable">$i</span>) <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a class=&#x27;current&#x27; href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;        </span><br><span class="line">        <span class="keyword">else</span> <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment"># 当前页码在前5页：显示前7页，外加...</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$page</span> &lt;= <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt;= <span class="number">7</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="comment"># 判定当前页是否被选中：选中需要增加css样式</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$page</span> == <span class="variable">$i</span>) <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a class=&#x27;current&#x27; href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 追加...</span></span><br><span class="line">        <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href =&#x27;javascript:return false;&#x27; onclick=&#x27;return false;&#x27;&gt;...&lt;/a&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># 当前页码大于5：显示前2页和...</span></span><br><span class="line">        <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=1&#x27;&gt;1&lt;/a&gt;&quot;</span>;</span><br><span class="line">    	<span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=2&#x27;&gt;2&lt;/a&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href =&#x27;javascript:return false;&#x27; onclick=&#x27;return false;&#x27;&gt;...&lt;/a&gt;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 判定当前页码是否已经到达最后三页：不需要后序...</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$page</span> &gt; <span class="variable">$pages</span> - <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment"># 显示最后5页</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="variable">$pages</span> - <span class="number">4</span>;<span class="variable">$i</span> &lt;= <span class="variable">$pages</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">                <span class="comment"># 判定当前页是否被选中：选中需要增加css样式</span></span><br><span class="line">            	<span class="keyword">if</span>(<span class="variable">$page</span> == <span class="variable">$i</span>) <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a class=&#x27;current&#x27; href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            	<span class="keyword">else</span> <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment"># 显示中间5页，并追加...</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="variable">$page</span> - <span class="number">2</span>;<span class="variable">$i</span> &lt;= <span class="variable">$page</span> + <span class="number">2</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">                <span class="comment"># 判定当前页是否被选中：选中需要增加css样式</span></span><br><span class="line">            	<span class="keyword">if</span>(<span class="variable">$page</span> == <span class="variable">$i</span>) <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a class=&#x27;current&#x27; href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            	<span class="keyword">else</span> <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$i&#125;</span>&#x27;&gt;<span class="subst">&#123;$i&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 追加...</span></span><br><span class="line">            <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href =&#x27;javascript:return false;&#x27; onclick=&#x27;return false;&#x27;&gt;...&lt;/a&gt;&quot;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判定是否需要增加下一页</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$page</span> != <span class="variable">$pages</span>)&#123;</span><br><span class="line">    <span class="variable">$next</span> = <span class="variable">$page</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$next&#125;</span>&#x27;&gt;下一页&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 末页</span></span><br><span class="line"><span class="variable">$pageinfo</span> .= <span class="string">&quot;&lt;a href=&#x27;index.php?page=<span class="subst">&#123;$pages&#125;</span>&#x27;&gt;末页&lt;/a&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>2、在模板上显示计算好的分页链接，代替原来的a标签分页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 分页 --&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;page&quot;&gt;</span><br><span class="line">    &lt;?php echo $pageinfo;?&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>1、分页后台数据筛选分为两个核心部分</p>
<ul>
<li>数据分页：利用limit实现数据的分页获取</li>
<li>逻辑分页：利用逻辑部分实现分页链接，让用户可以访问不同分页数据</li>
</ul>
<h3 id="9、项目完善和总结"><a href="#9、项目完善和总结" class="headerlink" title="9、项目完善和总结"></a>9、项目完善和总结</h3><p>1、项目完善：各类链接地址修改</p>
<p>2、项目总结</p>
<ul>
<li>前端提供好静态页面</li>
<li>根据静态页设计好数据库</li>
<li>PHP进行逻辑处理<ul>
<li>数据加工</li>
<li>数据库操作（增删改查）</li>
<li>数据显示</li>
</ul>
</li>
</ul>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：MySQL笔记</li>
        <li>本文作者：馨er</li>
        <li>创建时间：2022-03-13 16:03:20</li>
        <li>
            本文链接：https://sjxbbd.vercel.app/2022/03/13/8fafb63c5fa3/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/MySQL/">#MySQL</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev" rel="prev" href="/2022/04/02/7f7287731483/">
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">webpack详解</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next" rel="next" href="/2022/02/25/62acb4601ac6/">
                            <span class="title flex-center">
                                <span class="post-nav-title-item">斐波那契数列的若干解法</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">馨er</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io" rel="external nofollow noopener noreferrer">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep" rel="external nofollow noopener noreferrer">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-text">1 数据库基本介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="nav-text">1.1 数据库基本知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E7%B1%BB"><span class="nav-text">1.2 数据库分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.3 关系型数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1.4 非关系型数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-SQL%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.5 SQL基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-MySQL%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.6 MySQL基本介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-7-MySQL%E8%AE%BF%E9%97%AE"><span class="nav-text">1.7 MySQL访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-8-%E6%80%BB%E7%BB%93"><span class="nav-text">1.8 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-MySQL%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">2 MySQL基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-SQL%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="nav-text">2.1 SQL语法规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-SQL%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-text">2.2 SQL库操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">1、 创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">2、显示数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">3、使用数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">4、修改数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">5、删除数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">6、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-SQL%E8%A1%A8%EF%BC%88%E5%AD%97%E6%AE%B5%EF%BC%89%E6%93%8D%E4%BD%9C"><span class="nav-text">2.3 SQL表（字段）操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-text">1、创建数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-text">2、显示数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-text">3、查看数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%9B%B4%E6%94%B9%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-text">4、更改数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%9B%B4%E6%94%B9%E5%AD%97%E6%AE%B5"><span class="nav-text">5、更改字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%96%B0%E5%A2%9E%E5%AD%97%E6%AE%B5"><span class="nav-text">（1）新增字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%AD%97%E6%AE%B5%E4%BD%8D%E7%BD%AE"><span class="nav-text">（2）字段位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E6%9B%B4%E6%94%B9%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="nav-text">（3）更改字段名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5"><span class="nav-text">（4）修改字段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="nav-text">6、删除字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">7、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-SQL%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">2.4 SQL数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="nav-text">1、新增数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE"><span class="nav-text">2、查看数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-text">3、更新数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-text">4、删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">5、总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-text">3 MySQL数据库字符集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-text">3.1 字符集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%AD%97%E7%AC%A6%E9%9B%86%E6%A6%82%E5%BF%B5"><span class="nav-text">1、字符集概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81MySQL%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-text">2、MySQL字符集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-text">3、乱码问题解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E5%AD%97%E7%AC%A6%E9%9B%86%E8%AE%BE%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-text">4、字符集设置原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%80%BB%E7%BB%93-1"><span class="nav-text">5、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E6%A0%A1%E5%AF%B9%E9%9B%86"><span class="nav-text">3.2 校对集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%A0%A1%E5%AF%B9%E9%9B%86%E6%A6%82%E5%BF%B5"><span class="nav-text">1、校对集概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%A0%A1%E5%AF%B9%E9%9B%86%E8%AE%BE%E7%BD%AE"><span class="nav-text">2、校对集设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%A0%A1%E5%AF%B9%E9%9B%86%E5%BA%94%E7%94%A8"><span class="nav-text">3、校对集应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">4、总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E8%AF%A6%E8%A7%A3"><span class="nav-text">4 MySQL数据库字段详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="nav-text">4.1 字段类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E4%BD%9C%E7%94%A8"><span class="nav-text">1、字段类型作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-text">2、整数类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%98%BE%E7%A4%BA%E5%AE%BD%E5%BA%A6"><span class="nav-text">3、显示宽度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E5%B0%8F%E6%95%B0%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%B5%AE%E7%82%B9%E5%9E%8B%EF%BC%89"><span class="nav-text">4、小数类型（浮点型）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E5%B0%8F%E6%95%B0%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%AE%9A%E7%82%B9%E5%9E%8B%EF%BC%89"><span class="nav-text">5、小数类型（定点型）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%AE%9A%E9%95%BF%E5%9E%8B%EF%BC%89"><span class="nav-text">6、字符串类型（定长型）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%8F%98%E9%95%BF%E5%9E%8B%EF%BC%89"><span class="nav-text">7、字符串类型（变长型）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-text">8、字符串类型（文本字符串）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%9E%9A%E4%B8%BE%EF%BC%89"><span class="nav-text">9、字符串类型（枚举）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-text">10、字符串类型（集合）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%B9%B4%EF%BC%89"><span class="nav-text">11、时间日期类型（年）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%97%B6%E9%97%B4%E6%88%B3%EF%BC%89"><span class="nav-text">12、时间日期类型（时间戳）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%97%A5%E6%9C%9F%EF%BC%89"><span class="nav-text">13、时间日期类型（日期）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%EF%BC%89"><span class="nav-text">14、时间日期类型（日期时间）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15%E3%80%81%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%97%B6%E9%97%B4%EF%BC%89"><span class="nav-text">15、时间日期类型（时间）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">16、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%B1%9E%E6%80%A7"><span class="nav-text">4.2 属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%B1%9E%E6%80%A7%E4%BD%9C%E7%94%A8"><span class="nav-text">1、属性作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81NULL%E5%B1%9E%E6%80%A7"><span class="nav-text">2、NULL属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81Default%E5%B1%9E%E6%80%A7"><span class="nav-text">3、Default属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E4%B8%BB%E9%94%AE"><span class="nav-text">4、主键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E4%B8%BB%E9%94%AE%E7%AE%A1%E7%90%86"><span class="nav-text">5、主键管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E8%87%AA%E5%A2%9E%E9%95%BF%E5%B1%9E%E6%80%A7"><span class="nav-text">6、自增长属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E8%87%AA%E5%A2%9E%E9%95%BF%E7%AE%A1%E7%90%86"><span class="nav-text">7、自增长管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8%E3%80%81%E5%94%AF%E4%B8%80%E9%94%AE"><span class="nav-text">8、唯一键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9%E3%80%81%E5%94%AF%E4%B8%80%E9%94%AE%E7%AE%A1%E7%90%86"><span class="nav-text">9、唯一键管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10%E3%80%81comment%E5%B1%9E%E6%80%A7"><span class="nav-text">10、comment属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">11、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%B0%E5%BD%95%E9%95%BF%E5%BA%A6"><span class="nav-text">4.3 数据库记录长度</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83"><span class="nav-text">5 MySQL数据库设计规范</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F"><span class="nav-text">5.1 关系型数据库设计范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F1NF"><span class="nav-text">1、第一范式1NF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F2NF"><span class="nav-text">2、第二范式2NF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F3NF"><span class="nav-text">3、第三范式3NF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E9%80%86%E8%A7%84%E8%8C%83%E5%8C%96"><span class="nav-text">4、逆规范化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%80%BB%E7%BB%93-2"><span class="nav-text">5、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="nav-text">5.2 表关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="nav-text">1、一对一关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="nav-text">2、一对多关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="nav-text">3、多对多关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%80%BB%E7%BB%93-1"><span class="nav-text">4、总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-MySQL%E9%AB%98%E7%BA%A7SQL%E6%93%8D%E4%BD%9C"><span class="nav-text">6 MySQL高级SQL操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E6%95%B0%E6%8D%AE%E6%96%B0%E5%A2%9E"><span class="nav-text">6.1 数据新增</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="nav-text">1、批量插入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E8%A0%95%E8%99%AB%E5%A4%8D%E5%88%B6"><span class="nav-text">2、蠕虫复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E4%B8%BB%E9%94%AE%E5%86%B2%E7%AA%81"><span class="nav-text">3、主键冲突</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="nav-text">6.2 数据查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%9F%A5%E8%AF%A2%E9%80%89%E9%A1%B9"><span class="nav-text">1、查询选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E5%AD%97%E6%AE%B5%E9%80%89%E6%8B%A9-amp-%E5%88%AB%E5%90%8D"><span class="nav-text">2、字段选择&amp;别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-text">3、数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81where%E5%AD%90%E5%8F%A5"><span class="nav-text">4、where子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-text">5、运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81group-by%E5%AD%90%E5%8F%A5"><span class="nav-text">6、group by子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E5%9B%9E%E6%BA%AF%E7%BB%9F%E8%AE%A1"><span class="nav-text">7、回溯统计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8%E3%80%81%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F"><span class="nav-text">8、分组排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9%E3%80%81having%E5%AD%90%E5%8F%A5"><span class="nav-text">9、having子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10%E3%80%81order-by%E5%AD%90%E5%8F%A5"><span class="nav-text">10、order by子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11%E3%80%81limit%E5%AD%90%E5%8F%A5"><span class="nav-text">11、limit子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">12、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="nav-text">6.3 数据更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4"><span class="nav-text">6.4 数据删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E9%99%90%E5%88%B6%E5%88%A0%E9%99%A4"><span class="nav-text">1、限制删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%B8%85%E7%A9%BA%E6%95%B0%E6%8D%AE"><span class="nav-text">2、清空数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-MySQL%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">7 MySQL多表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-text">7.1 联合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-text">1、联合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%8E%92%E5%BA%8F"><span class="nav-text">2、联合查询排序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-text">7.2 连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5"><span class="nav-text">1、交叉连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-text">2、内连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-text">3、外连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="nav-text">4、自然连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81using%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">5、using关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E6%80%BB%E7%BB%93-1"><span class="nav-text">6、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">7.3 子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="nav-text">1、子查询分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">2、标量子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">3、列子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">4、行子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E8%A1%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">5、表子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81exists%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">6、exists子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E6%AF%94%E8%BE%83%E6%96%B9%E5%BC%8F"><span class="nav-text">7、比较方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-text">8、总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-MySQL%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="nav-text">8 MySQL安全管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-text">8.1 外键约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%A4%96%E9%94%AE"><span class="nav-text">1、外键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-text">2、外键约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%A4%96%E9%94%AE%E7%AE%A1%E7%90%86"><span class="nav-text">3、外键管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-%E4%BA%8B%E5%8A%A1%E5%AE%89%E5%85%A8"><span class="nav-text">8.2 事务安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%BA%8B%E5%8A%A1"><span class="nav-text">1、事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="nav-text">2、事务处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E4%BA%8B%E5%8A%A1%E7%89%B9%E7%82%B9"><span class="nav-text">3、事务特点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-text">8.3 预处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-text">1、预处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E9%A2%84%E5%A4%84%E7%90%86%E4%BC%A0%E5%8F%82"><span class="nav-text">2、预处理传参</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-%E8%A7%86%E5%9B%BE"><span class="nav-text">8.4 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E8%A7%86%E5%9B%BE"><span class="nav-text">1、视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E8%A7%86%E5%9B%BE%E7%AE%A1%E7%90%86"><span class="nav-text">2、视图管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E8%A7%86%E5%9B%BE%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">3、视图数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E8%A7%86%E5%9B%BE%E7%AE%97%E6%B3%95"><span class="nav-text">4、视图算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F"><span class="nav-text">8.5 数据备份与还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E8%A1%A8%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="nav-text">1、表数据备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%BF%98%E5%8E%9F"><span class="nav-text">2、表数据还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD"><span class="nav-text">3、文件备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%96%87%E4%BB%B6%E8%BF%98%E5%8E%9F"><span class="nav-text">4、文件还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81SQL%E5%A4%87%E4%BB%BD"><span class="nav-text">5、SQL备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81SQL%E8%BF%98%E5%8E%9F"><span class="nav-text">6、SQL还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E6%80%BB%E7%BB%93-1"><span class="nav-text">7、总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-text">8.6 用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86"><span class="nav-text">1、账号管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">2、权限管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86"><span class="nav-text">3、角色管理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-PHP%E6%93%8D%E4%BD%9CMySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">9 PHP操作MySQL数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-PHP%E6%89%A9%E5%B1%95"><span class="nav-text">9.1 PHP扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-MySQLi%E6%89%A9%E5%B1%95"><span class="nav-text">9.2 MySQLi扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-MySQLi%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-text">9.3 MySQLi常用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="nav-text">9.4 新增数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-text">9.5 更新数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-text">9.6 删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-text">9.7 查询数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8-%E6%80%BB%E7%BB%93"><span class="nav-text">9.8 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-%E6%96%B0%E9%97%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-text">10 新闻管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-%E8%A1%A8%E5%8D%95%E4%BC%A0%E5%80%BC"><span class="nav-text">10.1 表单传值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E8%A1%A8%E5%8D%95%E4%BC%A0%E5%80%BC"><span class="nav-text">1、表单传值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81POST%E4%BC%A0%E5%80%BC"><span class="nav-text">2、POST传值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81GET%E4%BC%A0%E5%80%BC"><span class="nav-text">3、GET传值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81PHP%E6%8E%A5%E6%94%B6%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-text">4、PHP接收表单数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-%E6%96%B0%E9%97%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-text">10.2 新闻管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="nav-text">1、数据库设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%96%B0%E5%A2%9E%E6%96%B0%E9%97%BB"><span class="nav-text">2、新增新闻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%B0%81%E8%A3%85"><span class="nav-text">3、封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%96%B0%E9%97%BB%E5%88%97%E8%A1%A8"><span class="nav-text">4、新闻列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E7%BC%96%E8%BE%91%E6%96%B0%E9%97%BB"><span class="nav-text">5、编辑新闻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%88%A0%E9%99%A4%E6%96%B0%E9%97%BB"><span class="nav-text">6、删除新闻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E6%9F%A5%E7%9C%8B%E6%96%B0%E9%97%BB"><span class="nav-text">7、查看新闻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8%E3%80%81%E5%88%86%E9%A1%B5"><span class="nav-text">8、分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%8C%E5%96%84%E5%92%8C%E6%80%BB%E7%BB%93"><span class="nav-text">9、项目完善和总结</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src>
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
